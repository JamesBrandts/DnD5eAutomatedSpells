{"_id":"1BoZq4seJsn5c0Cc","name":"Cause Fear","type":"spell","img":"icons/magic/control/fear-fright-monster-grin-purple-blue.webp","data":{"description":{"value":"<p>You awaken the sense of mortality in one creature you can see within range. A construct or an undead is immune to this effect. The target must succeed on a Wisdom saving throw or become frightened of you until the spell ends. The frightened target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success.</p>\n<p> </p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st. The creatures must be within 30 feet of each other when you target them.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":""},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":1,"school":"nec","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"l25eie2r6awmfmmx","changes":[{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.ability.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.OverTime","mode":2,"value":"turn=end,\nsaveAbility=wis,\nsaveDC=@attributes.spelldc,\nlabel=Cause Fear","priority":"20"},{"key":"macro.itemMacro.GM","mode":0,"value":"@token","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/svg/terror.svg","label":"Frightened","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["flags.midi-qol.disadvantage.attack.all","flags.midi-qol.disadvantage.ability.all","flags.midi-qol.OverTime","macro.itemMacro.GM"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Cause Fear","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] === \"on\"){    \n    const lastArg = args[args.length-1]\n    const originTokenId = args[1]\n    const targetToken = canvas.tokens.get(lastArg.tokenId);\n    const origin = canvas.tokens.get(originTokenId);\n    const targetActor = targetToken.actor;\n    let hookId = Hooks.on('preUpdateTokenGM',(tokenDocument, change, options, userId)=>{\n        if (change._id != targetToken.id) return;\n        if(game.combat?.current.tokenId != targetToken.id) return;\n        if (!(\"x\" in change || \"y\" in change)) return;\n        let targetLocationX = change.x ?? targetToken.data.x;\n        let targetLocationY = change.y ?? targetToken.data.y;\n        let targetLocation = {x:targetLocationX,y:targetLocationY};\n        let actualDistance = canvas.grid.measureDistance(targetToken,origin);\n        let targetDistance = canvas.grid.measureDistance(targetLocation,origin);\n        if (targetDistance<actualDistance){\n            ui.notifications.warn(`Due to the effect of Cause Fear ${targetActor.data.name} cannot willingly move closer to ${origin.data.name}`);\n            return false;\n        }\n    });\n    DAE.setFlag(targetActor,\"CauseFearHookId\",hookId);\n}\n\nif(args[0] === \"off\"){   \n    const lastArg = args[args.length-1] \n    const targetToken = canvas.tokens.get(lastArg.tokenId);\n    const targetActor = targetToken.actor;\n    Hooks.off(\"preUpdateTokenGM\",DAE.getFlag(targetActor,\"CauseFearHookId\"))\n\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"core":{"sourceId":"Item.vszmqLcuetkMzbsl"}}}
{"name":"Bless","type":"spell","img":"systems/dnd5e/icons/spells/haste-sky-1.jpg","data":{"description":{"value":"<p>You bless up to three creatures of your choice within range. Whenever a target makes an attack roll or a saving throw before the spell ends, the target can roll 1d4 and add the number rolled to the attack roll or saving throw.</p>\n                                        <p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>\n                                        <p>&lt;Dynamiceffects notes&gt;</p>\n                                        <p>Activating the effect via the activate function will apply the effect to the targeted tokens. The effect will expire in 10 minutes of game time if about-time is installed and running. <br /><br />If minor-qol is installed casting the spell via a speed roll (clicking on the inventory icon or macro) will apply the effect to targeted tokens automatically if the config \"auto apply item effects to targets\". If about-time is installed the effect will expire after 10 minutes of game time</p>","chat":"","unidentified":""},"source":"PHB pg. 219","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A sprinkling of holy water","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"spellType":{"value":"","_deprecated":true},"time":{"value":"","_deprecated":true},"damageType":{"value":"","_deprecated":true},"concentration":{"value":null,"_deprecated":true},"ritual":{"value":null,"_deprecated":true},"attributes":{"spelldc":10},"attunement":null},"effects":[{"_id":"V9sIi7E0bnmgVL5F","flags":{},"changes":[{"key":"data.bonuses.abilities.save","value":"1d4","mode":2,"priority":20},{"key":"data.bonuses.All-Attacks","value":"1d4","mode":2,"priority":20}],"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/haste-sky-1.jpg","label":"Bless Active Effects","transfer":false,"disabled":false}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"dynamiceffects":{"effects":[{"modSpecKey":"data.bonuses.abilities.save","value":"1d4","mode":"+","id":2,"itemId":"pxmqzolZyaTf7kTr","active":true,"label":"Bonuses Abilities Save"},{"modSpecKey":"data.bonuses.All-Attacks","value":"1d4","mode":"+","id":3,"itemId":"pxmqzolZyaTf7kTr","active":true,"label":"Bonuses All Attack Bonuses"}],"equipActive":false,"alwaysActive":false},"dae":{"activeEquipped":false,"alwaysActive":false},"core":{"sourceId":"Item.Y2EkjEIzdep6LgJe"},"midi-qol":{"effectActivation":false,"forceCEOff":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"2vQZHRo3NGkBqUul"}
{"name":"Faerie Fire","type":"spell","img":"systems/dnd5e/icons/spells/fire-arrows-jade-2.jpg","data":{"description":{"value":"<p>Each object in a 20-foot cube within range is outlined in blue, green, or violet light (your choice). Any creature in the area when the spell is cast is also outlined in light if it fails a Dexterity saving throw. For the duration, objects and affected creatures shed dim light in a 10-foot radius.</p><p>Any attack roll against an affected creature or object has advantage if the attacker can see it, and the affected creature or object can't benefit from being invisible.</p>","chat":"","unidentified":""},"source":"PHB pg. 239","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"dex","dc":0,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"rj9xhu3hulyhk272","changes":[{"key":"flags.midi-qol.grants.advantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"data.traits.ci.value","mode":2,"value":"invisible","priority":"20"},{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"systems/dnd5e/icons/spells/fire-arrows-jade-2.jpg","label":"Faerie Fire","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["flags.midi-qol.grants.advantage.attack.all","data.traits.ci.value","macro.itemMacro.GM"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.nqBDWkVOfcGZt4YU"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Faerie Fire","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nif(args[0] === \"on\"){\n    const tokenT = await fromUuid(lastArg.tokenUuid)\n    const desl = tokenT.data.height*canvas.scene.dimensions.size/2\n    lightData = {\n        \"x\": tokenT.data.x+desl,\n        \"y\": tokenT.data.y+desl,\n        \"rotation\": 0,\n        \"walls\": true,\n        \"vision\": false,\n        \"config\": {\n            \"alpha\": 0.5,\n            \"angle\": 0,\n            \"bright\": 0,\n            \"coloration\": 2,\n            \"dim\": 10,\n            \"gradual\": true,\n            \"luminosity\": 0,\n            \"saturation\": 0,\n            \"contrast\": 0,\n            \"shadows\": 0,\n            \"animation\": {\n                \"speed\": 3,\n                \"intensity\": 4,\n                \"reverse\": false,\n                \"type\": \"fairy\"\n            },\n            \"darkness\": {\n                \"min\": 0,\n                \"max\": 1\n            },\n            \"color\": \"#990099\"\n        },\n        \"hidden\": false,\n    }\n    let FaerieFireLight = await canvas.scene.createEmbeddedDocuments(\"AmbientLight\",[lightData])\n    DAE.setFlag(tokenT.actor,\"FaerieFireLight\",FaerieFireLight[0].uuid)\n    let hookId = Hooks.on(\"updateToken\",(tokenUpdated,update,options,userId)=>{\n        if(update._id != tokenT.id)return;\n        if(!(\"x\" in update || \"y\" in update))return;\n        let lightX = update.x??tokenT.data.x\n        let lightY = update.y??tokenT.data.y\n        canvas.scene.updateEmbeddedDocuments(\"AmbientLight\",[{_id:FaerieFireLight[0].id,x:lightX+desl,y:lightY+desl}])\n    })\n    DAE.setFlag(tokenT.actor,\"FaerieFireHookId\",hookId)\n}\nif(args[0] === \"off\"){\n    const tokenT = await fromUuid(lastArg.tokenUuid)\n    let light = await fromUuid(DAE.getFlag(tokenT.actor,\"FaerieFireLight\"))\n    light.delete()\n    Hooks.off(\"updateToken\",DAE.getFlag(tokenT.actor,\"FaerieFireHookId\"))\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"37TO456tMOZPyqr8"}
{"name":"Hail Of Thorns","type":"spell","img":"icons/magic/nature/root-vine-entwined-thorns.webp","data":{"description":{"value":"<p>The next time you hit a creature with a ranged weapon attack before the spell ends, this spell creates a rain of thorns that sprouts from your ranged weapon or ammunition. In addition to the normal effect of the attack, the target of the attack and each creature within 5 feet of it must make a Dexterity saving throw. A creature takes 1d10 piercing damage on a failed save, or half as much damage on a successful one.</p><p><strong><em>At Higher Levels.</em></strong> If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d10 for each slot level above 1st (to a maximum of 6d10).</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":0},"effects":[{"_id":"5l4uit9ax6xpfvp6","changes":[{"key":"flags.dnd5e.DamageBonusMacro","mode":0,"value":"ItemMacro.Hail Of Thorns","priority":"20"},{"key":"flags.dae.hailOfThornsDice","mode":2,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"icons/magic/nature/root-vine-entwined-thorns.webp","label":"Hail Of Thorns","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Hit:rwak"],"transfer":false}},"tint":null,"selectedKey":["flags.dnd5e.DamageBonusMacro","__"]}],"folder":null,"sort":0,"permission":{"default":0,"6FXhlTgGWKhYckv8":3,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.bmvLxP3UeTRphrdB"},"itemacro":{"macro":{"data":{"_id":null,"name":"Hail Of Thorns","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length - 1];\nif(lastArg.hitTargets.length < 1)return;\nif(lastArg.item.data.actionType != \"rwak\")return;\nconst targetToken = lastArg.hitTargets[0];\nlet tokenD = await fromUuid(lastArg.tokenUuid)\nlet actorD = tokenD.actor\nlet numDice = tokenD.actor.data.flags.dae.hailOfThornsDice;\nlet distance = 7.5;\nlet aoe_target = canvas.tokens.placeables.filter(target => (canvas.grid.measureDistance(targetToken.object.center, target.center) <= distance));\nlet item = await actorD.createEmbeddedDocuments('Item',[getItemData(numDice)])\nawait MidiQOL.completeItemRoll(item[0], {targetUuids: aoe_target.map(i=>i.document.uuid)});\nactorD.deleteEmbeddedDocuments('Item',[item[0].id])\n\nfunction getItemData(dice){\n    return {\n    name: \"Hail Of Thorns Damage\",\n    type: \"spell\",\n    img: \"icons/magic/nature/root-vine-entwined-thorns.webp\",\n    data: {\n        actionType: \"save\",\n        activation: {type: \"none\"},\n        damage: {parts: [[`${dice}d10`, \"piercing\"]]},\n        save: {ability: \"dex\",dc: null,scaling: \"spell\"},\n        level: 0,\n        school: \"con\"\n    }\n};\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"62fZRM0nwNf1XZSt"}
{"name":"Longstrider","type":"spell","img":"systems/dnd5e/icons/spells/wind-sky-1.jpg","data":{"description":{"value":"<p>You touch a creature. The target's speed increases by 10 feet until the spell ends.</p>","chat":"","unidentified":""},"source":"PHB pg. 256","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A pinch of dirt","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"xkwiz8spaxllt6az","changes":[{"key":"data.attributes.movement.walk","mode":2,"value":"+10","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/wind-sky-1.jpg","label":"Longstrider","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.movement.walk"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.B0pnIcc52O6G8hi8"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"65ztLUcqDXUe8kNn"}
{"name":"Bane","type":"spell","img":"systems/dnd5e/icons/spells/rip-magenta-2.jpg","data":{"description":{"value":"<p>Up to three creatures of your choice that you can see within range must make Charisma saving throws. Whenever a target that fails this saving throw makes an attack roll or a saving throw before the spell ends, the target must roll a d4 and subtract the number rolled from the attack roll or saving throw.</p>\n<p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 216","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"cha","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A drop of blood","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"potjmpJPeUA1U4oe","flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"changes":[{"key":"data.bonuses.abilities.save","mode":2,"value":"-1d4","priority":"20"},{"key":"data.bonuses.mwak.attack","mode":2,"value":"-1d4","priority":"20"},{"key":"data.bonuses.msak.attack","mode":2,"value":"-1d4","priority":"20"},{"key":"data.bonuses.rsak.attack","mode":2,"value":"-1d4","priority":"20"},{"key":"data.bonuses.rwak.attack","mode":2,"value":"-1d4","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"systems/dnd5e/icons/spells/rip-magenta-2.jpg","label":"Bane","origin":"Item.KkaQm4OQJxc6z3to","tint":null,"transfer":false,"selectedKey":["data.bonuses.abilities.save","data.bonuses.mwak.attack","data.bonuses.msak.attack","data.bonuses.rsak.attack","data.bonuses.rwak.attack"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.95K2aUhAGV9qXjnf"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"8LThkNJfA2LurLRA"}
{"name":"Healing Word","type":"spell","img":"systems/dnd5e/icons/spells/heal-jade-1.jpg","data":{"description":{"value":"<p>A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier. This spell has no effect on undead or constructs.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the healing increases by 1d4 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 250","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":0,"per":""},"consume":{"type":"","target":null,"amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + @mod","healing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d4"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.o8Dh7fblk1d16tnO"}},"_id":"9CBC3YQ7Fye2Usds"}
{"_id":"9aVd7Tr8yLOGhLj1","name":"Armor of Agathys","type":"spell","img":"icons/magic/defensive/shield-barrier-flaming-diamond-blue.webp","data":{"description":{"value":"<p>A protective magical force surrounds you, manifesting as a spectral frost that covers you and your gear. You gain 5 temporary hit points for the duration. If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage.</p>\n<p> </p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, both the temporary hit points and the cold damage increase by 5 for each slot.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"5"}},"effects":[{"_id":"z9h8f6stm89blki0","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/defensive/shield-barrier-flaming-diamond-blue.webp","label":"Armor of Agathys","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Armor of Agathys","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] === \"on\"){\n    const lastArg = args[args.length-1];\n    const targetToken = await fromUuid(lastArg.tokenUuid);\n    const targetActor = targetToken.actor;\n    const spellLevel = args[1];\n    const hpTemp = 5*spellLevel;\n    targetActor.update({'data.attributes.hp.temp':hpTemp});\n    let hookId = Hooks.on(\"midi-qol.preDamageRollCompleteGMGM\", async (workflow) => {\n        if(!['mwak','msak'].includes(workflow.item.data.data.actionType)) return;\n        if(!Array.from(workflow.hitTargets).includes(targetToken.object)) return;\n        let target = workflow.token;\n        let itemData = getItemData()\n        itemData.data.damage.parts[0][0] = `${hpTemp}`\n        let damageItem = await targetActor.createEmbeddedDocuments(\"Item\",[itemData])\n        await MidiQOL.completeItemRoll(damageItem[0], {targetUuids: [target.document.uuid]});\n        await targetActor.deleteEmbeddedDocuments(\"Item\",[damageItem[0].id])\n        if(targetActor.data.data.attributes.hp.temp<=workflow.damageTotal){\n            targetActor.deleteEmbeddedDocuments('ActiveEffect',[lastArg.effectId]);\n        }        \n    });\n    DAE.setFlag(targetActor, \"armorofAgathysHookId\", hookId);\n}\nif(args[0] === \"off\"){\n    const lastArg = args[args.length-1];\n    const targetToken = canvas.tokens.get(lastArg.tokenId);\n    const targetActor = targetToken.actor;\n    let hookFlag = DAE.getFlag(targetActor, \"armorofAgathysHookId\");\n    Hooks.off(\"midi-qol.preDamageRollCompleteGMGM\", hookFlag);\n}\n\nfunction getItemData(){\n    return {\n    \"name\": \"Armor of Agathys Damage\",\n    \"type\": \"spell\",\n    \"img\": \"icons/magic/defensive/shield-barrier-flaming-diamond-blue.webp\",\n    \"data\": {\n        \"description\": {\n            \"value\": \"<p>If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage.</p>\\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, both the temporary hit points and the cold damage increase by 5 for each slot.</p>\",\n            \"chat\": \"\",\n            \"unidentified\": \"\"\n        },\n        \"source\": \"\",\n        \"activation\": {\n            \"type\": \"special\",\n            \"cost\": 0,\n            \"condition\": \"\"\n        },\n        \"duration\": {\n            \"value\": null,\n            \"units\": \"\"\n        },\n        \"target\": {\n            \"value\": null,\n            \"width\": null,\n            \"units\": \"\",\n            \"type\": \"creature\"\n        },\n        \"range\": {\n            \"value\": null,\n            \"long\": null,\n            \"units\": \"\"\n        },\n        \"uses\": {\n            \"value\": null,\n            \"max\": \"\",\n            \"per\": \"\"\n        },\n        \"consume\": {\n            \"type\": \"\",\n            \"target\": \"\",\n            \"amount\": null\n        },\n        \"ability\": \"\",\n        \"actionType\": \"util\",\n        \"attackBonus\": 0,\n        \"chatFlavor\": \"\",\n        \"critical\": {\n            \"threshold\": null,\n            \"damage\": \"\"\n        },\n        \"damage\": {\n            \"parts\": [\n                [\n                    \"5\",\n                    \"cold\"\n                ]\n            ],\n            \"versatile\": \"\"\n        },\n        \"formula\": \"\",\n        \"save\": {\n            \"ability\": \"\",\n            \"dc\": null,\n            \"scaling\": \"spell\"\n        },\n        \"level\": 0,\n        \"school\": \"abj\",\n        \"components\": {\n            \"value\": \"\",\n            \"vocal\": false,\n            \"somatic\": false,\n            \"material\": false,\n            \"ritual\": false,\n            \"concentration\": false\n        },\n        \"materials\": {\n            \"value\": \"\",\n            \"consumed\": false,\n            \"cost\": 0,\n            \"supply\": 0\n        },\n        \"preparation\": {\n            \"mode\": \"innate\",\n            \"prepared\": false\n        },\n        \"scaling\": {\n            \"mode\": \"none\",\n            \"formula\": \"\"\n        }\n    },\n}\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"core":{"sourceId":"Item.IvVlUlXFKiL3B0ts"}}}
{"name":"Absorb Elements","type":"spell","img":"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp","data":{"description":{"value":"<div class=\"rd__b  rd__b--3\"><p>The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra [[/r 1d6]] damage of the triggering type, and the spell ends.</p><div class=\"rd__spc-inline-post\"></div></div><div class=\"rd__b  rd__b--3\"><div class=\"rd__b  rd__b--3\"><span class=\"rd__h rd__h--3\" data-title-index=\"37\"> <span class=\"entry-title-inner\">At Higher Levels.</span></span> <p>When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by [[/r 1d6]] for each slot level above 1st.</p><div class=\"rd__spc-inline-post\"></div></div><div class=\"rd__spc-inline-post\"></div></div>","chat":"","unidentified":""},"source":"XGE","activation":{"type":"reactiondamage","cost":1,"condition":"which you take when you take acid, cold, fire, lightning, or thunder damage"},"duration":{"value":1,"units":"round"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":null},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"value":"","vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"properties":{},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"dynamiceffects":{"equipActive":[true,true,true],"alwaysActive":[true,true,true]},"mess":{"templateTexture":""},"dae":{"activeEquipped":false,"alwaysActive":false},"exportSource":{"world":"waterdeep-dungeon-of-the-mad-mage","system":"dnd5e","coreVersion":"0.7.9","systemVersion":"1.2.4"},"betterRolls5e":{"quickDesc":{"type":"Boolean","value":true,"altValue":true},"quickAttack":{"type":"Boolean","value":true,"altValue":true},"quickSave":{"type":"Boolean","value":true,"altValue":true},"quickDamage":{"type":"Array","value":[],"altValue":[],"context":[]},"quickVersatile":{"type":"Boolean","value":false,"altValue":false},"quickProperties":{"type":"Boolean","value":true,"altValue":true},"quickCharges":{"type":"Boolean","value":{"use":false,"resource":true},"altValue":{"use":false,"resource":true}},"quickTemplate":{"type":"Boolean","value":true,"altValue":true},"quickOther":{"type":"Boolean","value":true,"altValue":true,"context":""},"quickFlavor":{"type":"Boolean","value":true,"altValue":true},"quickPrompt":{"type":"Boolean","value":false,"altValue":false}},"itemacro":{"macro":{"data":{"_id":null,"name":"Absorb Elements","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const tokenT = await fromUuid(args[0].tokenUuid);\nconst actorT = tokenT.actor\nconst damageType = DAE.getFlag(actorT,\"lastDamageType\")\nconst spellLeve = args[0].spellLevel\nlet effectData = [\n    {\n        \"changes\": [\n            {\n                \"key\": \"data.traits.dr.value\",\n                \"mode\": 2,\n                \"value\": damageType,\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"startTime\": null,\n            \"seconds\": 6,\n            \"rounds\": 1\n        },\n        \"icon\": \"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp\",\n        \"label\": \"Absorb Elements Resistance\",\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"dae\": {\n                \"stackable\": \"multi\",\n                \"macroRepeat\": \"none\",\n                \"specialDuration\": [\n                    \"turnStart\"\n                ]\n            },\n            \"core\": {\n                \"statusId\": \"\"\n            }\n        }\n    },\n    {\n        \"changes\": [\n            {\n                \"key\": \"data.bonuses.mwak.damage\",\n                \"mode\": 2,\n                \"value\": `${spellLeve}d6[${damageType}]`,\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.msak.damage\",\n                \"mode\": 2,\n                \"value\": `${spellLeve}d6[${damageType}]`,\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"rounds\": 1,\n            \"startTime\": null,\n            \"turns\": 1\n        },\n        \"icon\": \"icons/magic/defensive/shield-barrier-flaming-diamond-red.webp\",\n        \"label\": \"Absorb Elements Damage Bonus\",\n        \"origin\": \"Actor.8wcE3ZAikEjqIX5a\",\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"dae\": {\n                \"transfer\": true,\n                \"stackable\": \"multi\",\n                \"macroRepeat\": \"none\",\n                \"specialDuration\": [\n                    \"1Hit:mwak\",\n                    \"1Hit:msak\"\n                ]\n            },\n            \"core\": {\n                \"statusId\": \"\"\n            }\n        }\n    }\n]\nawait MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: actorT.uuid, effects: effectData});","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"onUseMacroName":"[preambleComplete]ItemMacro","effectActivation":false},"core":{"sourceId":"Item.jwe2NqmH3YX6SMVx"},"autoanimations":{"killAnim":false,"below":false,"override":false,"targetToken":{"enable":false},"sourceToken":{"enable":false},"allSounds":{},"autoOverride":{"enable":false},"version":1},"favtab":{"isFavorite":false},"cf":{"id":"temp_5o7edvfx9a","color":"#000000"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"AYXuKfr1opy9fTVq"}
{"_id":"CO60DaTpql5O7NGT","name":"Zephyr Strike","type":"spell","img":"icons/skills/movement/feet-winged-sandals-tan.webp","data":{"description":{"value":"<p>You move like the wind. For the duration, your movement doesn’t provoke opportunity attacks.</p><p>Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit. Whether you hit or miss, your walking speed increases by 30 feet until the end of that turn.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"trs","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"apt39noaq9cgdbnu","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/skills/movement/feet-winged-sandals-tan.webp","label":"Zephyr Strike","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.dOuoW7TKK0pedQzz"},"itemacro":{"macro":{"data":{"_id":null,"name":"Zephyr Strike","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const itemData = {\n    \"name\": \"Zephyr Strike Activation\",\n    \"type\": \"spell\",\n    \"img\": \"icons/skills/movement/feet-winged-sandals-tan.webp\",\n    \"data\": {\n        \"description\": {\n            \"value\": \"<p>Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit. Whether you hit or miss, your walking speed increases by 30 feet until the end of that turn.</p>\",\n            \"chat\": \"\",\n            \"unidentified\": \"\"\n        },\n        \"source\": \"\",\n        \"activation\": {\n            \"type\": \"special\",\n            \"cost\": 0,\n            \"condition\": \"\"\n        },\n        \"duration\": {\n            \"value\": null,\n            \"units\": \"\"\n        },\n        \"target\": {\n            \"value\": null,\n            \"width\": null,\n            \"units\": \"\",\n            \"type\": \"self\"\n        },\n        \"range\": {\n            \"value\": null,\n            \"long\": null,\n            \"units\": \"self\"\n        },\n        \"uses\": {\n            \"value\": 1,\n            \"max\": \"1\",\n            \"per\": \"charges\"\n        },\n        \"consume\": {\n            \"type\": \"\",\n            \"target\": \"\",\n            \"amount\": null\n        },\n        \"ability\": null,\n        \"actionType\": \"\",\n        \"attackBonus\": 0,\n        \"chatFlavor\": \"\",\n        \"critical\": {\n            \"threshold\": null,\n            \"damage\": \"\"\n        },\n        \"damage\": {\n            \"parts\": [],\n            \"versatile\": \"\"\n        },\n        \"formula\": \"\",\n        \"save\": {\n            \"ability\": \"\",\n            \"dc\": null,\n            \"scaling\": \"spell\"\n        },\n        \"level\": 0,\n        \"school\": \"trs\",\n        \"components\": {\n            \"value\": \"\",\n            \"vocal\": false,\n            \"somatic\": false,\n            \"material\": false,\n            \"ritual\": false,\n            \"concentration\": false\n        },\n        \"materials\": {\n            \"value\": \"\",\n            \"consumed\": false,\n            \"cost\": 0,\n            \"supply\": 0\n        },\n        \"preparation\": {\n            \"mode\": \"innate\",\n            \"prepared\": false\n        },\n        \"scaling\": {\n            \"mode\": \"none\",\n            \"formula\": \"\"\n        }\n    },\n    \"effects\": [\n        {\n            \"_id\": \"rthob0fj1ap0mx2f\",\n            \"changes\": [\n                {\n                    \"key\": \"flags.midi-qol.advantage.attack.mwak\",\n                    \"mode\": 2,\n                    \"value\": \"0\",\n                    \"priority\": \"20\"\n                },\n                {\n                    \"key\": \"flags.midi-qol.advantage.attack.rwak\",\n                    \"mode\": 2,\n                    \"value\": \"0\",\n                    \"priority\": \"20\"\n                },\n                {\n                    \"key\": \"data.bonuses.mwak.damage\",\n                    \"mode\": 2,\n                    \"value\": \"1d8[force]\",\n                    \"priority\": \"20\"\n                },\n                {\n                    \"key\": \"data.bonuses.rwak.damage\",\n                    \"mode\": 2,\n                    \"value\": \"1d8[force]\",\n                    \"priority\": \"20\"\n                }\n            ],\n            \"disabled\": false,\n            \"duration\": {\n                \"startTime\": null,\n                \"turns\": 1\n            },\n            \"icon\": \"icons/skills/movement/feet-winged-sandals-tan.webp\",\n            \"label\": \"Zephyr Strike Activation\",\n            \"transfer\": false,\n            \"flags\": {\n                \"core\": {\n                    \"statusId\": \"\"\n                },\n                \"dae\": {\n                    \"stackable\": \"none\",\n                    \"durationExpression\": \"\",\n                    \"macroRepeat\": \"none\",\n                    \"specialDuration\": [\n                        \"1Attack:mwak\",\n                        \"1Attack:rwak\"\n                    ],\n                    \"transfer\": false\n                }\n            },\n            \"tint\": null,\n            \"selectedKey\": [\n                \"flags.midi-qol.advantage.attack.mwak\",\n                \"flags.midi-qol.advantage.attack.rwak\",\n                \"data.bonuses.mwak.damage\",\n                \"data.bonuses.rwak.damage\"\n            ]\n        },\n        {\n            \"_id\": \"vcd9zrlve195c910\",\n            \"changes\": [\n                {\n                    \"key\": \"data.attributes.movement.walk\",\n                    \"mode\": 2,\n                    \"value\": \"30\",\n                    \"priority\": \"20\"\n                }\n            ],\n            \"disabled\": false,\n            \"duration\": {\n                \"startTime\": null,\n                \"turns\": 1\n            },\n            \"icon\": \"icons/skills/movement/feet-winged-sandals-tan.webp\",\n            \"label\": \"Zephyr Strike Activation\",\n            \"transfer\": false,\n            \"flags\": {\n                \"core\": {\n                    \"statusId\": \"\"\n                },\n                \"dae\": {\n                    \"stackable\": \"none\",\n                    \"durationExpression\": \"\",\n                    \"macroRepeat\": \"none\",\n                    \"specialDuration\": [],\n                    \"transfer\": false\n                }\n            },\n            \"tint\": null,\n            \"selectedKey\": \"data.attributes.movement.walk\"\n        }\n    ],\n};\nconst lastArgs = args[args.length-1];\nconst tokenU = await fromUuid(lastArgs.tokenUuid);\nconst actorU = tokenU.actor;\nif(args[0] === \"on\"){\n    let ZephyrStrikeActivation = await actorU.createEmbeddedDocuments(\"Item\",[itemData]);\n    DAE.setFlag(actorU,\"ZephyrStrikeActivationId\",ZephyrStrikeActivation[0].id)\n}\nif(args[0] === \"off\"){\n    actorU.deleteEmbeddedDocuments(\"Item\",[DAE.getFlag(actorU,\"ZephyrStrikeActivationId\")]);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"_id":"F4cZMbverIA1IHvU","name":"Ensnaring Strike","type":"spell","img":"icons/magic/nature/root-vine-entangle-foot-green.webp","data":{"description":{"value":"<p>The next time you hit a creature with a weapon attack before this spell ends, a writhing mass of thorny vines appears at the point of impact, and the target must succeed on a Strength saving throw or be restrained by the magical vines until the spell ends. A Large or larger creature has advantage on this saving throw. If the target succeeds on the save, the vines shrivel away.</p><p>While restrained by this spell, the target takes 1d6 piercing damage at the start of each of its turns. A creature restrained by the vines or one that can touch the creature can use its action to make a Strength check against your spell save DC. On a success, the target is freed.</p><p><strong><em>At Higher Levels.</em></strong> If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"d8hf8hz9yqciksx4","changes":[{"key":"flags.dnd5e.DamageBonusMacro","mode":0,"value":"ItemMacro.Ensnaring Strike","priority":"20"},{"key":"flags.midi-qol.ensnaringStrike.level","mode":5,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/nature/root-vine-entangle-foot-green.webp","label":"Ensnaring Strike","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Hit:mwak","1Hit:rsak"],"transfer":false}},"tint":null,"selectedKey":["flags.dnd5e.DamageBonusMacro","__"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.v0bhq7o1GcSxWiPv"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":true,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Ensnaring Strike","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nif (![\"mwak\",\"rwak\"].includes(lastArg.item.data.actionType)) return;\nif (lastArg.hitTargetUuids.length <1) return;\nlet DC = actor.data.data.attributes.spelldc;\nconst spellLevel = actor.data.flags[\"midi-qol\"].ensnaringStrike.level;\nconst concentrationUuid = lastArg.sourceItemUuid\nfor (let tokenUuid of lastArg.hitTargetUuids) {\n    const target = await fromUuid(tokenUuid);\n    const targetActor = target.actor;    \n    const effectData = {\n        label: \"Restrained\", \n        changes: [\n          {\"key\": \"flags.midi-qol.OverTime\", \"mode\": 0, \"value\": `\"turn=start,damageRoll=1d6,damageType=piercing,label=Restrained\" `, \"priority\": \"20\"},\n          {\"key\": \"macro.itemMacro.GM\",\"mode\": 0,\"value\": \"\",\"priority\": \"20\"},\n           {\n        \"key\": \"data.attributes.movement.walk\",\n        \"value\": \"0\",\n        \"mode\": 5,\n        \"priority\": \"20\"\n    },\n    {\n        \"key\": \"flags.midi-qol.disadvantage.attack.all\",\n        \"value\": \"0\",\n        \"mode\": 2,\n        \"priority\": \"20\"\n    },\n    {\n        \"key\": \"flags.midi-qol.grants.advantage.attack.all\",\n        \"value\": \"0\",\n        \"mode\": 2,\n        \"priority\": \"20\"\n    },\n    {\n        \"key\": \"flags.midi-qol.disadvantage.ability.save.dex\",\n        \"value\": \"0\",\n        \"mode\": 2,\n        \"priority\": \"20\"\n    }\n        ],  \n        origin: concentrationUuid, \n        disabled: false,\n        icon: \"icons/magic/nature/root-vine-entangle-foot-green.webp\",\n        duration: { rounds: 10, seconds: 60},\n        flags: {\n            \"dae\": {\n                \"stackable\": \"none\",\n                \"durationExpression\": \"\",\n                \"macroRepeat\": \"startEveryTurn\",\n                \"specialDuration\": [],\n                \"transfer\": false,\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": `const lastArg = args[args.length-1];\n                                                const target = await fromUuid(lastArg.tokenUuid); \n                                                const targetActor = target.actor;                                          \n                                                if(args[0] === \"on\"){\n                                                    let origin = await fromUuid(lastArg.origin);\n                                                    let effectUuid = lastArg.actorUuid + \".ActiveEffect.\" + lastArg.effectId;\n                                                    let removeUuids = getProperty(origin.actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n                                                    removeUuids = removeUuids.concat([effectUuid]);\n                                                    if (removeUuids.length > 0) origin.actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n                                                    console.log({lastArg,origin,effectUuid})\n                                                }`\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n      }\n      const flavor = `<p>${\"Strength Saving Throw\"}</p><p>${CONFIG.DND5E.abilities[\"str\"]} DC ${DC} </P> `;\n      let strSave = (await targetActor.rollAbilitySave(\"str\", { flavor, fastForward: false})).total;\n      if(strSave<DC){\n        await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetActor.uuid, effects: [effectData]})\n      }\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Chromatic Orb","type":"spell","img":"icons/magic/control/buff-luck-fortune-rainbow.webp","data":{"description":{"value":"<p>You hurl a 4-inch-diameter sphere of energy at a creature that you can see within range. You choose acid, cold, fire, lightning, poison, or thunder for the type of orb you create, and then make a ranged spell attack against the target. If the attack hits, the creature takes 3d8 damage of the type you chose.</p>\n<p> </p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":20,"damage":""},"damage":{"parts":[["3d8","cold"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[preDamageRoll]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Chromatic Orb","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const tokenU = await fromUuid(args[0].tokenUuid);\n  const actorU = tokenU.actor;\n  const targets = args[0].hitTargets;\n  const spellLevel = args[0].spellLevel;\n  const isCritical = args[0].isCritical;\n  let numDice = isCritical?4+2*spellLevel:2+spellLevel\n  if(targets.length < 1)return;\n  await Dialog.prompt({\n    title: 'Chromatic Orb',\n    content: `\n        <div class=\"form-group\">\n          <label for=\"exampleSelect\">Selecione o Elemento</label>\n          <select name=\"exampleSelect\">\n            <option value=\"acid\">Acid</option>\n            <option value=\"cold\">Cold</option>\n            <option value=\"fire\">Fire</option>\n            <option value=\"lightning\">Lightning</option>\n            <option value=\"poison\">Poison</option>\n          </select>\n        </div>\n    `,\n        callback: async(html) => {\n          let select = html.find('[name=\"exampleSelect\"]').val();\n          let damageType = select;\n          const theItem = await fromUuid(args[0].uuid);\n          theItem.data.data.damage.parts[0][1] = damageType                    \n      }        \n    }\n)","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"core":{"sourceId":"Item.PKEEG0cXVlzlbHlu"}},"_id":"HElSdh0Lv2tN4Chi"}
{"_id":"HWKXHdb1y105VFWf","name":"Wrathful Smite","type":"spell","img":"icons/magic/control/fear-fright-shadow-monster-red.webp","data":{"description":{"value":"<p>The next time you hit with a melee weapon attack during this spell’s duration, your attack deals an extra 1d6 psychic damage. Additionally, if the target is a creature, it must make a Wisdom saving throw or be frightened of you until the spell ends. As an action, the creature can make a Wisdom check against your spell save DC to steel its resolve and end this spell.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"2y4zska4xvw6xnp1","changes":[{"key":"flags.dnd5e.DamageBonusMacro","mode":0,"value":"ItemMacro.Wrathful Smite","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/control/fear-fright-shadow-monster-red.webp","label":"Wrathful Smite","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Hit:mwak"],"transfer":false}},"tint":null,"selectedKey":"flags.dnd5e.DamageBonusMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.iWH4rVhG5ZZ3RDai"},"itemacro":{"macro":{"data":{"_id":null,"name":"Wrathful Smite","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nif (lastArg.item.data.actionType != \"mwak\") return;\nif (lastArg.hitTargetUuids.length <1) return;\nconst spellDC = actor.data.data.attributes.spelldc;\nconst target = lastArg.hitTargets[0].object\nconst concentrationUuid = lastArg.sourceItemUuid\nconst effectData = {\n        changes: [\n            {\"key\": \"macro.itemMacro.GM\",\"mode\": 0,\"value\": \"\",\"priority\": \"20\"},\n            {\"key\": \"flags.midi-qol.disadvantage.attack.all\",\"value\": \"0\",\"mode\": 2,\"priority\": \"20\"},\n            {\"key\": \"flags.midi-qol.disadvantage.ability.all\",\"value\": \"0\",\"mode\": 2,\"priority\": \"20\"},\n        ], \n    \"disabled\": false,\n    \"duration\": {\n        \"rounds\": 10\n    },\n    \"icon\": \"icons/magic/control/fear-fright-shadow-monster-red.webp\",\n    \"label\": \"Frightened \",\n    \"tint\": \"\",\n    \"transfer\": false,\n    flags: {\n            \"dae\": {\n                \"stackable\": \"none\",\n                \"durationExpression\": \"\",\n                \"macroRepeat\": \"startEveryTurn\",\n                \"specialDuration\": [],\n                \"transfer\": false,\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\":\n                                        `if(args[0] === \"on\"){    \n                                            const lastArg = args[args.length-1];\n                                            const originTokenId = \"${lastArg.tokenId}\";\n                                            const targetToken = canvas.tokens.get(lastArg.tokenId);\n                                            const origin = canvas.tokens.get(originTokenId);\n                                            const targetActor = targetToken.actor;                                            \n                                            let hookId = Hooks.on('preUpdateToken',(tokenDocument, change, options, userId)=>{\n                                                if (change._id != targetToken.id) return;\n                                                if(game.combat?.current.tokenId != targetToken.id) return;\n                                                if (!(\"x\" in change || \"y\" in change)) return;\n                                                let targetLocationX = change.x ?? targetToken.data.x;\n                                                let targetLocationY = change.y ?? targetToken.data.y;\n                                                let targetLocation = {x:targetLocationX,y:targetLocationY};\n                                                let actualDistance = canvas.grid.measureDistance(targetToken,origin);\n                                                let targetDistance = canvas.grid.measureDistance(targetLocation,origin);\n                                                if (targetDistance<actualDistance){\n                                                    ui.notifications.warn(\\`Due to the effect of Wrathful Smite \\${targetActor.data.name} cannot willingly move closer to \\${origin.data.name}\\`);\n                                                    return false;\n                                                }\n                                            });\n                                            DAE.setFlag(targetActor,\"WrathfulSmiteHookId\",hookId);\n                                            let effectUuid = targetActor.uuid + \".ActiveEffect.\" + lastArg.effectId\n                                            addToRemoveConcentration(targetActor,effectUuid)\n                                            function addToRemoveConcentration(actor,...uuids){\n                                                let removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n                                                removeUuids = removeUuids.concat(uuids);\n                                                if (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n                                            }\n                                        }\n\n                                        if(args[0] === \"off\"){   \n                                            const lastArg = args[args.length-1] \n                                            const targetToken = canvas.tokens.get(lastArg.tokenId);\n                                            const targetActor = targetToken.actor;\n                                            Hooks.off(\"preUpdateToken\",DAE.getFlag(targetActor,\"WrathfulSmiteHookId\"))\n\n                                        }`\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n}\nconst flavor = `<p>${\"Wisdom Saving Throw\"}</p><p>${CONFIG.DND5E.abilities[\"wis\"]} DC ${spellDC} </P> `;\nlet wisSave = (await target.actor.rollAbilitySave(\"wis\", { flavor, fastForward: false})).total;\nif(wisSave<spellDC){\n    await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: target.actor.uuid, effects: [effectData]})\n}\nlet damageRoll;\nlastArg.isCritical ? damageRoll = 2 : damageRoll = 1;\nreturn{damageRoll: `${damageRoll}d6[psychic]`, flavor: \"Wrathful Smite\"}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"_id":"JGgEYvUs4ojDJiSR","name":"Magic Missile","type":"spell","img":"systems/dnd5e/icons/spells/fire-arrows-magenta-1.jpg","data":{"description":{"value":"<p>You create three glowing darts of magical force. Each dart hits a creature of your choice that you can see within range. A dart deals 1d4 + 1 force damage to its target. The darts all strike simultaneously, and you can direct them to hit one creature or several.</p><p><strong>Higher Levels. </strong>When you cast this spell using a spell slot of 2nd level or higher, the spell creates one more dart for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 257","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.41JIhpDyM9Anm7cs"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Magic Missile","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const casterToken = await fromUuid(args[0].tokenUuid);\nconst casterActor = casterToken.actor;\nlet targets = []\nlet missiles = 2+args[0].spellLevel\nif(args[0].targets.length < 2){\n    dealDamage(args[0].targets[0],missiles)\n    return;\n}\nlet table = `<p style=\"font-size:15px;\">You have a total of ${missiles} missiles</p><p><table><tr><th>Target</th><th style=\"text-align:left;\">Missiles</td></tr>`\nfor(let target of args[0].targets){\n    table += `<tr><td style=\"text-align:center;\">${target.name}</td><td><input type=\"num\" id=\"target\" min=\"0\" max=\"${missiles}\" name=\"${target.uuid}\"></td></tr>`;\n}\ntable += \"</table>\"\nnew Dialog({\n    title: \"Magic Missiles\",\n    content: table,\n    buttons: {\n      ok: {\n        icon: '<i class=\"fas fa-check\"></i>',\n        label: 'Ok',\n        callback: async(html)=>{\n            let targetsHtml = html.find('input#target');\n            for(let targetHtml of targetsHtml){                \n                let target = await fromUuid(targetHtml.name)\n                let missilesTarget = targetHtml.value\n                if(missiles < missilesTarget){                    \n                    await dealDamage(target,missiles)\n                    ui.notifications.warn('You entered an amount of missiles bigger than available')\n                    return\n                }\n                missiles -= missilesTarget;\n                await dealDamage(target,missilesTarget)\n            }\n        }\n      },\n    }\n  }).render(true);\nasync function dealDamage(target,dices){\n    if(dices < 1)return;\n    let [item]= await casterActor.createEmbeddedDocuments(\"Item\",[getItemData(dices)])\n    await MidiQOL.completeItemRoll(item,{targetUuids: [target.uuid]})\n    casterActor.deleteEmbeddedDocuments(\"Item\",[item.id])\n}\nfunction getItemData(dices){\n    return {\n        \"name\": \"Magic Missile Damage\",\n        \"type\": \"spell\",\n        \"data\": {\n            \"description\": {\n                \"value\": \"\",\n                \"chat\": \"\",\n                \"unidentified\": \"\"\n            },\n            \"activation\": {\n                \"type\": \"none\",\n                \"cost\": 0,\n                \"condition\": \"\"\n            },\n            \"ability\": \"\",\n            \"actionType\": \"util\",\n            \"attackBonus\": 0,\n            \"chatFlavor\": \"\",\n            \"critical\": {\n                \"threshold\": null,\n                \"damage\": \"\"\n            },\n            \"damage\": {\n                \"parts\": [\n                    [\n                        `${dices}d4+${dices}`,\n                        \"force\"\n                    ]\n                ],\n                \"versatile\": \"\",\n                \"value\": \"\"\n            },\n            \"formula\": \"\",\n            \"save\": {\n                \"ability\": \"\",\n                \"dc\": null,\n                \"scaling\": \"spell\",\n                \"value\": \"\"\n            },\n            \"level\": 0,\n            \"school\": \"evo\",\n            \"preparation\": {\n                \"mode\": \"innate\",\n                \"prepared\": true\n            },\n            \"attunement\": 0\n        },\n        \"flags\":{\n            \"dnd5e\":{\n                \"spellId\":\"Magic Missile\"\n            }\n        },\n        \"img\": `${args[0].item.img}`,\n    }\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Entangle","type":"spell","img":"systems/dnd5e/icons/spells/vines-acid-2.jpg","data":{"description":{"value":"<p>Grasping weeds and vines sprout from the ground in a 20-foot square starting from a point within range. For the Duration, these Plants turn the ground in the area into difficult terrain.</p><p>A creature in the area when you cast the spell must succeed on a Strength saving throw or be Restrained by the entangling Plants until the spell ends. A creature restrained by the plants can use its action to make a Strength check against your spell save DC. On a success, it frees itself.</p><p>When the spell ends, the conjured Plants wilt away.</p>","chat":"","unidentified":""},"source":"PHB pg. 238","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"square"},"range":{"value":90,"long":0,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"str","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":0},"effects":[{"_id":"5xot5xlbv0q00ovd","changes":[{"key":"data.attributes.movement.all","mode":0,"value":"-100","priority":"20"},{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.ability.save.dex","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"icons/svg/net.svg","label":"Restrained","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.attributes.movement.all","flags.midi-qol.disadvantage.attack.all","flags.midi-qol.grants.advantage.attack.all","flags.midi-qol.disadvantage.ability.save.dex"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.gMrWeG8fMDPRFiVe"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"LoCH3TUN9qe1rnVW"}
{"name":"Earth Tremor","type":"spell","img":"icons/magic/earth/barrier-stone-explosion-debris.webp","data":{"description":{"value":"<p>You cause a tremor in the ground in a 10-foot radius. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone. If the ground in that area is loose earth or stone, it becomes difficult terrain until cleared.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything/Elemental Evil Player's Companion","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":10,"width":null,"units":"ft","type":"creature"},"range":{"value":null,"long":null,"units":"spec"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d6","bludgeoning"]],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"V,","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[{"_id":"vjuqf8s8plmm9bxw","changes":[{"key":"flags.midi-qol.grants.advantage.attack.mwak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.msak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"data.attributes.movement.walk","mode":1,"value":"0.5","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":1},"icon":"icons/svg/falling.svg","label":"Prone","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["flags.midi-qol.grants.advantage.attack.mwak","flags.midi-qol.grants.advantage.attack.msak","flags.midi-qol.disadvantage.attack.all","data.attributes.movement.walk"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.NLWOOfguoboQOaRX"},"midi-qol":{"effectActivation":false,"onUseMacroName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"MoDMVRwidt6I9ko6"}
{"name":"Sleep","type":"spell","img":"systems/dnd5e/icons/spells/light-magenta-1.jpg","data":{"description":{"value":"<p>This spell sends creatures into a magical slumber. Roll 5d8; the total is how many hit points of creatures this spell can affect. Creatures within 20 feet of a point you choose within range are affected in ascending order of their current hit points (ignoring unconscious creatures).</p><p>Starting with the creature that has the lowest current hit points, each creature affected by this spell falls unconscious until the spell ends, the sleeper takes damage, or someone uses an action to shake or slap the sleeper awake. Subtract each creature's hit points from the total before moving on to the creature with the next lowest hit points. A creature's hit points must be equal to or less than the remaining total for that creature to be affected.</p><p>Undead and creatures immune to being charmed aren't affected by this spell.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, roll an additional 2d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 276","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"sphere"},"range":{"value":90,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["5d8","midi-none"]],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A pinch of fine sand, rose petals, or a cricket.","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"2d8"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.KhwiSi9fwVfUPtku"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Sleep","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"let targets = args[0].targets\nif(targets.length<1)return;\nlet hp_pool = args[0].damageTotal;\ntargets.sort(function(a,b){return a.actor.data.data.attributes.hp.value - b.actor.data.data.attributes.hp.value});\nfor (let target of targets){\n    if (!isUnconscious(target)){\n        if (!isImumune(target)){\n            if (target.actor.data.data.attributes.hp.value <= hp_pool){\n                const effectData = {\n                    changes: [\n                    { key: `flags.midi-qol.grants.critical.mwak`, mode: 2, value: 1, priority: 20 },\n                    { key: `flags.midi-qol.grants.advantage.attack.all`, mode: 2, value: 1, priority: 20 },\n                    { key: `flags.midi-qol.fail.ability.save.str`, mode: 2, value: 1, priority: 20 },\n                    { key: `flags.midi-qol.fail.ability.save.dex`, mode: 2, value: 1, priority: 20 },\n                    { key: `data.attributes.movement.all`, mode: 0, value: -100, priority: 20 }\n                    ],\n                    disabled: false,\n                    duration: {rounds: 10 , seconds: 60, startRound: undefined, startTime: undefined, startTurn: undefined, turns: undefined},\n                    icon: \"systems/dnd5e/icons/spells/light-magenta-1.jpg\",\n                    label: \"Unconscious\",\n                    tint: null,\n                    transfer: false,\n                    flags: {dae : {specialDuration: [\"isDamaged\"]}}\n                }\n                await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: target.actor.uuid, effects: [effectData]})             \n\n            }\n    hp_pool -= target.actor.data.data.attributes.hp.value\n    }}\n}\nfunction isImumune(token){\n    if (token.actor.data.data.details.race?.toLowerCase().includes('elf'))return true;\n    if (token.actor.data.data.details.race?.toLowerCase().includes('drow'))return true;\n    if (token.actor.data.data.details.type?.value.toLowerCase().includes('undead'))return true;\n   \tif (token.actor.data.data.traits.ci.value.includes('charmed'))return true;\n    if (token.actor.data.data.traits.ci.value.includes('sleep'))return true;\n    return false;\n}\nfunction isUnconscious(token){\n    if(token.actor.data.effects.find(i=>i.data.label === 'Unconscious' && !i.data.disabled))return true;\n    if(token.actor.data.effects.find(i=>i.data.label === 'Sleep' && !i.data.disabled))return true;\n    if(token.actor.data.effects.find(i=>i.data.label === 'Asleep' && !i.data.disabled))return true;\n    return false;\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"Mug7h3hZnNKNOj4f"}
{"name":"Heroism","type":"spell","img":"systems/dnd5e/icons/spells/heal-sky-2.jpg","data":{"description":{"value":"<p>A willing creature you touch is imbued with bravery. Until the spell ends, the creature is immune to being Frightened and gains Temporary Hit Points equal to your Spellcasting ability modifier at the start of each of its turns. When the spell ends, the target loses any remaining temporary hit points from this spell.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 250","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["@mod","temphp"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"2dlmraygacqqur84","changes":[{"key":"data.traits.ci.value","mode":2,"value":"frightened","priority":"20"},{"key":"flags.midi-qol.OverTime","mode":2,"value":"turn=start,damageRoll=@mod,damageType=temphp,label=Heroism","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/heal-sky-2.jpg","label":"Heroism","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.traits.ci.value","flags.midi-qol.OverTime"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.ge3Saet9zPTDyaoL"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"OfuWWlEzVrVWjrxR"}
{"_id":"PH0MAFWDssFOwUJf","name":"Fog Cloud","type":"spell","img":"systems/dnd5e/icons/spells/fog-water-air-2.jpg","data":{"description":{"value":"<p>You create a 20-foot-radius Sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the Duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the radius of the fog increases by 20 feet for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 243","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":20,"width":null,"units":"ft","type":"sphere"},"range":{"value":120,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.IBJmWjzbQGu7M4UX"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Fog Cloud","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"//Transfer macro to socket()\n\nconst template = await fromUuid(args[0].templateUuid)\nconst spellLevel = args[0].spellLevel\nlightData = {\n    \"_id\": \"zBfFhJGxeV8Sxtv8\",\n    \"x\": template.data.x,\n    \"y\": template.data.y,\n    \"rotation\": 0,\n    \"walls\": true,\n    \"vision\": false,\n    \"config\": {\n        \"alpha\": 1,\n        \"angle\": 0,\n        \"bright\": 0,\n        \"coloration\": 1,\n        \"dim\": 20*spellLevel,\n        \"gradual\": true,\n        \"luminosity\": -0.25,\n        \"saturation\": 0,\n        \"contrast\": 0,\n        \"shadows\": 0,\n        \"animation\": {\n            \"speed\": 5,\n            \"intensity\": 5,\n            \"reverse\": false,\n            \"type\": \"ghost\"\n        },\n        \"darkness\": {\n            \"min\": 0,\n            \"max\": 1\n        },\n        \"color\": \"#002020\"\n    },\n    \"hidden\": false,\n}\nlet [fogCloudLight] = await canvas.scene.createEmbeddedDocuments(\"AmbientLight\",[lightData])\naddToRemoveConcentration(actor,fogCloudLight.uuid)\n\nfunction addToRemoveConcentration(actor,...uuids){\n    let removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n    removeUuids = removeUuids.concat(uuids);\n    if (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Ray Of Sickness","type":"spell","img":"icons/magic/unholy/projectile-missile-green.webp","data":{"description":{"value":"<p>A ray of sickening greenish energy lashes out toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 poison damage and must make a Constitution saving throw. On a failed save, it is also poisoned until the end of your next turn.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d8","poison"]],"versatile":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell"},"level":1,"school":"nec","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[{"_id":"j6ogd8fmprcd58ob","changes":[{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.ability.check.all","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":1,"turns":1},"icon":"icons/svg/poison.svg","label":"Poisoned","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["flags.midi-qol.disadvantage.attack.all","flags.midi-qol.disadvantage.ability.check.all"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.A9EEhxycTUOiILCL"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":true,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"RSf8S1t6KPEjeUQl"}
{"name":"Compelled Duel","type":"spell","img":"icons/skills/melee/weapons-crossed-swords-black-gray.webp","data":{"description":{"value":"<p>You attempt to compel a creature into a duel. One creature that you can see within range must make a Wisdom saving throw. On a failed save, the creature is drawn to you, compelled by your divine demand. For the duration, it has disadvantage on attack rolls against creatures other than you, and must make a Wisdom saving throw each time it attempts to move to a space that is more than 30 feet away from you; if it succeeds on this saving throw, this spell doesn’t restrict the target’s movement for that turn.</p>\n<p> </p>\n<p>The spell ends if you attack any other creature, if you cast a spell that targets a hostile creature other than the target, if a creature friendly to you damages the target or casts a harmful spell on it, or if you end your turn more than 30 feet away from the target.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"bonus","cost":0,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"gwxxayuc9powqth2","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"@token @attributes.spelldc","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"icons/skills/melee/weapons-crossed-swords-black-gray.webp","label":"Compelled Duel","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"itemacro":{"macro":{"data":{"_id":null,"name":"Compelled Duel","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] === \"on\"){    \n    const lastArg = args[args.length-1]\n    const originTokenId = args[1]\n    const targetToken = canvas.tokens.get(lastArg.tokenId);\n    const origin = canvas.tokens.get(originTokenId);\n    const targetActor = targetToken.actor;\n    const dc = args[2]    \n    let hookId = Hooks.on(\"midi-qol.preItemRollGM\", async(workflow) => {\n        if(lastArg.tokenId != workflow.tokenId)return;\n        let targets = Array.from(workflow.targets);\n        let ids = [];    \n        for(let target of targets){\n            ids.push(target.id)\n        }\n        if(ids.includes(originTokenId))return;\n        workflow.disadvantage = true\n        return;\n    });\n    DAE.setFlag(targetActor,\"CompelledDuelHookId\",hookId);\n    let hookId2 = Hooks.on('preUpdateTokenGM',(tokenDocument, change, options, userId)=>{\n        if (change._id != targetToken.id) return;\n        if(game.combat?.current.tokenId != targetToken.id) return;\n        if (!(\"x\" in change || \"y\" in change)) return;\n        let targetLocationX = change.x ?? targetToken.data.x;\n        let targetLocationY = change.y ?? targetToken.data.y;\n        let targetLocation = {x:targetLocationX,y:targetLocationY};\n        let distance = canvas.grid.measureDistance(targetLocation,origin);\n        if(distance > 30){\n            if(DAE.getFlag(targetActor,\"CompelledDuelLastSave\")){\n                if(DAE.getFlag(targetActor,\"CompelledDuelLastSave\")[0] == game.combat?.current.round) return DAE.getFlag(targetActor,\"CompelledDuelLastSave\")[1];\n            }\n            let wisSaveBonus = targetActor.data.data.abilities.wis.save;\n            let saveRoll = new Roll(`1d20+${wisSaveBonus}`).evaluate({async:false});\n            let flavor = \"\";\n            if(saveRoll.total < dc){\n                flavor = `<h2><img src=\"icons/skills/melee/weapons-crossed-swords-black-gray.webp\" width=\"35\" height=\"35\">Compelled Duel Movement Restriction</h2><p style=\"font-size: larger\">Due to the effect of Compelled Duel ${targetActor.data.name} cannot willingly move to more dan 30 feet away from ${origin.data.name}<p>Wisdom saving throw<p style=\"font-size:15px;color:red\">DC: ${dc}`;\n                saveRoll.toMessage({flavor:flavor});\n                ui.notifications.warn(`Due to the effect of Compelled Duel ${targetActor.data.name} cannot willingly move to more dan 30 feet away from ${origin.data.name}`);\n                DAE.setFlag(targetActor,\"CompelledDuelLastSave\",[game.combat?.current.round,false]);\n                return false;\n            }\n            else{\n                flavor = `<h2><img src=\"icons/skills/melee/weapons-crossed-swords-black-gray.webp\" width=\"35\" height=\"35\">Compelled Duel Movement Restriction</h2><p>Wisdom saving throw<p style=\"font-size:15px;color:green\">DC: ${dc}`;\n                saveRoll.toMessage({flavor:flavor});\n                DAE.setFlag(targetActor,\"CompelledDuelLastSave\",[game.combat?.current.round,true]);\n            }\n        }\n    });\n    DAE.setFlag(targetActor,\"CompelledDuelHookId2\",hookId2);\n}\n\nif(args[0] === \"off\"){   \n    const lastArg = args[args.length-1] \n    const targetToken = canvas.tokens.get(lastArg.tokenId);\n    const targetActor = targetToken.actor;\n    Hooks.off(\"midi-qol.preItemRollGM\",DAE.getFlag(targetActor,\"CompelledDuelHookId\"))\n    Hooks.off(\"preUpdateTokenGM\",DAE.getFlag(targetActor,\"CompelledDuelHookId2\"))\n    Hooks.off(\"preUpdateCombat\",DAE.getFlag(targetActor,\"CompelledDuelHookId3\"))\n    Hooks.off(\"midi-qol.RollComplete\",DAE.getFlag(targetActor,\"CompelledDuelHookId4\"))\n}\n\nif(args[0].macroPass === 'postActiveEffects'){\n    if(args[0].failedSaves.length<1)return;\n    let hookId3 = Hooks.on('preUpdateCombat',(combat,update,options,userId)=>{\n        if(args[0].tokenId != combat.current.tokenId)return;\n        if(canvas.grid.measureDistance(args[0].failedSaves[0].object,token)<=30)return;\n        let concentrating = token.actor.effects.find(i=>i.data.label === \"Concentrating\");\n        token.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[concentrating.id]);\n    })\n    DAE.setFlag(args[0].failedSaves[0].actor,\"CompelledDuelHookId3\",hookId3)    \n    let hookId4 = Hooks.on('midi-qol.RollComplete',(workflow)=>{\n        let abilityTargets = Array.from(workflow.targets)\n        if(workflow.token.id === token.id){            \n            if(abilityTargets[0].id === args[0].failedSaves[0].id && abilityTargets.length < 2)return;\n            for(let abilityTarget of abilityTargets){\n                if(abilityTargets[0].data.disposition === args[0].failedSaves[0].data.disposition){\n                            let concentrating = token.actor.effects.find(i=>i.data.label === \"Concentrating\");\n                            token.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[concentrating.id]);\n                }\n            }\n        }    \n        if(abilityTargets.includes(args[0].failedSaves[0].object) && workflow.token.data.disposition === token.data.disposition){\n            let concentrating = token.actor.effects.find(i=>i.data.label === \"Concentrating\");\n            token.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[concentrating.id]);\n        }\n    })\n    DAE.setFlag(args[0].failedSaves[0].actor,\"CompelledDuelHookId4\",hookId4)\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"core":{"sourceId":"Item.3qhRdrqcSFHe7O8Y"}},"_id":"ScABMgC7VMNvnOfG"}
{"name":"Cure Wounds","type":"spell","img":"systems/dnd5e/icons/spells/heal-jade-1.jpg","data":{"description":{"value":"<p>A creature you touch regains a number of hit points equal to 1d8 + your spellcasting ability modifier. This spell has no effect on undead or constructs.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the healing increases by 1d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 230","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":0,"per":""},"consume":{"type":"","target":null,"amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8 + @mod","healing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.uUWb1wZgtMou0TVP"}},"_id":"SviRsPERRmgOLnAA"}
{"_id":"Ua843IaV1oLDKk6Z","name":"Thunderwave","type":"spell","img":"systems/dnd5e/icons/spells/lightning-jade-1.jpg","data":{"description":{"value":"<p>A wave of thunderous force sweeps out from you. Each creature in a 15-foot cube originating from you must make a Constitution saving throw. On a failed save, a creature takes 2d8 thunder damage and is pushed 10 feet away from you. On a successful save, the creature takes half as much damage and isn't pushed.</p><p>In addition, unsecured objects that are completely within the area of effect are automatically pushed 10 feet away from you by the spell's effect, and the spell emits a thunderous boom audible out to 300 feet.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 282","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":5,"width":null,"units":"ft","type":"creature"},"range":{"value":null,"long":null,"units":"spec"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d8","thunder"]],"versatile":""},"formula":"","save":{"ability":"con","dc":0,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[{"_id":"21n6rc2an3577t5v","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"@token","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/lightning-jade-1.jpg","label":"Thunderwave","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.WTbOQBsarsL1LuXJ"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":true,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Thunderwave","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0]===\"on\"){\n    const lastArg = args[args.length-1];\n    const ttarget = canvas.scene.tokens.get(lastArg.tokenId);\n    const tokenD = canvas.tokens.get(args[1]);\n    const square = canvas.dimensions.size;\n    await ttarget.setFlag(\"dnd5e\",\"forcedMovement\",2);\n    let ux = tokenD.x;\n    let uy = tokenD.y;\n    let tx = ttarget.data.x;\n    let ty = ttarget.data.y;\n    if (ux > tx){await ttarget.update({x: tx-square})};\n    if (ux < tx){await ttarget.update({x: tx+square})};\n    if (uy > ty){await ttarget.update({y: ty-square})};\n    if (uy < ty){await ttarget.update({y: ty+square})};\n    tx = ttarget.data.x;\n    ty = ttarget.data.y;\n    if (ux > tx){await ttarget.update({x: tx-square})};\n    if (ux < tx){await ttarget.update({x: tx+square})};\n    if (uy > ty){await ttarget.update({y: ty-square})};\n    if (uy < ty){await ttarget.update({y: ty+square})};\n    await ttarget.unsetFlag(\"dnd5e\",\"forcedMovement\");\n    ttarget.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[lastArg.effectId])\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Guiding Bolt","type":"spell","img":"systems/dnd5e/icons/spells/fireball-sky-2.jpg","data":{"description":{"value":"<p>A flash of light streaks toward a creature of your choice within range. Make a ranged spell attack against the target. On a hit, the target takes 4d6 radiant damage, and the next attack roll made against this target before the end of your next turn has advantage, thanks to the mystical dim light glittering on the target until then.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 248","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"round"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["4d6","radiant"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[{"_id":"rl3jv0j16phw1elw","changes":[{"key":"flags.midi-qol.grants.advantage.attack.all","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":1,"turns":1},"icon":"systems/dnd5e/icons/spells/fireball-sky-2.jpg","label":"Guiding Bolt","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["isAttacked"],"transfer":false}},"tint":null,"selectedKey":"flags.midi-qol.grants.advantage.attack.all"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.7buEm5KhI5lP8m1z"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"UnevpoVk7g9iXMWz"}
{"name":"Tashas Caustic Brew","type":"spell","img":"icons/magic/acid/dissolve-bone-ribs-skull.webp","data":{"description":{"value":"<p>A stream of acid emanates from you in a line 30 feet long and 5 feet wide in a direction you choose. Each creature in the line must succeed on a Dexterity saving throw or be covered in acid for the spell’s duration or until a creature uses its action to scrape or wash the acid off itself or another creature. A creature covered in the acid takes 2d4 acid damage at start of each of its turns.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot 2nd level or higher, the damage increases by 2d4 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Tasha's Cauldron of Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":30,"width":null,"units":"ft","type":"line"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a bit of rotten food","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"o8ukw9fedfs15an4","changes":[{"key":"flags.midi-qol.OverTime","mode":2,"value":"turn=start,damageRoll=2d4,damageType=acid","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/magic/acid/dissolve-bone-ribs-skull.webp","label":"Tashas Caustic Brew","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"flags.midi-qol.OverTime"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.akVytvYri9qgT3OM"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"Xe6yny2PK3dwfhK4"}
{"name":"Chaos Bolt","type":"spell","img":"icons/magic/fire/projectile-fireball-smoke-large-blue.webp","data":{"description":{"value":"<p style=\"box-sizing:border-box;margin-top:0px;margin-bottom:10px;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif\">You hurl an undulating, warbling mass of chaotic energy at one creature in range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 + 1d6 damage. Choose one of the d8s. The number rolled on that die determines the attack's damage type, as shown below.</p>\n<table class=\"wiki-content-table\" style=\"border-spacing:0px;background-color:#ffffff;margin-bottom:20px;width:847.5px;max-width:100%;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif\">\n<tbody style=\"box-sizing:border-box\">\n<tr style=\"box-sizing:border-box\">\n<th style=\"box-sizing:border-box;padding:8px;text-align:left;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc;background:#908149;color:#ece9e4\">d8</th>\n<th style=\"box-sizing:border-box;padding:8px;text-align:left;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc;background:#908149;color:#ece9e4\">Damage Type</th>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">1</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Acid</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">2</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Cold</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">3</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Fire</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">4</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Force</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">5</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Lightning</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">6</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Poison</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">7</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Psychic</td>\n</tr>\n<tr style=\"box-sizing:border-box\">\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">8</td>\n<td style=\"box-sizing:border-box;padding:8px;border-top:none;line-height:1.42857;vertical-align:top;border-bottom:1px solid #cccccc\">Thunder</td>\n</tr>\n</tbody>\n</table>\n<p>If you roll the same number on both d8s, the chaotic energy leaps from the target to a different creature of your choice within 30 feet of it. Make a new attack roll against the new target, and make a new damage roll, which could cause the chaotic energy to leap again.</p>\n<p>A creature can be targeted only once by each casting of this spell.</p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, each target takes 1d6 extra damage of the type rolled for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"XGtE","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"cha","actionType":"rsak","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d8+1d6","fire"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":0,"prof":{"_baseProficiency":3,"multiplier":1,"rounding":"down"}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"babele":{"translated":true,"hasTranslation":true,"originalName":"Guiding Bolt"},"core":{"sourceId":"Compendium.dnd5e.spells.7buEm5KhI5lP8m1z","sheetClass":"dnd5e.Tidy5eItemSheet"},"mre-dnd5e":{"formulaGroups":[{"label":"Primary","formulaSet":[0]}]},"midi-qol":{"criticalThreshold":"20","onUseMacroName":"[postDamageRoll]ItemMacro","effectActivation":false,"fumbleThreshold":null,"onUseMacroParts":{"items":[{"macroName":"ItemMacro","option":"postActiveEffects"}]}},"enhanced-terrain-layer":{"multiple":1,"min":0,"max":0,"environment":"","elevation":null,"depth":null},"itemacro":{"macro":{"data":{"_id":null,"name":"Chaos Bolt","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0].macroPass != \"postDamageRoll\")return;\nconst damage_types = [\"Acid\",\"Cold\",\"Fire\",\"Fire\",\"Lightning\",\"Poison\",\"Psychic\",\"Thunder\",];\nconst element1 = damage_types[args[0].damageRoll.terms[0].values[0]-1]\nconst element2 = damage_types[args[0].damageRoll.terms[0].values[1]-1]\nconst spellLevel = args[0].spellLevel\nconst tokenCaster = await fromUuid(args[0].tokenUuid)\nconst actorCaster = tokenCaster.actor\nif(element1 === element2){\n    type = element1.toLowerCase()\n    ui.notifications.info(\n      `Chaos bolt bounces! Cast it again on another target within 30ft of the current one.`\n    );\n    let itemData = duplicate(args[0].itemData);\n    itemData.data.level = 0;\n    itemData.data.preparation.mode = \"innate\";\n    itemData.name = \"Additional Chaos Bolt\"\n    itemData.data.damage.parts[0][0] = `2d8+${spellLevel}d6`\n    let item = await actor.createEmbeddedDocuments(\"Item\",[itemData])\n    let hookId = Hooks.on(\"midi-qol.RollComplete\", (workflow)=>{\n      if(workflow.itemId != item[0].id)return;\n      actorCaster.deleteEmbeddedDocuments(\"Item\",[item[0].id])\n      Hooks.off(\"midi-qol.RollComplete\", hookId)\n    })\n    Hooks.once('updateCombat',()=>{\n      Hooks.off(\"midi-qol.RollComplete\", hookId)\n      if(actorCaster.items.get(item[0].id))\n        actorCaster.deleteEmbeddedDocuments(\"Item\",[item[0].id])\n    })\n}\nelse{\n    typeU = await choose([element1,element2])\n    type = typeU.toLowerCase()\n}\nconst theItem = await fromUuid(args[0].uuid);\ntheItem.data.data.damage.parts[0][1] = type\nasync function choose(options) {\n    let value = await new Promise((resolve) => {\n      let buttons = options.map((type) => {\n        return {\n          label: type,\n          callback: () => {\n            resolve(type);\n          },\n        };\n      });\n      new Dialog({\n        title: \"Select damage type\",\n        buttons: buttons,\n      }).render(true);\n    });\n    return value;\n  }","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"siftoolkit":{"SIFData":{"ignoreDuration":false,"texture":"","useTexture":false,"alpha":50,"coneOrigin":1,"loopAnimations":true,"playTemplateAudio":false,"playDamageAudio":false,"playSaveAudio":false,"clip":"","volume":100}},"autoanimations":{"version":3,"killAnim":false,"animLevel":false,"options":{"ammo":false,"rangeType":"spell","variant":"01","repeat":1,"delay":0,"enableCustom":false},"override":true,"sourceToken":{"enable":false},"targetToken":{"enable":false},"levels3d":{"type":""},"animType":"range","animation":"eldritchblast","color":"purple","audio":{"a01":{"enable":true,"file":"sound.spell.magic%20arrow.wav","delay":0,"volume":1}},"explosions":{"enable":false}},"midiProperties":{"nodam":false,"halfdam":false,"fulldam":false,"critOther":false,"concentration":false,"rollOther":false,"magicdam":false,"magiceffect":false,"toggleEffect":false,"selfEffect":false},"scene-packer":{"sourceId":"Item.K1oAUpTMT53fEGsZ","hash":"29ecfe87118399703677edd1b4185756a1dcd82f"}},"_id":"Zt76RJoDjsNBo9s4"}
{"name":"Mage Armor","type":"spell","img":"systems/dnd5e/icons/spells/protect-blue-1.jpg","data":{"description":{"value":"<p>You touch a willing creature who isn't wearing armor, and a protective magical force surrounds it until the spell ends. The target's base AC becomes 13 + its Dexterity modifier. The spell ends if the target dons armor or if you dismiss the spell as an action.</p>","chat":"","unidentified":""},"source":"PHB pg. 256","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":8,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A piece of cured leather","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"cfwMU7LuOJ619Lny","changes":[{"key":"data.attributes.ac.calc","mode":5,"value":"mage","priority":"50"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/protect-blue-1.jpg","label":"Mage Armor","origin":"Compendium.dnd5e.spells.CKZTpZlxj7hjjo2H","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.ac.calc"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.CKZTpZlxj7hjjo2H"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"a2ChY1X9R0WhY2Yk"}
{"_id":"bS30TctrSF9KXAcc","name":"Thunderous Smite","type":"spell","img":"icons/magic/movement/trail-streak-impact-blue.webp","data":{"description":{"value":"<p>The first time you hit with a melee weapon attack during this spell’s duration, your weapon rings with thunder that is audible within 300 feet of you, and the attack deals an extra 2d6 thunder damage to the target. Additionally, if the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet away from you and knocked prone.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"f7tlec3w0kdlj38v","changes":[{"key":"flags.dnd5e.DamageBonusMacro","mode":0,"value":"ItemMacro.Thunderous Smite","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/movement/trail-streak-impact-blue.webp","label":"Thunderous Smite","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Hit:mwak"],"transfer":false}},"tint":null,"selectedKey":"flags.dnd5e.DamageBonusMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.mREhp8BAlh7LauUp"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Thunderous Smite","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nif (lastArg.item.data.actionType != \"mwak\") return;\nif (lastArg.hitTargetUuids.length <1) return;\nconst spellDC = actor.data.data.attributes.spelldc;\nconst target = lastArg.hitTargets[0].object\nconst effectData = {\n        changes: [\n          {\"key\": \"macro.itemMacro.GM\",\"mode\": 0,\"value\": \"\",\"priority\": \"20\"},\n        ], \n    \"disabled\": false,\n    \"duration\": {\n        \"turns\": 1\n    },\n    \"icon\": \"icons/magic/movement/trail-streak-impact-blue.webp\",\n    \"label\": \"Thunderous Smite\",\n    \"tint\": \"\",\n    \"transfer\": false,\n    flags: {\n            \"dae\": {\n                \"stackable\": \"none\",\n                \"durationExpression\": \"\",\n                \"macroRepeat\": \"startEveryTurn\",\n                \"specialDuration\": [],\n                \"transfer\": false,\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\":\n                                        `if(args[0]===\"on\"){\n                                            const lastArg = args[args.length-1];\n                                            const ttarget = canvas.scene.tokens.get(lastArg.tokenId);\n                                            const tokenD = canvas.tokens.get(\"${lastArg.tokenId}\");\n                                            const square = canvas.dimensions.size;\n                                            await ttarget.setFlag(\"dnd5e\",\"forcedMovement\",2);\n                                            let ux = tokenD.x;\n                                            let uy = tokenD.y;\n                                            let tx = ttarget.data.x;\n                                            let ty = ttarget.data.y;\n                                            if (ux > tx){await ttarget.update({x: tx-square})};\n                                            if (ux < tx){await ttarget.update({x: tx+square})};\n                                            if (uy > ty){await ttarget.update({y: ty-square})};\n                                            if (uy < ty){await ttarget.update({y: ty+square})};\n                                            tx = ttarget.data.x;\n                                            ty = ttarget.data.y;\n                                            if (ux > tx){await ttarget.update({x: tx-square})};\n                                            if (ux < tx){await ttarget.update({x: tx+square})};\n                                            if (uy > ty){await ttarget.update({y: ty-square})};\n                                            if (uy < ty){await ttarget.update({y: ty+square})};\n                                            await ttarget.unsetFlag(\"dnd5e\",\"forcedMovement\");\n                                            ttarget.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[lastArg.effectId])\n                                        }`\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n}\nconst flavor = `<p>${\"Strength Saving Throw\"}</p><p>${CONFIG.DND5E.abilities[\"str\"]} DC ${spellDC} </P> `;\nlet strSave = (await target.actor.rollAbilitySave(\"str\", { flavor, fastForward: false})).total;\nif(strSave<spellDC){\n    await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: target.actor.uuid, effects: [effectData]})\n}\nlet damageRoll;\nlastArg.isCritical ? damageRoll = 4 : damageRoll = 2;\nreturn{damageRoll: `${damageRoll}d6[thunder]`, flavor: \"Thunderous Smite\"}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"_id":"cfHM1r58k2H7JG45","name":"Shield","type":"spell","img":"systems/dnd5e/icons/spells/protect-magenta-1.jpg","data":{"description":{"value":"<p>An invisible barrier of magical force appears and protects you. Until the start of your next turn, you have a +5 bonus to AC, including against the triggering attack, and you take no damage from magic missile.</p>","chat":"","unidentified":""},"source":"PHB pg. 275","activation":{"type":"reaction","cost":1,"condition":"Which you take when you are hit by an attack or targeted by the magic missile spell"},"duration":{"value":1,"units":"round"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":0},"effects":[{"_id":"6pbotGIvqQkraPva","flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"changes":[{"key":"data.attributes.ac.bonus","mode":2,"value":"5","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":1},"icon":"systems/dnd5e/icons/spells/protect-magenta-1.jpg","label":"Shield","origin":"Item.FlLKKv7bQBlIAs11","tint":null,"transfer":false,"selectedKey":"data.attributes.ac.bonus"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.z1mx84ONwkXKUZd7"},"midi-qol":{"effectActivation":false,"onUseMacroName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"dnd5e":{"spellId":"shield"},"itemacro":{"macro":{"data":{"_id":null,"name":"Shield","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Protection from Evil and Good","type":"spell","img":"systems/dnd5e/icons/spells/protect-sky-2.jpg","data":{"description":{"value":"<p>Until the spell ends, one willing creature you touch is protected against certain types of creatures: aberrations, celestials, elementals, fey, fiends, and undead.</p><p>The protection grants several benefits. Creatures of those types have disadvantage on attack rolls against the target. The target also can't be charmed, frightened, or possessed by them. If the target is already charmed, frightened, or possessed by such a creature, the target has advantage on any new saving throw against the relevant effect.</p>","chat":"","unidentified":""},"source":"PHB pg. 270","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"Holy water or powdered silver and iron, which the spell consumes","consumed":true,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"xlb4jga70tkymtqg","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/protect-sky-2.jpg","label":"Protection from Evil and Good","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.xmDBqZhRVrtLP8h2"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Protection from Evil and Good","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] === \"on\"){    \n    const lastArg = args[args.length-1]\n    const targetToken = await fromUuid(lastArg.tokenUuid);\n    const targetActor = targetToken.actor;\n    const effectData = {\n        \"changes\": [\n            {\n                \"key\": \"flags.midi-qol.disadvantage.attack.all\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"turns\": 1\n        },\n        \"icon\": \"\",\n        \"label\": \"Protection from Evil and Good\",\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {\n                \"macroRepeat\": \"none\",\n                \"specialDuration\": [\n                    \"1Attack\"\n                ]\n            }\n        }\n    }\n    const effectData2 = {\n    \"changes\": [\n        {\n            \"key\": \"data.traits.ci.value\",\n            \"mode\": 2,\n            \"value\": \"charmed\",\n            \"priority\": \"20\"\n        },\n        {\n            \"key\": \"data.traits.ci.value\",\n            \"mode\": 2,\n            \"value\": \"frightened\",\n            \"priority\": \"20\"\n        },\n        {\n            \"key\": \"data.traits.ci.custom\",\n            \"mode\": 0,\n            \"value\": \"possessed\",\n            \"priority\": \"20\"\n        }\n    ],\n    \"disabled\": false,\n    \"duration\": {\n        \"turns\": 1\n    },\n    \"icon\": \"systems/dnd5e/icons/spells/protect-sky-2.jpg\",\n    \"label\": \"Protection from Evil and Good Condition Immunities\",\n    \"transfer\": false,\n}\n    let hookId = Hooks.on(\"midi-qol.preItemRollGM\", async(workflow) => {        \n        let targets = Array.from(workflow.targets);\n        if(!targets.includes(targetToken.object))return;\n        if([\"aberration\",\"celestial\",\"elemental\",\"fey\",\"fiend\",\"undead\"].includes(workflow.actor.data.data.details.type.value)){\n            if([\"mwak\",\"msak\",\"rwak\",\"rsak\"].includes(workflow.item.data.data.actionType)){\n                await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: workflow.token.actor.uuid, effects: [effectData]})\n            }\n            if(!targetActor.effects.find(i=>i.data.label === \"Protection from Evil and Good Condition Immunities\")){\n                await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetActor.uuid, effects: [effectData2]})\n            }\n        }\n        else{\n            if(targetActor.effects.find(i=>i.data.label === \"Protection from Evil and Good Condition Immunities\")){\n                targetActor.deleteEmbeddedDocuments(\"ActiveEffect\",targetActor.effects.filter(i=>[\"Charmed\",\"Frightened\",\"Possessed\",\"Protection from Evil and Good Condition Immunities\"].includes(i.data.label)).map(i=>i.id))\n            }\n        }\n        return;\n    });\n    DAE.setFlag(targetActor,\"ProtectionFromEvilHookId\",hookId);\n}\nif(args[0] === \"off\"){   \n    const lastArg = args[args.length-1] \n    const targetToken = await fromUuid(lastArg.tokenUuid);\n    const targetActor = targetToken.actor;\n    if(targetActor.effects.find(i=>i.data.label === \"Protection from Evil and Good Condition Immunities\")){\n        targetActor.deleteEmbeddedDocuments(\"ActiveEffect\",targetActor.effects.filter(i=>[\"Charmed\",\"Frightened\",\"Possessed\",\"Protection from Evil and Good Condition Immunities\"].includes(i.data.label)).map(i=>i.id))\n    }\n    Hooks.off(\"midi-qol.preItemRollGM\",DAE.getFlag(targetActor,\"ProtectionFromEvilHookId\"))\n    DAE.unsetFlag(token.actor,\"ProtectionFromEvilEnemy\");\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"d61OnsG6nRy7JjTZ"}
{"name":"Tashas Hideous Laughter","type":"spell","img":"icons/commodities/materials/feather-blue-glowing.webp","data":{"description":{"value":"<p>A creature of your choice that you can see within range perceives everything as hilariously funny and falls into fits of laughter if this spell affects it. The target must succeed on a Wisdom saving throw or fall prone, becoming incapacitated and unable to stand up for the duration. A creature with an Intelligence score of 4 or less isn’t affected.</p><p>At the end of each of its turns, and each time it takes damage, the target can make another Wisdom saving throw. The target has advantage on the saving throw if it’s triggered by damage. On a success, the spell ends.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":5,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"tiny tarts and a feather that is waved in the air","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"v95znozd49mafo2i","changes":[{"key":"flags.midi-qol.OverTime","mode":2,"value":"turn=end,\nsaveAbility=wis,\nsaveDC=@attributes.spelldc,\nlabel=Incapacitated","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/commodities/materials/feather-blue-glowing.webp","label":"Incapacitated","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"flags.midi-qol.OverTime"},{"_id":"aanyzhh2tilofnec","changes":[{"key":"data.attributes.movement.walk","mode":1,"value":"0.5","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.mwak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.msak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/svg/falling.svg","label":"Prone","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.attributes.movement.walk","flags.midi-qol.grants.advantage.attack.mwak","flags.midi-qol.grants.advantage.attack.msak","flags.midi-qol.disadvantage.attack.all"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.QcXdIcJsg5tp7iES"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"eUFmfdFuyfSmSkLq"}
{"_id":"eiH3taaxxulnxf8M","name":"Arms of Hadar","type":"spell","img":"icons/magic/unholy/barrier-fire-pink.webp","data":{"description":{"value":"<p>You invoke the power of Hadar, the Dark Hunger. Tendrils of dark energy erupt from you and batter all creatures within 10 feet of you. Each creature in that area must make a Strength saving throw. On a failed save, a target takes 2d6 necrotic damage and can’t take reactions until its next turn. On a successful save, the creature takes half damage, but suffers no other effect.</p>\n<p> </p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":10,"width":null,"units":"ft","type":"creature"},"range":{"value":null,"long":null,"units":"spec"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d6","necrotic"]],"versatile":""},"formula":"","save":{"ability":"str","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"}},"effects":[{"_id":"al3y4uv2wfhomzuk","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"","priority":"20"}],"disabled":false,"duration":{"startTime":null,"turns":1},"icon":"icons/magic/unholy/barrier-fire-pink.webp","label":"Arms of Hadar","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"midi-qol":{"effectActivation":false,"onUseMacroName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":true,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Arms of Hadar","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] === \"on\"){\n    const lastArg = args[args.length-1]    \n    const actor = canvas.tokens.get(lastArg.tokenId).actor\n    actor.setFlag(\"midi-qol\",'reactionCombatRound',game.combat?.current.round);\n    actor.deleteEmbeddedDocuments('ActiveEffect',[lastArg.effectId]);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"core":{"sourceId":"Item.yFAM65LB3ogSyROk"}}}
{"name":"Hellish Rebuke","type":"spell","img":"systems/dnd5e/icons/spells/explosion-red-3.jpg","data":{"description":{"value":"<p>When you are damaged by a creature within 60 feet of you that you can see, you point your finger, and the creature that damaged you is momentarily surrounded by hellish flames. The creature must make a Dexterity saving throw. It takes 2d10 fire damage on a failed save, or half as much damage on a successful one.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d10 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 250","activation":{"type":"reactiondamage","cost":1,"condition":"Which you take in response to being damaged by a creature within 60 feet of you that you can see"},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d10","fire"]],"versatile":""},"formula":"","save":{"ability":"dex","dc":0,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d10"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.22dPoeXfaaAv4K3h"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":true,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"gOY4WwP8pzlIOSe1"}
{"name":"Frost Fingers","type":"spell","img":"icons/magic/water/barrier-ice-crystal-wall-jagged.webp","data":{"description":{"value":"<p>Freezing cold blasts from your fingertips in a 15-foot cone. Each creature in that area must make a Constitution saving throw, taking 2d8 cold damage on a failed save, or half as much damage on a successful one.</p><p>The cold freezes nonmagical liquids in the area that aren't being worn or carried.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Icewind Dale - Rime of the Frostmaiden","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":15,"width":null,"units":"ft","type":"cone"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d8","cold"]],"versatile":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.KLTHRiXH7xcHje71"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":true,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"h34J8fIyfLR1RSe2"}
{"name":"Divine Favor","type":"spell","img":"systems/dnd5e/icons/spells/enchant-sky-2.jpg","data":{"description":{"value":"<p>Your prayer empowers you with divine radiance. Until the spell ends, your weapon attacks deal an extra 1d4 radiant damage on a hit.</p>","chat":"","unidentified":""},"source":"PHB pg. 234","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"53yajymfehr81k29","changes":[{"key":"data.bonuses.mwak.damage","mode":2,"value":"1d4[radiant]","priority":"20"},{"key":"data.bonuses.rwak.damage","mode":2,"value":"1d4[radiant]","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/enchant-sky-2.jpg","label":"Divine Favor","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.bonuses.mwak.damage","data.bonuses.rwak.damage"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.8MICCMeOXT3aJUy9"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"jXRRxUrXnvScto3U"}
{"name":"Catapult","type":"spell","img":"icons/magic/earth/projectile-boulder-dust.webp","data":{"description":{"value":"<p>Choose one object weighing 1 to 5 pounds within range that isn’t being worn or carried. The object flies in a straight line up to 90 feet in a direction you choose before falling to the ground, stopping early if it impacts against a solid surface. If the object would strike a creature, that creature must make a Dexterity saving throw. On a failed save, the object strikes the target and stops moving. When the object strikes something, the object and what it strikes each take 3d8 bludgeoning damage.</p>\n<p> </p>\n<p>At Higher Levels. When you cast this spell using a spell slot of 2nd level or higher, the maximum weight of objects that you can target with this spell increases by 5 pounds, and the damage increases by 1d8, for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":1,"width":null,"units":"","type":"object"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d8","bludgeoning"]],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":1,"school":"trs","components":{"value":"","vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d8"}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":true,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"core":{"sourceId":"Item.qzTbzltSaIFxIOCL"}},"_id":"k4s388g1mYaw9l1j"}
{"name":"False Life","type":"spell","img":"systems/dnd5e/icons/spells/heal-royal-1.jpg","data":{"description":{"value":"<p>Bolstering yourself with a necromantic facsimile of life, you gain 1d4 + 4 Temporary Hit Points for the Duration.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, you gain 5 additional Temporary Hit Points for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 239","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + 4","temphp"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"nec","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A small amount of alcohol or distilled spirits","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"(@item.level - 1) * 5"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.7e3QXF10hLNDEdr6"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"klIYwow5dCx4HapQ"}
{"_id":"os2y6be1AL37L0G5","name":"Searing Smite","type":"spell","img":"icons/magic/fire/dagger-rune-enchant-flame-strong-red.webp","data":{"description":{"value":"<p>The next time you hit a creature with a melee weapon attack during the spell’s duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames.</p>\n<p>At the start of each of its turns until the spell ends, the target must make a Constitution saving throw. On a failed save, it takes 1d6 fire damage. On a successful save, the spells ends. If the target or a creature within 5 feet of it uses an action to put out the flames, or if some other effect douses the flames (such as the target being submerged in water), the spell ends.</p>\n<p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the initial extra damage dealt by the attack increases by 1d6 for each slot.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":0},"effects":[{"_id":"d8hf8hz9yqciksx4","changes":[{"key":"flags.dnd5e.DamageBonusMacro","mode":0,"value":"ItemMacro.Searing Smite","priority":"20"},{"key":"flags.midi-qol.searingSmite.level","mode":5,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/fire/dagger-rune-enchant-flame-strong-red.webp","label":"Searing Smite","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Hit:mwak","1Attack:rwak"],"transfer":false}},"tint":null,"selectedKey":["flags.dnd5e.DamageBonusMacro","__"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.v0bhq7o1GcSxWiPv"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":true,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Searing Smite","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nconst concentrationUuid = lastArg.sourceItemUuid\nif (![\"mwak\",\"rwak\"].includes(lastArg.item.data.actionType)) return;\nif (lastArg.hitTargetUuids.length <1) return;\nlet DC = actor.data.data.attributes.spelldc;\nfor (let tokenUuid of lastArg.hitTargetUuids) {\n    const target = await fromUuid(tokenUuid);\n    const targetActor = target.actor;  \n        const effectData = {\n        label: \"Searing Smite\", \n        changes: [\n          {key: \"flags.midi-qol.OverTime\", mode: 0, value: `\"turn=start,saveAbility=con,saveDC=${DC},damageRoll=1d6,damageType=fire,label=Searing Smite\" `, priority: 20},\n          {\"key\": \"macro.itemMacro.GM\",\"mode\": 0,\"value\": \"\",\"priority\": \"20\"}\n        ],  \n        origin: concentrationUuid, \n        disabled: false,\n        icon: \"icons/magic/fire/dagger-rune-enchant-flame-strong-red.webp\",\n        duration: { rounds: 10, seconds: 60},\n        flags: {\n            \"dae\": {\n                \"stackable\": \"none\",\n                \"durationExpression\": \"\",\n                \"macroRepeat\": \"startEveryTurn\",\n                \"specialDuration\": [],\n                \"transfer\": false,\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": `const lastArg = args[args.length-1];\n                                                const target = await fromUuid(lastArg.tokenUuid); \n                                                const targetActor = target.actor;\n                                                if(args[0] === \"on\"){\n                                                    let effectUuid = targetActor.uuid + \".ActiveEffect.\" + lastArg.effectId\n                                                    addToRemoveConcentration(targetActor,effectUuid)\n                                                    function addToRemoveConcentration(actor,...uuids){\n                                                        let removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n                                                        removeUuids = removeUuids.concat(uuids);\n                                                        if (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n                                                    }                                                    \n                                                }`\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n      }\n      await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetActor.uuid, effects: [effectData]})\n}\nlet mult;\nlastArg.isCritical?mult = 2:mult = 1;\nconst spellLevel = actor.data.flags[\"midi-qol\"].searingSmite.level;\nreturn{damageRoll: `${spellLevel*mult}d6[fire]`, flavor: \"Searing Smite\"}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"_id":"qVguWofR7xOrH2ql","name":"Hunter's Mark","type":"spell","img":"icons/magic/nature/wolf-paw-glow-orange.webp","data":{"description":{"value":"<p>You choose a creature you can see within range and mystically mark it as your quarry. Until the spell ends, you deal an extra {@dice 1d6} damage to the target whenever you hit it with a weapon attack, and you have advantage on any Wisdom (Perception) or Wisdom (Survival) check you make to find it. If the target drops to 0 hit points before this spell ends, you can use a bonus action on a subsequent turn of yours to mark a new creature.</p>","chat":"","unidentified":""},"source":"PHB pg. 251","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":0},"effects":[{"_id":"9eOiLd1FGoDJ9eLu","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":3600},"icon":"icons/magic/nature/wolf-paw-glow-orange.webp","label":"Marked","origin":"Item.SU8tsBLWTXP7NUdb","tint":null,"transfer":false,"flags":{"dae":{"stackable":"none","macroRepeat":"none","specialDuration":["zeroHP"],"transfer":false,"durationExpression":""},"ActiveAuras":{"isAura":false,"radius":null,"aura":"None","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"hostile":false,"onlyOnce":false},"core":{"statusId":""}},"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.0xmXiPiuYws1OGcX"},"midi-qol":{"onUseMacroName":"[postActiveEffects]ItemMacro,[preItemRoll]ItemMacro","effectActivation":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Hunter's Mark","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0].macroPass === \"postActiveEffects\"){\n    let tokenU = await fromUuid(args[0].tokenUuid)\n    if(args[0].item.name != \"Hunter's Mark\"){\n        tokenU.actor.effects.find(i=>i.data.label === \"Hunter's Mark\").delete()\n    }\n    let concentrationData = tokenU.actor.getFlag(\"midi-qol\",\"concentration-data\")\n    const effectData2 = {\n        changes: [\n          {key: \"flags.midi-qol.huntersMark\", mode: 5, value: args[0].targetUuids[0], priority: 20},\n          {key: \"flags.dnd5e.DamageBonusMacro\", mode: 0, value: `ItemMacro.${args[0].item.name}`, priority: 20}\n        ],  \n        origin: concentrationData.uuid,\n        disabled: false,\n        duration: args[0].item.effects[0].duration,\n        icon: args[0].item.img,\n        label: args[0].item.name\n    }\n    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: tokenU.actor.uuid, effects: [effectData2]})\n    if(args[0].item.name != \"Hunter's Mark\")return;\n    let hexPassData = args[0].item\n    hexPassData.name = \"Hunter's Mark Transffer\";\n    hexPassData.data.level = 0;\n    hexPassData.data.preparation.mode = \"innate\"\n    hexPassData.data.components.concentration = false\n    let items = (await tokenU.actor.createEmbeddedDocuments(\"Item\",[hexPassData])).map(i=>i.uuid)\n    addToRemoveConcentration(tokenU.actor,items[0])\n}\nif(args[0].macroPass === \"DamageBonus\"){\n    if(args[0].hitTargetUuids.length < 1)return;\n    const tokenU =  await fromUuid(args[0].tokenUuid);\n    if(tokenU.actor.data.flags[\"midi-qol\"].huntersMark != args[0].hitTargetUuids[0])return;\n    const diceMult = args[0].isCritical ? 2: 1;\n    return {damageRoll: `${diceMult}d6`, flavor: \"Hunter's Mark Damage\"}\n}\nif(args[0].macroPass === \"preItemRoll\"){\n    if(args[0].item.name === \"Hunter's Mark\")return;\n    const tokenU =  await fromUuid(args[0].tokenUuid);\n    const lastTarget = await fromUuid(tokenU.actor.data.flags[\"midi-qol\"].huntersMark)\n    if(lastTarget.actor.data.data.attributes.hp.value > 0){\n        ui.notifications.warn(\"Your last Hunter\\'s Mark target has more than 0 HP currently\")\n        return false\n    }\n}\nif(args[0] === \"on\"){\n    const lastArg = args[args.length-1]\n    const origin = await fromUuid(lastArg.origin)\n    const tokenU = await fromUuid(lastArg.tokenUuid)\n    if(origin.name === \"Hunter's Mark\")return;\n    let effectUuid = tokenU.actor.uuid + \".ActiveEffect.\" + lastArg.effectId\n    addToRemoveConcentration(origin.actor,effectUuid)\n}\n\nfunction addToRemoveConcentration(actor,...uuids){\n    let removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n    removeUuids = removeUuids.concat(uuids);\n    if (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"cf":{"id":"temp_ovon30cu8t","color":"#000000"},"midiProperties":{"nodam":false,"halfdam":false,"fulldam":false,"critOther":false,"concentration":false,"rollOther":false,"magicdam":false,"magiceffect":false,"toggleEffect":false,"selfEffect":false}}}
{"name":"Goodberry","type":"spell","img":"systems/dnd5e/icons/spells/leaf-acid-1.jpg","data":{"description":{"value":"<p>Up to ten berries appear in your hand and are infused with magic for the duration. A creature can use its action to eat one berry. Eating a berry restores 1 hit point, and the berry provides enough nourishment to sustain a creature for one day.</p><p>The berries lose their potency if they have not been consumed within 24 hours of the casting of this spell.</p>","chat":"","unidentified":""},"source":"PHB pg. 246","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A spring of mistletoe","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"0peo43g4pjl5sa9o","changes":[{"key":"macro.itemMacro","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/leaf-acid-1.jpg","label":"Goodberry","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"multi","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.Qf6CAZkc7ms4ZY3e"},"itemacro":{"macro":{"data":{"_id":null,"name":"Goodberry","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"// IN DAE > Set the stackable to \"Stacking effects apply the effect multiple times\"\nasync function wait(ms) { return new Promise(resolve => { setTimeout(resolve, ms); }); }\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst itemD = lastArg.efData.flags.dae.itemData;\n\nif(args[0] === \"on\"){\n    let itemData = [{\n  \"name\": itemD.name,\n  \"type\": \"consumable\",\n  \"img\": \"icons/consumables/fruit/berry-leaf-pink.webp\",\n  \"data\": {\n    \"description\": {\n      \"value\": \"<p>Eating a berry restores 1 hit point, and the berry provides enough nourishment to sustain a creature for one day.</p>\"\n    },    \n    \"quantity\": 10,\n    \"weight\": 0.002,        \n    \"rarity\": \"common\",\n    \"identified\": true,\n    \"activation\": {\n      \"type\": \"action\",\n      \"cost\": 1,\n      \"condition\": \"\"\n    },\n    \"target\": {\n      \"value\": null,\n      \"width\": null,\n      \"units\": \"touch\",\n      \"type\": \"creature\"\n    },  \n    \"range\": {\n      \"value\": null,\n      \"long\": null,\n      \"units\": \"touch\"\n    },\n    \"uses\": {\n      \"value\": 1,\n      \"max\": \"1\",\n      \"per\": \"charges\",\n      \"autoDestroy\": true\n    },\n    \"actionType\": \"heal\",    \n    \"damage\": {\n      \"parts\": [\n        [\n          \"1\",\n          \"healing\"\n        ]\n      ],\n      \"versatile\": \"\"\n    },\n    \"consumableType\": \"food\"\n  },  \n  \"flags\": {    \n    \"midi-qol\": {\n      \"onUseMacroName\": \"\",\n      \"effectActivation\": false\n    }\n  }\n}];\n    await tactor.createEmbeddedDocuments(\"Item\", itemData);\n}\nif (args[0] === \"off\") {\n    let itemz = tactor.data.items.find(i => i.name === itemD.name && i.type === \"consumable\");\n    if (itemz) await tactor.deleteEmbeddedDocuments('Item', [itemz.id]);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"rhnhbnnYscqXXwvW"}
{"name":"Inflict Wounds","type":"spell","img":"systems/dnd5e/icons/spells/rip-jade-2.jpg","data":{"description":{"value":"<p>Make a melee spell Attack against a creature you can reach. On a hit, the target takes 3d10 necrotic damage.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d10 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 253","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":0,"per":""},"consume":{"type":"","target":null,"amount":null},"ability":"","actionType":"msak","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d10","necrotic"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"nec","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d10"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.ksaaTxIbKx2sJfia"}},"_id":"sxRlYJWNY5oElZEw"}
{"name":"Sanctuary","type":"spell","img":"systems/dnd5e/icons/spells/protect-sky-2.jpg","data":{"description":{"value":"<p>You ward a creature within range against attack. Until the spell ends, any creature who targets the warded creature with an attack or a harmful spell must first make a Wisdom saving throw. On a failed save, the creature must choose a new target or lose the attack or spell. This spell doesn't protect the warded creature from area effects, such as the explosion of a Fireball.</p><p>If the warded creature makes an attack or casts a spell that affects an enemy creature, this spell ends.</p>","chat":"","unidentified":""},"source":"PHB pg. 272","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A small silver mirror","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"6qgme2h8j145r33r","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"@attributes.spelldc","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/protect-sky-2.jpg","label":"Sanctuary","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.gvdA9nPuWLck4tBl"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Sanctuary","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nconst spellTarget = await fromUuid(lastArg.tokenUuid)\nconst spelldc = args[1]\nif(args[0] === \"on\"){\n    const hookId = Hooks.on(\"midi-qol.preItemRollGMGM\",(workflow)=>{\n        if(workflow.token.id === spellTarget.id){\n            for(let target of Array.from(workflow.targets)){\n                if(target.data.disposition != spellTarget.data.disposition){\n                    spellTarget.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[lastArg.effectId])\n                    return;\n                }\n            }\n        }\n        if([\"sphere\",\"cone\",\"wall\",\"cube\",\"radius\",\"rect\",\"cylinder\",\"square\",\"line\"].includes(workflow.item.data.data.target.type))return;\n        if(workflow.token.data.disposition === spellTarget.data.disposition)return;\n        if(!Array.from(workflow.targets).includes(spellTarget.object))return;\n        let saveRoll = new Roll(`1d20+${workflow.token.actor.data.data.abilities.wis.save}`).evaluate({async:false})\n        saveRoll.toMessage({flavor:'<img src=\"systems/dnd5e/icons/spells/protect-sky-2.jpg\" title=\"Sanctuary\" width=\"36\" height=\"36\"><span style=\"font-family:Modesto Condensed, Palatino Linotype, serif;font-size: 20px;\"> Sanctuary<h3 style=\"font-size: 15px\">Wisdom Saving Throw</h3></span>'})\n        console.log({saveRoll})\n        if(saveRoll.total < spelldc){\n            ui.notifications.warn(`Due to Sanctuary effect ${workflow.token.name} cannot attack ${spellTarget.name}, he must choose another target`)\n            ChatMessage.create({content:`<div class=\"dnd5e chat-card item-card midi-qol-item-card\"><header class=\"card-header flexrow\"><img src=\"systems/dnd5e/icons/spells/protect-sky-2.jpg\" title=\"Sanctuary\" width=\"36\" height=\"36\"><h3 class=\"item-name\">Sanctuary</h3></header>Due to Sanctuary effect ${workflow.token.name} cannot attack ${spellTarget.name}, he must choose another target`})\n            \n            return false;\n            }\n        return\n    })\n    DAE.setFlag(spellTarget.actor,\"sanctuaryHookId\",hookId)\n}\nif(args[0] === \"off\"){\n    Hooks.off(\"midi-qol.preItemRollGMGM\",DAE.getFlag(spellTarget.actor,\"sanctuaryHookId\"))\n    DAE.unsetFlag(spellTarget.actor,\"sanctuaryHookId\")\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"u0hqAW2UcP1ig6jN"}
{"name":"Burning Hands","type":"spell","img":"systems/dnd5e/icons/spells/fog-orange-2.jpg","data":{"description":{"value":"<p>As you hold your hands with thumbs touching and fingers spread, a thin sheet of flames shoots forth from your outstretched fingertips. Each creature in a 15-foot cone must make a Dexterity saving throw. A creature takes 3d6 fire damage on a failed save, or half as much damage on a successful one.</p><p>The fire ignites any flammable objects in the area that aren't being worn or carried.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 220","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":15,"width":null,"units":"ft","type":"cone"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":0,"per":""},"consume":{"type":"","target":null,"amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d6","fire"]],"versatile":""},"formula":"","save":{"ability":"dex","dc":0,"scaling":"spell"},"level":1,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.5SuJewoa1CRWaj1F"}},"_id":"ui9ysiekXyVqMIuA"}
{"name":"Ice Knife","type":"spell","img":"icons/magic/water/projectile-ice-chunk-blue.webp","data":{"description":{"value":"<p>You create a shard of ice and fling it at one creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 piercing damage. Hit or miss, the shard then explodes. The target and each creature within 5 feet of the point where the ice exploded must succeed on a Dexterity saving throw or take 2d6 cold damage.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the cold damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d10","cold"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":false,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a drop of water or piece of ice","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.FnMbflMFrFlBR0Rx"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Ice Knife","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length - 1];\n//let target = canvas.tokens.get(lastArg.failedSaves[0].id);\nlet tokenD = canvas.tokens.get(lastArg.tokenId);\nlet actorD = tokenD.actor\n//let level = actorD.data.type === \"character\" ? actorD.data.data.details.level : tokenD.actor.data.data.details.cr;\nlet numDice = (args[0].spellLevel) + 1;\n//let damageType = \"cold\";\n//let damageRoll = new Roll(`${numDice}d6`).evaluate({ async: false })\nlet distance = 9.5;\n//let saveResult = \"\";\n//let damage_target = [];\n//let dc = actorD.getRollData().attributes.spelldc;\nlet firstTarget = canvas.tokens.get(args[0].targets[0].id);\nlet aoe_target = canvas.tokens.placeables.filter(target => (canvas.grid.measureDistance(firstTarget.center, target.center) <= distance));\nlet item = await actorD.createEmbeddedDocuments('Item',[getItemData()])\nawait MidiQOL.completeItemRoll(item[0], {targetUuids: aoe_target.map(i=>i.document.uuid)});\nactorD.deleteEmbeddedDocuments('Item',[item[0].id])\n\nfunction getItemData(){\n    return {\n        \"name\": \"Ice Knife Area Damage\",\n        \"type\": \"spell\",\n        \"img\": \"icons/magic/water/projectile-ice-chunk-blue.webp\",\n        \"data\": {\n            \"description\": {\n                \"value\": \"\",\n                \"chat\": \"\",\n                \"unidentified\": \"\"\n            },\n            \"source\": \"\",\n            \"activation\": {\n                \"type\": \"none\",\n                \"cost\": 0,\n                \"condition\": \"\"\n            },\n            \"duration\": {\n                \"value\": null,\n                \"units\": \"\"\n            },\n            \"target\": {\n                \"value\": null,\n                \"width\": null,\n                \"units\": \"\",\n                \"type\": \"\"\n            },\n            \"range\": {\n                \"value\": null,\n                \"long\": null,\n                \"units\": \"\"\n            },\n            \"uses\": {\n                \"value\": null,\n                \"max\": \"\",\n                \"per\": \"\"\n            },\n            \"consume\": {\n                \"type\": \"\",\n                \"target\": \"\",\n                \"amount\": null\n            },\n            \"ability\": \"\",\n            \"actionType\": \"save\",\n            \"attackBonus\": 0,\n            \"chatFlavor\": \"\",\n            \"critical\": {\n                \"threshold\": null,\n                \"damage\": \"\"\n            },\n            \"damage\": {\n                \"parts\": [\n                    [\n                        `${numDice}d6`,\n                        \"cold\"\n                    ]\n                ],\n                \"versatile\": \"\"\n            },\n            \"formula\": \"\",\n            \"save\": {\n                \"ability\": \"dex\",\n                \"dc\": null,\n                \"scaling\": \"spell\"\n            },\n            \"level\": 0,\n            \"school\": \"con\",\n            \"components\": {\n                \"value\": \"\",\n                \"vocal\": false,\n                \"somatic\": false,\n                \"material\": false,\n                \"ritual\": false,\n                \"concentration\": false\n            },\n            \"materials\": {\n                \"value\": \"\",\n                \"consumed\": false,\n                \"cost\": 0,\n                \"supply\": 0\n            },\n            \"preparation\": {\n                \"mode\": \"innate\",\n                \"prepared\": false\n            },\n            \"scaling\": {\n                \"mode\": \"none\",\n                \"formula\": \"\"\n            }\n        },\n        \"effects\": [],\n        \"folder\": null,\n        \"sort\": 0,\n        \"permission\": {\n            \"default\": 0,\n            \"U3VAAELfq3wUHjF9\": 3\n        },\n        \"flags\": {\n            \"midi-qol\": {\n                \"effectActivation\": false\n            },\n            \"midiProperties\": {\n                \"nodam\": true,\n                \"fulldam\": false,\n                \"halfdam\": false,\n                \"rollOther\": false,\n                \"critOther\": false,\n                \"magicdam\": false,\n                \"magiceffect\": false,\n                \"concentration\": false,\n                \"toggleEffect\": false,\n                \"selfEffect\": false\n            }\n        }\n    }\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"vKpGoYIStCku0pHs"}
{"name":"Shield of Faith","type":"spell","img":"systems/dnd5e/icons/spells/protect-sky-2.jpg","data":{"description":{"value":"<p>A shimmering field appears and surrounds a creature of your choice within range, granting it a +2 bonus to AC for the duration.</p>","chat":"","unidentified":""},"source":"PHB pg. 275","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A small parchment with a bit of holy text written on it.","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"fz81a13rkmhgkv1r","changes":[{"key":"data.attributes.ac.bonus","mode":2,"value":"2","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":600,"rounds":100},"icon":"systems/dnd5e/icons/spells/protect-sky-2.jpg","label":"Shield of Faith","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.ac.bonus"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.jZ6JNykRtdQ90MOo"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"w0xDFd866DNPqwYk"}
{"_id":"wf52CaM8PhZb7aC4","name":"Dissonant Whispers","type":"spell","img":"icons/magic/control/voodoo-doll-pain-damage-pink.webp","data":{"description":{"value":"<p>You whisper a discordant melody that only one creature of your choice within range can hear, wracking it with terrible pain. The target must make a Wisdom saving throw. On a failed save, it takes 3d6 psychic damage and must immediately use its reaction, if available, to move as far as its speed allows away from you. The creature doesn’t move into obviously dangerous ground, such as a fire or a pit. On a successful save, the target takes half as much damage and doesn’t have to move away. A deafened creature automatically succeeds on the save.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":""},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d6","psychic"]],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[{"_id":"fl5tpp0rrlvl5dmy","changes":[{"key":"macro.itemMacro","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":1},"icon":"icons/magic/control/voodoo-doll-pain-damage-pink.webp","label":"Dissonant Whispers","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["turnStart"],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.Ig0uh6akOXsGFvpH"},"midi-qol":{"effectActivation":false,"onUseMacroName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":true,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Dissonant Whispers","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1]\nlet tokenT = await fromUuid(lastArg.tokenUuid)\nif(args[0] === \"on\"){\n    ui.notifications.warn(`${tokenT.data.name} should use its reaction do move away from ${token.data.name}`)\n    ChatMessage.create({content:`<p style=\"font-size:larger\">Dissonant Whispers:<p style=\"font-size:larger\">${tokenT.data.name} must use its reaction do move away from ${token.data.name}</p>`});\n    tokenT.actor.setFlag(\"midi-qol\",'reactionCombatRound',game.combat?.current.round)\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Grease","type":"spell","img":"systems/dnd5e/icons/spells/fog-orange-1.jpg","data":{"description":{"value":"<p>Slick grease covers the ground in a 10-foot square centered on a point within range and turns it into difficult terrain for the duration.</p><p>When the grease appears, each creature standing in its area must succeed on a Dexterity saving throw or fall prone. A creature that enters the area or ends its turn there must also succeed on a Dexterity saving throw or fall prone.</p>","chat":"","unidentified":""},"source":"PHB pg. 246","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":10,"width":null,"units":"ft","type":"square"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"dex","dc":0,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A bit of pork rind or butter","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"ijw47b26mcwb92ji","changes":[{"key":"flags.midi-qol.disadvantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.mwak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.msak","mode":2,"value":"0","priority":"20"},{"key":"data.attributes.movement.walk","mode":1,"value":"0.5","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"icons/svg/falling.svg","label":"Prone","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["flags.midi-qol.disadvantage.attack.all","flags.midi-qol.grants.advantage.attack.mwak","flags.midi-qol.grants.advantage.attack.msak","data.attributes.movement.walk"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.etgcR9wqmrhyZ0tx"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"xXLcFByG6oo7ZWx4"}
{"_id":"xoDT6kZOOVUNOHA3","name":"Hex","type":"spell","img":"systems/dnd5e/icons/spells/evil-eye-red-1.jpg","data":{"description":{"value":"<p>You choose a creature you can see within range and mystically mark it as your quarry. Until the spell ends, you deal an extra {@dice 1d6} damage to the target whenever you hit it with a weapon attack, and you have advantage on any Wisdom (Perception) or Wisdom (Survival) check you make to find it. If the target drops to 0 hit points before this spell ends, you can use a bonus action on a subsequent turn of yours to mark a new creature.</p>","chat":"","unidentified":""},"source":"PHB pg. 251","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"enc","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":""},"attunement":0},"effects":[{"_id":"9eOiLd1FGoDJ9eLu","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"},{"key":"flags.midi-qol.disadvantage.ability.check.wis","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":3600},"icon":"systems/dnd5e/icons/spells/evil-eye-red-1.jpg","label":"Hexed","origin":"Item.SU8tsBLWTXP7NUdb","tint":null,"transfer":false,"flags":{"dae":{"stackable":"none","macroRepeat":"none","specialDuration":["zeroHP"],"transfer":false,"durationExpression":""},"ActiveAuras":{"isAura":false,"radius":null,"aura":"None","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"hostile":false,"onlyOnce":false},"core":{"statusId":""}},"selectedKey":["macro.itemMacro.GM","flags.midi-qol.disadvantage.ability.check.wis"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.0xmXiPiuYws1OGcX"},"midi-qol":{"onUseMacroName":"[postActiveEffects]ItemMacro,[preItemRoll]ItemMacro","effectActivation":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Hex","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0].macroPass === \"postActiveEffects\"){\n    let tokenU = await fromUuid(args[0].tokenUuid)\n    updateItemEffect()\n    let concentrationDataUuid\n    if(args[0].item.name != \"Hex\"){\n        tokenU.actor.effects.find(i=>i.data.label === \"Hex\").delete()\n        concentrationDataUuid = tokenU.actor.getFlag(\"midi-qol\",\"concentration-data\").uuid\n    }\n    else{\n        concentrationDataUuid = args[0].itemUuid\n    }\n    const effectData2 = {\n        changes: [\n          {key: \"flags.midi-qol.hex\", mode: 5, value: args[0].targetUuids[0], priority: 20},\n          {key: \"flags.dnd5e.DamageBonusMacro\", mode: 0, value: `ItemMacro.${args[0].item.name}`, priority: 20}\n        ],  \n        origin: concentrationDataUuid,\n        disabled: false,\n        duration: args[0].item.effects[0].duration,\n        icon: args[0].item.img,\n        label: 'Hex'\n    }\n    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: tokenU.actor.uuid, effects: [effectData2]})\n    if(args[0].item.name != \"Hex\")return;\n    let hexPassData = args[0].item\n    hexPassData.name = \"Hex Transffer\";\n    hexPassData.data.level = 0;\n    hexPassData.data.preparation.mode = \"innate\"\n    hexPassData.data.components.concentration = false\n    let items = (await tokenU.actor.createEmbeddedDocuments(\"Item\",[hexPassData])).map(i=>i.uuid)\n    addToRemoveConcentration(tokenU.actor,items[0])\n}\nif(args[0].macroPass === \"DamageBonus\"){\n    if(args[0].hitTargetUuids.length < 1)return;\n    const tokenU =  await fromUuid(args[0].tokenUuid);\n    if(tokenU.actor.data.flags[\"midi-qol\"].hex != args[0].hitTargetUuids[0])return;\n    const diceMult = args[0].isCritical ? 2: 1;\n    return {damageRoll: `${diceMult}d6[necrotic]`, flavor: \"Hex Damage\"}\n}\nif(args[0].macroPass === \"preItemRoll\"){\n    if(args[0].item.name === \"Hex\")return;\n    const tokenU =  await fromUuid(args[0].tokenUuid);\n    const lastTarget = await fromUuid(tokenU.actor.data.flags[\"midi-qol\"].hex)\n    if(lastTarget.actor.data.data.attributes.hp.value > 0){\n        ui.notifications.warn(\"Your last Hex target has more than 0 HP currently\")\n        return false\n    }\n}\nif(args[0] === \"on\"){\n    const lastArg = args[args.length-1]\n    const origin = await fromUuid(lastArg.origin)\n    const tokenU = await fromUuid(lastArg.tokenUuid)\n    if(origin.name === \"Hex\")return;\n    let effectUuid = tokenU.actor.uuid + \".ActiveEffect.\" + lastArg.effectId\n    addToRemoveConcentration(origin.actor,effectUuid)\n}\nasync function updateItemEffect(){\n    const abilities = [\n        {name:\"Strength\",id:\"str\"},\n        {name:\"Dexterity\",id:\"dex\"},\n        {name:\"Constitution\",id:\"con\"},\n        {name:\"Intelligence\",id:\"int\"},\n        {name:\"Wisdom\",id:\"wis\"},\n        {name:\"Charisma\",id:\"cha\"}\n    ]\n    let abilitiesContent = \"\"\n    for (let ability of abilities) {\n        abilitiesContent += `<option value=${ability.id}>${ability.name}</option>`;\n    }\n    await Dialog.prompt({\n        title: 'Hex',\n        content: `\n            <div class=\"form-group\">\n            <label for=\"exampleSelect\">Selecione o Elemento</label>\n            <select name=\"exampleSelect\">\n                ${abilitiesContent}\n            </select>\n            </div>\n        `,\n            callback: async(html) => {\n            let select = html.find('[name=\"exampleSelect\"]').val();\n            let abilityId = select;\n            let targetToken = await fromUuid(args[0].targetUuids[0])\n            let hexEffect = targetToken.actor.effects.find(i=>i.data.label === \"Hexed\")\n            let changes = [\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"value\": \"0\",\n                \"mode\": 0,\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": `flags.midi-qol.disadvantage.ability.check.${abilityId}`,\n                \"value\": \"0\",\n                \"mode\": 2,\n                \"priority\": \"20\"\n            }\n            ]\n            await MidiQOL.socket().executeAsGM(\"updateEffects\", {actorUuid: targetToken.actor.uuid, updates: [{_id:hexEffect.id,changes}]})                   \n        }        \n        }\n    )\n}\n\nfunction addToRemoveConcentration(actor,...uuids){\n    let removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\n    removeUuids = removeUuids.concat(uuids);\n    if (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"cf":{"id":"temp_ovon30cu8t","color":"#000000"},"midiProperties":{"nodam":false,"halfdam":false,"fulldam":false,"critOther":false,"concentration":false,"rollOther":false,"magicdam":false,"magiceffect":false,"toggleEffect":false,"selfEffect":false}}}
{"name":"Color Spray","type":"spell","img":"systems/dnd5e/icons/spells/fog-magenta-2.jpg","data":{"description":{"value":"<p>A dazzling array of flashing, colored light springs from your hand. Roll 6d10; the total is how many hit points of creatures this spell can effect. Creatures in a 15-foot cone originating from you are affected in ascending order of their current hit points (ignoring unconscious creatures and creatures that can't see).</p><p>Starting with the creature that has the lowest current hit points, each creature affected by this spell is blinded until the spell ends. Subtract each creature's hit points from the total before moving on to the creature with the next lowest hit points. A creature's hit points must be equal to or less than the remaining total for that creature to be affected.</p><p><strong>Higher Levels. </strong>When you cast this spell using a spell slot of 2nd level or higher, roll an additional 2d10 for each slot level above 1st.</p>","chat":"","unidentified":""},"source":"PHB pg. 222","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"round"},"target":{"value":15,"width":null,"units":"ft","type":"cone"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["6d10","midi-none"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":1,"school":"ill","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A pinch of powder or sand that is colored red, yellow, and blue.","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"2d10"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.LWTUqKkUQdMAmOe0"},"itemacro":{"macro":{"data":{"_id":null,"name":"Color Spray","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"let targets = args[0].targets\nif(targets.length<1)return;\nlet hp_pool = args[0].damageTotal;\ntargets.sort(function(a,b){return a.actor.data.data.attributes.hp.value - b.actor.data.data.attributes.hp.value});\nfor (let target of targets){\n    if (!isUnconscious(target)){\n        if (!isImumune(target)){\n            if (target.actor.data.data.attributes.hp.value <= hp_pool){\n                const effectData = {\n                    changes: [\n                    { key: `flags.midi-qol.grants.advantage.attack.all`, mode: 2, value: 1, priority: 20 },\n                    { key: `flags.midi-qol.disadvantage.attack.all`, mode: 2, value: 1, priority: 20 },\n                    ],\n                    disabled: false,\n                    duration: {rounds: 1, seconds: 6, startRound: undefined, startTime: undefined, startTurn: undefined, turns: undefined},\n                    icon: \"systems/dnd5e/icons/spells/fog-magenta-2.jpg\",\n                    label: \"Blind\",\n                    tint: null,\n                    transfer: false,\n                }\n                await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: target.actor.uuid, effects: [effectData]})             \n\n            }\n    hp_pool -= target.actor.data.data.attributes.hp.value\n    }}\n}\nfunction isImumune(token){\n   \tif (token.actor.data.data.traits.ci.value.includes('blinded'))return true;\n    return false;\n}\nfunction isUnconscious(token){\n    if(token.actor.data.effects.find(i=>i.data.label === 'Unconscious' && !i.data.disabled))return true;\n    if(token.actor.data.effects.find(i=>i.data.label === 'Blind' && !i.data.disabled))return true;\n    if(token.actor.data.effects.find(i=>i.data.label === 'Blinded' && !i.data.disabled))return true;\n    return false;\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"yb1zDVdnBvFYxmBv"}
