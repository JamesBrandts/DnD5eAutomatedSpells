{"_id":"24wzlqoO3P0XdWAE","name":"Barkskin","type":"spell","img":"systems/dnd5e/icons/spells/protect-orange-2.jpg","data":{"description":{"value":"<p>You touch a willing creature. Until the spell ends, the target's skin has a rough, bark-like appearance, and the target's AC can't be less than 16, regardless of what kind of armor it is wearing.</p>","chat":"","unidentified":""},"source":"PHB pg. 217","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"ally"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A handful of oak bark","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"uM6rgctYpcbCVSkn","flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"changes":[{"key":"data.attributes.ac.formula","mode":5,"value":"16","priority":"50"},{"key":"data.attributes.ac.calc","mode":5,"value":"custom","priority":"50"}],"disabled":false,"duration":{"startTime":null,"seconds":3600},"icon":"systems/dnd5e/icons/spells/protect-orange-2.jpg","label":"Barkskin","origin":"Item.VQMKMnQDw5rzL0zp","tint":null,"transfer":false,"selectedKey":["data.attributes.ac.formula","data.attributes.ac.calc"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.JPwIEfgUPVebr5AH"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}}}
{"_id":"4RCqMBhdRlGEqm37","name":"Tasha's Mind Whip","type":"spell","img":"icons/magic/control/voodoo-doll-pain-damage-yellow.webp","data":{"description":{"value":"<p>You psychically lash out at one creature you can see within range. The target must make an Intelligence saving throw. On a failed save, the target takes 3d6 psychic damage, and it can’t take a reaction until the end of its next turn. Moreover, on its next turn, it must choose whether it gets a move, an action, or a bonus action; it gets only one of the three. On a successful save, the target takes half as much damage and suffers none of the spell’s other effects.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd. The creatures must be within 30 feet of each other when you target them.</p>","chat":"","unidentified":""},"source":"Tasha's Cauldron of Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"round"},"target":{"value":null,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d6","psychic"]],"versatile":""},"formula":"","save":{"ability":"int","dc":null,"scaling":"spell"},"level":2,"school":"enc","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"3mkd09y17dq77no6","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":6,"rounds":1},"icon":"icons/magic/control/voodoo-doll-pain-damage-yellow.webp","label":"Tasha's Mind Whip","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.t6cTfSxKXANPBrXp"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Tasha's Mind Whip","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst targetToken = canvas.tokens.get(lastArg.tokenId);\nconst targetActor = targetToken.actor;\nif(args[0] === \"on\"){\n    targetActor.setFlag(\"midi-qol\",'reactionCombatRound',game.combat?.current.round)\n    let hookId = Hooks.on(\"updateCombat\",(combat,turn,opions,userId)=>{\n        if(lastArg.tokenId != combat.current.tokenId)return;\n        targetActor.setFlag(\"midi-qol\",'reactionCombatRound',turn.round)\n        ui.notifications.warn(`Due to Tasha's Mind Whip effects, ${targetActor.name} cant take reactions and must choose whether it gets a move, an action, or a bonus action on it's turn; it gets only one of the three`)\n        ChatMessage.create({content:`<h1><img src=\"icons/magic/control/voodoo-doll-pain-damage-yellow.webp\" width=\"36\" height=\"36\"> Tasha's Mind Whip</h1>Due to Tasha's Mind Whip effects, ${targetActor.name} cant take reactions and must choose whether it gets a move, an action, or a bonus action on it's turn; it gets only one of the three`})\n        Hooks.off(\"updateCombat\",hookId)\n    })\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Mind Spike","type":"spell","img":"icons/magic/control/silhouette-aura-energy.webp","data":{"description":{"value":"<p>You reach into the mind of one creature you can see within range. The target must make a Wisdom saving throw, taking 3d8 psychic damage on a failed save, or half as much damage on a successful one. On a failed save, you also always know the target's location until the spell ends, but only while the two of you are on the same plane of existence. While you have this knowledge, the target can’t become hidden from you, and if it’s invisible, it gains no benefit from that condition against you.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d8","psychic"]],"versatile":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":2,"school":"div","components":{"value":"","vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[{"_id":"7e56jk8j1xkvi3ks","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":3600,"rounds":600},"icon":"icons/magic/control/silhouette-aura-energy.webp","label":"Mind Spike","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.vPsGLJguaQCPKecJ"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"65XzpxGXPQEH6CZl"}
{"_id":"8DI7XSDJFJ8ojEAm","name":"Healing Spirit","type":"spell","img":"icons/magic/holy/barrier-shield-winged-cross.webp","data":{"description":{"value":"<p>You call forth a nature spirit to soothe the wounded. The intangible spirit appears in a space that is a 5-foot cube you can see within range. The spirit looks like a transparent beast or fey (your choice).</p><p>Until the spell ends, whenever you or a creature you can see moves into the spirits space for the first time on a turn or starts its turn there, you can cause the spirit to restore 1d6 hit points to that creature (no action required). The spirit can’t heal constructs or undead.</p><p>As a bonus action on your turn, you can move the Spirit up to 30 feet to a space you can see. The spirit can heal a number of times equal to 1 + your spellcasting ability modifier (minimum of twice). After healing that number of times, the spirit disappears.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, the healing increases 1d6 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":5,"width":null,"units":"ft","type":"square"},"range":{"value":60,"long":null,"units":""},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"Number of Healings","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1+ @mod","midi-none"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.KbJro1hZ741h3nzb"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Healing Spirit","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const template = await fromUuid(args[0].templateUuid);\nconst casterToken = await fromUuid(args[0].tokenUuid);\nconst size = canvas.grid.size;\nconst spellLevel = args[0].spellLevel;\nlet healings = args[0].damageTotal;\nlet moveHealingSpirit = await casterToken.actor.createEmbeddedDocuments(\"Item\",[getItemData()])\nlet healedThisTurn = []\nlet hookId = Hooks.on(\"updateToken\",(token,changes)=>{\n    if(!('x' in changes||'y' in changes))return;\n    if(casterToken.data.disposition != token.data.disposition)return;\n    if(healedThisTurn.includes(token))return;\n    let px = changes.x??token.data.x;\n    let py = changes.y??token.data.y;\n    if(Math.abs(px - template.data.x)> canvas.grid.size/2)return;\n    if(Math.abs(py - template.data.y)> canvas.grid.size/2)return;\n    heal(token)\n    healedThisTurn.push(token)\n})\nlet hookId3 = Hooks.on(\"updateCombat\",(combat)=>{\n    healedThisTurn = []\n    let token = canvas.scene.tokens.get(combat.current.tokenId)\n    if(casterToken.data.disposition != token.data.disposition)return;\n    let px = token.data.x;\n    let py = token.data.y;\n    if(Math.abs(px - template.data.x)> canvas.grid.size/2)return;\n    if(Math.abs(py - template.data.y)> canvas.grid.size/2)return;\n    heal(token) \n})\nlet hookId2 = Hooks.on(\"deleteActiveEffect\",(document)=>{\n    if(document.data.label != \"Concentrating\")return;\n    if(document.data.origin != args[0].itemUuid)return;\n    casterToken.actor.deleteEmbeddedDocuments(\"Item\",[moveHealingSpirit[0].id])\n    Hooks.off(\"updateToken\",hookId)\n    Hooks.off(\"updateCombat\",hookId3)\n    Hooks.off(\"deleteActiveEffect\",hookId2)\n})\n\nfunction heal(token){\n    healings--\n    let healRoll = new Roll(`${spellLevel-1}d6`).evaluate({async:false})\n    healRoll.toMessage({flavor:`<h1><img src=\"icons/magic/holy/barrier-shield-winged-cross.webp\" width=\"36\" height=\"36\">Healing Spirit</h1><p>${healings} left`})\n    token.actor.applyDamage(-healRoll.total)    \n    if(healings < 1){\n        let concentrationId = casterToken.actor.effects.filter(i=>i.data.label === \"Concentrating\" && i.data.origin === args[0].itemUuid).map(i=>i.id)\n        casterToken.actor.deleteEmbeddedDocuments(\"ActiveEffect\",concentrationId)\n    }\n}\nfunction getItemData(){\n    return {\n        \"name\": \"Move Healing Spirit\",\n        \"type\": \"feat\",\n        \"img\": \"icons/magic/holy/barrier-shield-winged-cross.webp\",\n        \"data\": {\n            \"description\": {\n                \"value\": \"This Feature allows for the moving of the Healing Spirit template\",\n                \"chat\": \"\",\n                \"unidentified\": \"\"\n            },\n            \"source\": \"\",\n            \"activation\": {\n                \"type\": \"bonus\",\n                \"cost\": 1,\n                \"condition\": \"\"\n            },\n            \"duration\": {\n                \"value\": null,\n                \"units\": \"\"\n            },\n            \"target\": {\n                \"value\": 5,\n                \"width\": null,\n                \"units\": \"ft\",\n                \"type\": \"square\"\n            },\n            \"range\": {\n                \"value\": 90,\n                \"long\": null,\n                \"units\": \"ft\"\n            },\n            \"uses\": {\n                \"value\": null,\n                \"max\": \"\",\n                \"per\": \"\"\n            },\n            \"consume\": {\n                \"type\": \"\",\n                \"target\": \"\",\n                \"amount\": null\n            },\n            \"ability\": \"\",\n            \"actionType\": \"util\",\n            \"attackBonus\": 0,\n            \"chatFlavor\": \"\",\n            \"critical\": {\n                \"threshold\": null,\n                \"damage\": \"\"\n            },\n            \"damage\": {\n                \"parts\": [],\n                \"versatile\": \"\"\n            },\n            \"formula\": \"\",\n            \"save\": {\n                \"ability\": \"\",\n                \"dc\": null,\n                \"scaling\": \"spell\"\n            },\n            \"requirements\": \"\",\n            \"recharge\": {\n                \"value\": null,\n                \"charged\": false\n            }\n        },\n        \"effects\": [],\n        \"folder\": null,\n        \"sort\": 0,\n        \"permission\": {\n            \"default\": 0,\n            \"U3VAAELfq3wUHjF9\": 3\n        },\n        \"flags\": {\n            \"midi-qol\": {\n                \"effectActivation\": false,\n                \"onUseMacroName\": \"[postActiveEffects]ItemMacro\"\n            },\n            \"midiProperties\": {\n                \"nodam\": false,\n                \"fulldam\": false,\n                \"halfdam\": false,\n                \"rollOther\": false,\n                \"critOther\": false,\n                \"magicdam\": false,\n                \"magiceffect\": false,\n                \"concentration\": false,\n                \"toggleEffect\": false,\n                \"selfEffect\": false\n            },\n            \"itemacro\": {\n                \"macro\": {\n                    \"data\": {\n                        \"_id\": null,\n                        \"name\": \"Move Healing Spirit\",\n                        \"type\": \"script\",\n                        \"author\": \"U3VAAELfq3wUHjF9\",\n                        \"img\": \"icons/svg/dice-target.svg\",\n                        \"scope\": \"global\",\n                        \"command\": `const template = await fromUuid(args[0].templateUuid)\\ncanvas.scene.updateEmbeddedDocuments(\\\"MeasuredTemplate\\\",[{_id:'${template.id}',x:template.data.x,y:template.data.y}])\\ncanvas.scene.deleteEmbeddedDocuments(\\\"MeasuredTemplate\\\",[template.id])`,\n                        \"folder\": null,\n                        \"sort\": 0,\n                        \"permission\": {\n                            \"default\": 0\n                        },\n                        \"flags\": {}\n                    }\n                }\n            }\n        }\n    }\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Shatter","type":"spell","img":"systems/dnd5e/icons/spells/explosion-sky-2.jpg","data":{"description":{"value":"<p>A sudden loud ringing noise, painfully intense, erupts from a point of your choice within range. Each creature in a 10-foot-radius sphere centered on that point must make a Constitution saving throw. A creature takes 3d8 thunder damage on a failed save, or half as much damage on a successful one. A creature made of inorganic material such as stone, crystal, or metal has disadvantage on this saving throw.</p><p>A nonmagical object that isn't being worn or carried also takes the damage if it's in the spell's area.</p><p><strong>Higher Levels.</strong> When you cast this spell using a 3 or higher level spell slot, the damage of the spell increases by 1d8 for each level of higher spell slot 2.</p>","chat":"","unidentified":""},"source":"PHB pg. 275","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":10,"width":null,"units":"ft","type":"sphere"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d8","thunder"]],"versatile":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A chip of mica","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.wJKpSvSTbSkTjqyb"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"9urLQhH59IGbEa93"}
{"name":"Warding Bond","type":"spell","img":"systems/dnd5e/icons/spells/protect-sky-2.jpg","data":{"description":{"value":"<p>This spell wards a willing creature you touch and creates a mystic connection between you and the target until the spell ends. While the target is within 60 feet of you, it gains a +1 bonus to AC and saving throws, and it has resistance to all damage. Also, each time it takes damage, you take the same amount of damage.</p><p>The spell ends if you drop to 0 hit points or if you and the target become separated by more than 60 feet. It also ends if the spell is cast again on either of the connected creatures. You can also dismiss the spell as an action.</p>","chat":"","unidentified":""},"source":"PHB pg. 287","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A pair of platinum rings worth at least 50 gp each, which you and the target must wear for the duration","consumed":false,"cost":100,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":0},"effects":[{"_id":"mhphlbxxdfps2th2","changes":[{"key":"data.attributes.ac.bonus","mode":2,"value":"1","priority":"20"},{"key":"data.bonuses.abilities.save","mode":2,"value":"1","priority":"20"},{"key":"flags.dae.onUpdateTarget","mode":0,"value":"Warding Bond, ItemMacro, data.attributes.hp.value","priority":"20"},{"key":"data.traits.dr.all","mode":0,"value":"true","priority":"20"}],"disabled":false,"duration":{"seconds":3600,"startTime":null},"icon":"systems/dnd5e/icons/spells/protect-sky-2.jpg","label":"Warding Bond","origin":"Actor.DMTSWfQs8whM5FtE.Item.fR2J4Ulo0GftObGd","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false},"ActiveAuras":{"isAura":false,"aura":"None","radius":null,"alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}},"tint":null,"selectedKey":["data.attributes.ac.bonus","data.bonuses.abilities.save","flags.dae.onUpdateTarget","data.traits.dr.all"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.JVhKeanAXZH62DrF"},"scene-packer":{"hash":"2d3cdfc17b6cc966dbf55fe4f0d981795641ffae","sourceId":"Item.YHB1R4IDwGQAeCvP"},"itemacro":{"macro":{"data":{"_id":null,"name":"Warding Bond","type":"script","author":"devnIbfBHb74U9Zv","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length - 1];\nlet newHp = getProperty(lastArg.updates, \"data.attributes.hp.value\");\nlet oldHp = lastArg.targetActor.data.data.attributes.hp.value;\nif (newHp && newHp < oldHp) {\n  // This requires the damage card to be displayed to work. Preferably enable auto apply damage.\n  MidiQOL.applyTokenDamage([{damage: oldHp - newHp, type: \"none\"}], oldHp - newHp, new Set([lastArg.sourceToken]), undefined, new Set(), { existingDamage: [], superSavers: new Set(), semiSuperSavers: new Set(), workflow: undefined, updateContext: {onUpdateCalled: true} })\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"effectActivation":false,"forceCEOff":true},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"cf":{"id":"temp_5o7edvfx9a"}},"_id":"A4pNsTZLsqGeddVw"}
{"name":"Magic Weapon","type":"spell","img":"systems/dnd5e/icons/spells/enchant-blue-2.jpg","data":{"description":{"value":"<p>You touch a nonmagical weapon. Until the spell ends, that weapon becomes a magic weapon with a +1 bonus to Attack rolls and Damage Rolls.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the bonus increases to +2. When you use a spell slot of 6th level or higher, the bonus increases to +3.</p>","chat":"","unidentified":""},"source":"PHB pg. 257","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":0,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"n92wn22d4nhtluts","changes":[{"key":"macro.itemMacro","mode":0,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":3600,"rounds":600},"icon":"systems/dnd5e/icons/spells/enchant-blue-2.jpg","label":"Magic Weapon","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.Sgjrf8qqv97CCWM4"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Magic Weapon","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"//DAE Item Macro Execute, arguments = @item.level\n    const { actor, token, lArgs } = targets(args)\n    const DAEItem = lArgs.efData.flags.dae.itemData\n    let weapons = actor.items.filter(i => i.data.type === `weapon`);\n    let weapon_content = ``;\n    function value_limit(val, min, max) {\n        return val < min ? min : (val > max ? max : val);\n    };\n    //Filter for weapons\n    for (let weapon of weapons) {\n        weapon_content += `<label class=\"radio-label\">\n            <input type=\"radio\" name=\"weapon\" value=\"${weapon.id}\">\n            <img src=\"${weapon.img}\" style=\"border:0px; width: 50px; height:50px;\">\n            ${weapon.data.name}\n        </label>`;\n    }\n\n    /**\n     * Select for weapon and apply bonus based on spell level\n     */\n    if (args[0] === \"on\") {\n        let content = `\n            <form class=\"magicWeapon\">\n            <div class=\"form-group\" id=\"weapons\">\n                ${weapon_content}\n            </div>\n            </form>\n            `;\n\n        new Dialog({\n            content,\n            buttons:\n            {\n                Ok:\n                {\n                    label: `Ok`,\n                    callback: async (html) => {\n                        let itemId = $(\"input[type='radio'][name='weapon']:checked\").val();\n                        let weaponItem = actor.items.get(itemId);\n                        let copy_item = duplicate(weaponItem);\n                        let spellLevel = Math.floor(args[1] / 2);\n                        let bonus = value_limit(spellLevel, 1, 3);\n                        let wpDamage = copy_item.data.damage.parts[0][0];\n                        let verDamage = copy_item.data.damage.versatile;\n                        await DAE.setFlag(actor, `magicWeapon`, {\n                            damage: weaponItem.data.data.attackBonus,\n                            weapon: itemId,\n                            weaponDmg: wpDamage,\n                            verDmg: verDamage,\n                            mgc: copy_item.data.properties.mgc\n                        }\n                        );\n                        if (copy_item.data.attackBonus === \"\") copy_item.data.attackBonus = \"0\"\n                        copy_item.data.attackBonus = `${parseInt(copy_item.data.attackBonus) + bonus}`;\n                        copy_item.data.damage.parts[0][0] = (wpDamage + \" + \" + bonus);\n                        copy_item.data.properties.mgc = true\n                        if (verDamage !== \"\" && verDamage !== null) copy_item.data.damage.versatile = (verDamage + \" + \" + bonus);\n                        await actor.updateEmbeddedDocuments(\"Item\", [copy_item]);\n                    }\n                },\n                Cancel:\n                {\n                    label: `Cancel`\n                }\n            }\n        }).render(true);\n    }\n\n    //Revert weapon and unset flag.\n    if (args[0] === \"off\") {\n        let { damage, weapon, weaponDmg, verDmg, mgc } = DAE.getFlag(actor, 'magicWeapon');\n        let weaponItem = actor.items.get(weapon);\n        let copy_item = duplicate(weaponItem);\n        copy_item.data.attackBonus = damage;\n        copy_item.data.damage.parts[0][0] = weaponDmg;\n        copy_item.data.properties.mgc = mgc\n        if (verDmg !== \"\" && verDmg !== null) copy_item.data.damage.versatile = verDmg;\n        await actor.updateEmbeddedDocuments(\"Item\", [copy_item]);\n        await DAE.unsetFlag(actor, `magicWeapon`);\n    }\n\nfunction targets(args) {\n    const lastArg = args[args.length - 1];\n    let tactor, ttoken;\n    if (lastArg.tokenId) {\n        ttoken = canvas.tokens.get(lastArg.tokenId);\n        tactor = ttoken.actor\n    }\n    else tactor = game.actors.get(lastArg.actorId);\n    return { actor: tactor, token: ttoken, lArgs: lastArg }\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"E8yf5TvZE6yeVbSJ"}
{"name":"Web","type":"spell","img":"systems/dnd5e/icons/spells/shielding-spirit-3.jpg","data":{"description":{"value":"<p>You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube from that point for the Duration. The webs are difficult terrain and lightly obscure their area.</p>\n        <p>If the webs aren't anchored between two solid masses (such as walls or trees) or layered across a floor, wall, or ceiling, the conjured web collapses on itself, and the spell ends at the start of your next turn. Webs layered over a flat surface have a depth of 5 feet.</p>\n        <p>Each creature that starts its turn in the webs or that enters them during its turn must make a Dexterity saving throw. On a failed save, the creature is Restrained as long as it remains in the webs or until it breaks free.</p>\n        <p>A creature Restrained by the webs can use its action to make a Strength check against your spell save DC. If it succeeds, it is no longer Restrained.</p>\n        <p>The webs are flammable. Any 5-foot cube of webs exposed to fire burns away in 1 round, dealing 2d4 fire damage to any creature that starts its turn in the fire.</p>","chat":"","unidentified":""},"source":"PHB pg. 287","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":20,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A bit of spiderweb","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.UJJu9c2UvCzVljiP"},"itemacro":{"macro":{"data":{"_id":null,"name":"Web","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0].macroPass ===\"templatePlaced\"){\n    const casterToken = await fromUuid(args[0].tokenUuid)\n    const template = await fromUuid(args[0].templateUuid)\n    const size = canvas.grid.size\n    const spelldc = args[0].actor.data.attributes.spelldc    \n    await DAE.setFlag(casterToken.actor,\"WebFlags\",[template.data.x,template.data.y,spelldc,args[0].itemUuid])\n    await casterToken.actor.createEmbeddedDocuments(\"ActiveEffect\",[getEffectData()])\n}\n\nfunction getEffectData(){\n    return {\n        \"changes\": [\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"icon\": \"systems/dnd5e/icons/spells/shielding-spirit-3.jpg\",\n        \"label\": \"Web Concentration\",\n        \"tint\": null,\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {                \n                \"itemData\": {                   \n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": getCommand(),\n                                }\n                            }\n                        },\n                    }\n                },\n            }\n        }\n    }\n}\nfunction getCommand(){\n    return \"if(args[0] != \\\"on\\\")return;\\nconst lastArg = args[args.length-1]\\nconst casterToken = await fromUuid(lastArg.tokenUuid)\\nconst templateX = casterToken.actor.data.flags.dae.WebFlags[0]\\nconst templateY = casterToken.actor.data.flags.dae.WebFlags[1]\\nconst spelldc = casterToken.actor.data.flags.dae.WebFlags[2]\\nconst origin = casterToken.actor.data.flags.dae.WebFlags[3]\\nif(args[0] === 'on'){\\n    let hookId = Hooks.on('updateToken',(token,changes)=>{\\n        if(!('x' in changes||'y' in changes))return;\\n        let px = token.data.x;\\n        let py = token.data.y;\\n        let center = token.data.height*canvas.grid.size/2;\\n        let size = canvas.grid.size;\\n        if(px+center<templateX)return;\\n        if(px+center>templateX+4*size)return;\\n        if(py+center<templateY)return;\\n        if(py+center>templateY+4*size)return;\\n        rollEffectItem(token)\\n    })\\n    let hookId2 = Hooks.on('updateCombat',(combat,turn,opions,userId)=>{\\n        let token = canvas.scene.tokens.get(combat.current.tokenId)\\n        let px = token.data.x;\\n        let py = token.data.y;\\n        let center = token.data.height*canvas.grid.size/2;\\n        let size = canvas.grid.size;\\n        if(px+center<templateX)return;\\n        if(px+center>templateX+4*size)return;\\n        if(py+center<templateY)return;\\n        if(py+center>templateY+4*size)return;\\n        rollEffectItem(token)\\n    })\\n    let hookId3 = Hooks.on('deleteActiveEffect',async (document)=>{\\n        if(document.data.label != 'Concentrating')return;\\n        if(document.data.origin != origin)return;\\n        webConcentrationId = await casterToken.actor.effects.filter(i=>i.data.label === 'Web Concentration').map(i=>i.id)\\n        await casterToken.actor.deleteEmbeddedDocuments('ActiveEffect',webConcentrationId)\\n        for(let token of canvas.scene.tokens){\\n            //token.actor.deleteEmbeddedDocuments('ActiveEffect',token.actor.effects.filter(i=>i.data.flags?.dae?.origin === origin).map(i=>i.id))\\n            await MidiQOL.socket().executeAsGM(\\\"removeEffects\\\", {actorUuid: token.actor.uuid, effects: token.actor.effects.filter(i=>i.data.flags?.dae?.origin === origin).map(i=>i.id)})\\n        }\\ncasterToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n        Hooks.off('updateToken',hookId)\\n        Hooks.off('updateCombat',hookId2)\\n        Hooks.off('deleteActiveEffect',hookId3)        \\n    })\\n}\\n\\nasync function rollEffectItem(token){\\n    if(token.actor.effects.filter(i=>i.data.flags.dae.origin === origin).length > 0)return;\\n    let item = await casterToken.actor.createEmbeddedDocuments('Item',[getItemData()])\\n    await MidiQOL.completeItemRoll(item[0], {targetUuids: [token.uuid]});\\n    casterToken.actor.deleteEmbeddedDocuments('Item',[item[0].id])\\n}\\nfunction getItemData(){\\n    return {\\n        'name': 'Web Effect',\\n        'type': 'spell',\\n        'img': 'systems/dnd5e/icons/spells/shielding-spirit-3.jpg',\\n        'data': {\\n            'description': {\\n                'value': '',\\n                'chat': '',\\n                'unidentified': ''\\n            },\\n            'source': '',\\n            'activation': {\\n                'type': 'special',\\n                'cost': 0,\\n                'condition': ''\\n            },\\n            'duration': {\\n                'value': null,\\n                'units': ''\\n            },\\n            'target': {\\n                'value': null,\\n                'width': null,\\n                'units': '',\\n                'type': 'creature'\\n            },\\n            'range': {\\n                'value': null,\\n                'long': null,\\n                'units': ''\\n            },\\n            'uses': {\\n                'value': null,\\n                'max': '',\\n                'per': ''\\n            },\\n            'consume': {\\n                'type': '',\\n                'target': '',\\n                'amount': null\\n            },\\n            'ability': '',\\n            'actionType': 'save',\\n            'attackBonus': 0,\\n            'chatFlavor': '',\\n            'critical': {\\n                'threshold': null,\\n                'damage': ''\\n            },\\n            'damage': {\\n                'parts': [],\\n                'versatile': ''\\n            },\\n            'formula': '',\\n            'save': {\\n                'ability': 'dex',\\n                'dc': null,\\n                'scaling': 'spell'\\n            },\\n            'level': 0,\\n            'school': 'con',\\n            'components': {\\n                'value': '',\\n                'vocal': false,\\n                'somatic': false,\\n                'material': false,\\n                'ritual': false,\\n                'concentration': false\\n            },\\n            'materials': {\\n                'value': '',\\n                'consumed': false,\\n                'cost': 0,\\n                'supply': 0\\n            },\\n            'preparation': {\\n                'mode': 'prepared',\\n                'prepared': false\\n            },\\n            'scaling': {\\n                'mode': 'none',\\n                'formula': ''\\n            }\\n        },\\n        'effects': [\\n            {\\n                'changes': [\\n                    {\\n                        'key': 'data.attributes.movement.all',\\n                        'mode': 0,\\n                        'value': '-1000',\\n                        'priority': '20'\\n                    },\\n                    {\\n                        'key': 'flags.midi-qol.grants.advantage.attack.all',\\n                        'mode': 2,\\n                        'value': '0',\\n                        'priority': '20'\\n                    },\\n                    {\\n                        'key': 'flags.midi-qol.disadvantage.attack.all',\\n                        'mode': 2,\\n                        'value': '0',\\n                        'priority': '20'\\n                    },\\n                    {\\n                        'key': 'flags.midi-qol.disadvantage.ability.save.dex',\\n                        'mode': 2,\\n                        'value': '0',\\n                        'priority': '20'\\n                    },\\n                    {\\n                        'key': 'macro.itemMacro',\\n                        'mode': 0,\\n                        'value': '@attributes.spelldc',\\n                        'priority': '20'\\n                    }\\n                ],\\n                'disabled': false,\\n                'duration': {\\n                    'startTime': null,\\n                    'seconds': 3600,\\n                    'rounds': 600\\n                },\\n                'icon': 'icons/svg/net.svg',\\n                'label': 'Restrained',\\n                'origin':origin,\\n                'transfer': false,\\n                'flags': {\\n                    'core': {\\n                        'statusId': ''\\n                    },\\n                    'dae': {\\n                        'stackable': 'none',\\n                        'durationExpression': '',\\n                        'macroRepeat': 'none',\\n                        'specialDuration': [],\\n                        'transfer': false,\\n                        'origin':origin,\\n                    }\\n                },\\n                'tint': '',\\n                'selectedKey': [\\n                    'data.attributes.movement.all',\\n                    'flags.midi-qol.grants.advantage.attack.all',\\n                    'flags.midi-qol.disadvantage.attack.all',\\n                    'flags.midi-qol.disadvantage.ability.save.dex',\\n                    'macro.itemMacro'\\n                ]\\n            }\\n        ],\\n        'folder': null,\\n        'sort': 0,\\n        'permission': {\\n            'default': 0,\\n            'U3VAAELfq3wUHjF9': 3\\n        },\\n        'flags': {\\n            'midi-qol': {\\n                'effectActivation': false\\n            },\\n            'midiProperties': {\\n                'nodam': false,\\n                'fulldam': false,\\n                'halfdam': false,\\n                'rollOther': false,\\n                'critOther': false,\\n                'magicdam': false,\\n                'magiceffect': false,\\n                'concentration': false,\\n                'toggleEffect': false,\\n                'selfEffect': false\\n            },\\n            'itemacro': {\\n                'macro': {\\n                    'data': {\\n                        '_id': null,\\n                        'name': 'Web Effect',\\n                        'type': 'script',\\n                        'author': 'U3VAAELfq3wUHjF9',\\n                        'img': 'icons/svg/dice-target.svg',\\n                        'scope': 'global',\\n                        'command': \\\"const lastArg = args[args.length-1];\\\\nconst spelldc = args[1];\\\\nconst token = await fromUuid(lastArg.tokenUuid);\\\\nif(args[0] === \\\\'on\\\\'){\\\\n    token.actor.createEmbeddedDocuments(\\\\'Item\\\\',[getItemData()])\\\\n}\\\\nif(args[0] === \\\\'off\\\\'){\\\\n    let effects = token.actor.items.filter(i=>i.name === \\\\'Free from Web\\\\')\\\\n    token.actor.deleteEmbeddedDocuments(\\\\'Item\\\\',effects.map(i=>i.id))\\\\n}\\\\nfunction getItemData(){\\\\n    return {\\\\n    \\\\'name\\\\': \\\\'Free from Web\\\\',\\\\n    \\\\'type\\\\': \\\\'feat\\\\',\\\\n    \\\\'img\\\\': \\\\'systems/dnd5e/icons/spells/shielding-spirit-3.jpg\\\\',\\\\n    \\\\'data\\\\': {\\\\n        \\\\'description\\\\': {\\\\n            \\\\'value\\\\': \\\\'\\\\',\\\\n            \\\\'chat\\\\': \\\\'\\\\',\\\\n            \\\\'unidentified\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'source\\\\': \\\\'\\\\',\\\\n        \\\\'activation\\\\': {\\\\n            \\\\'type\\\\': \\\\'action\\\\',\\\\n            \\\\'cost\\\\': 1,\\\\n            \\\\'condition\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'duration\\\\': {\\\\n            \\\\'value\\\\': null,\\\\n            \\\\'units\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'target\\\\': {\\\\n            \\\\'value\\\\': null,\\\\n            \\\\'width\\\\': null,\\\\n            \\\\'units\\\\': \\\\'\\\\',\\\\n            \\\\'type\\\\': \\\\'self\\\\'\\\\n        },\\\\n        \\\\'range\\\\': {\\\\n            \\\\'value\\\\': null,\\\\n            \\\\'long\\\\': null,\\\\n            \\\\'units\\\\': \\\\'self\\\\'\\\\n        },\\\\n        \\\\'uses\\\\': {\\\\n            \\\\'value\\\\': null,\\\\n            \\\\'max\\\\': \\\\'\\\\',\\\\n            \\\\'per\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'consume\\\\': {\\\\n            \\\\'type\\\\': \\\\'\\\\',\\\\n            \\\\'target\\\\': \\\\'\\\\',\\\\n            \\\\'amount\\\\': null\\\\n        },\\\\n        \\\\'ability\\\\': \\\\'str\\\\',\\\\n        \\\\'actionType\\\\': \\\\'abil\\\\',\\\\n        \\\\'attackBonus\\\\': 0,\\\\n        \\\\'chatFlavor\\\\': \\\\'\\\\',\\\\n        \\\\'critical\\\\': {\\\\n            \\\\'threshold\\\\': null,\\\\n            \\\\'damage\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'damage\\\\': {\\\\n            \\\\'parts\\\\': [],\\\\n            \\\\'versatile\\\\': \\\\'\\\\'\\\\n        },\\\\n        \\\\'formula\\\\': \\\\'\\\\',\\\\n        \\\\'save\\\\': {\\\\n            \\\\'ability\\\\': \\\\'\\\\',\\\\n            \\\\'dc\\\\': null,\\\\n            \\\\'scaling\\\\': \\\\'flat\\\\'\\\\n        },\\\\n        \\\\'requirements\\\\': \\\\'\\\\',\\\\n        \\\\'recharge\\\\': {\\\\n            \\\\'value\\\\': null,\\\\n            \\\\'charged\\\\': false\\\\n        }\\\\n    },\\\\n    \\\\'effects\\\\': [],\\\\n    \\\\'folder\\\\': null,\\\\n    \\\\'sort\\\\': 0,\\\\n    \\\\'permission\\\\': {\\\\n        \\\\'default\\\\': 0\\\\n    },\\\\n    \\\\'flags\\\\': {\\\\n        \\\\'midi-qol\\\\': {\\\\n            \\\\'effectActivation\\\\': false,\\\\n            \\\\'onUseMacroName\\\\': \\\\'[postActiveEffects]ItemMacro\\\\'\\\\n        },\\\\n        \\\\'itemacro\\\\': {\\\\n            \\\\'macro\\\\': {\\\\n                \\\\'data\\\\': {\\\\n                    \\\\'_id\\\\': null,\\\\n                    \\\\'name\\\\': \\\\'Free from Web\\\\',\\\\n                    \\\\'type\\\\': \\\\'script\\\\',\\\\n                    \\\\'author\\\\': \\\\'U3VAAELfq3wUHjF9\\\\',\\\\n                    \\\\'img\\\\': \\\\'icons/svg/dice-target.svg\\\\',\\\\n                    \\\\'scope\\\\': \\\\'global\\\\',\\\\n                    \\\\'command\\\\': `let token = await fromUuid(args[0].tokenUuid)\\\\\\\\nlet check = await token.actor.rollAbilityTest('str')\\\\\\\\nif(check.total < ${spelldc}){\\\\\\\\nreturn;}\\\\\\\\ntoken.actor.deleteEmbeddedDocuments(\\\\\\\\\\\\'ActiveEffect\\\\\\\\\\\\',[\\\\\\\\\\\\'${lastArg.effectId}\\\\\\\\\\\\'])`,\\\\n                    \\\\'folder\\\\': null,\\\\n                    \\\\'sort\\\\': 0,\\\\n                    \\\\'permission\\\\': {\\\\n                        \\\\'default\\\\': 0\\\\n                    },\\\\n                    \\\\'flags\\\\': {}\\\\n                }\\\\n            }\\\\n        }\\\\n    }\\\\n}\\\\n}\\\",\\n                        'folder': null,\\n                        'sort': 0,\\n                        'permission': {\\n                            'default': 0\\n                        },\\n                        'flags': {}\\n                    }\\n                }\\n            }\\n        }\\n    }\\n}\"\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"effectActivation":false,"onUseMacroName":"[templatePlaced]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"FLY7PvE7nj2StPEU"}
{"name":"Flaming Sphere","type":"spell","img":"systems/dnd5e/icons/spells/light-air-fire-3.jpg","data":{"description":{"value":"<p>A 5-foot-diameter Sphere of fire appears in an unoccupied space of your choice within range and lasts for the Duration. Any creature that ends its turn within 5 feet of the sphere must make a Dexterity saving throw. The creature takes 2d6 fire damage on a failed save, or half as much damage on a successful one.</p><p>As a Bonus Action, you can move the Sphere up to 30 feet. If you ram the sphere into a creature, that creature must make the saving throw against the sphere's damage, and the sphere stops moving this turn.</p><p>When you move the Sphere, you can direct it over barriers up to 5 feet tall and jump it across pits up to 10 feet wide. The sphere ignites flammable Objects not being worn or carried, and it sheds bright light in a 20-foot radius and dim light for an additional 20 feet.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"PHB pg. 242","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":5,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A bit of tallow, a pinch of brimstone, and a dusting of powdered iron","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.FjYE214HTERCRZNm"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Flaming Sphere","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"console.log({args})\nconst casterToken = await fromUuid(args[0].tokenUuid)\nconst effectData = {\n    \"changes\": [\n        {\n            \"key\": \"macro.itemMacro.GM\",\n            \"mode\": 0,\n            \"value\": \"0\",\n            \"priority\": \"20\"\n        }\n    ],\n    \"disabled\": false,\n    \"icon\": args[0].itemData.img,\n    \"label\": args[0].itemData.name + \"Effect\",\n    \"transfer\": false,\n    \"origin\":args[0].itemUuid,\n    \"flags\": {\n        \"dae\": {\n            \"itemData\": {\n                \"flags\": {\n                    \"itemacro\": {\n                        \"macro\": {\n                            \"data\": {\n                                \"type\": \"script\",\n                                \"command\": getCommand(),\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\ncasterToken.actor.createEmbeddedDocuments(\"ActiveEffect\",[effectData])\n\n\nfunction getCommand(){\n    return \"const lastArg = args[args.length-1];\\nconst casterToken = await fromUuid(lastArg.tokenUuid);\\nconst name = \\\"Flaming Sphere\\\";\\nconst img = \\\"systems/dnd5e/icons/spells/light-air-fire-3.jpg\\\"\\nif(args[0] === \\\"on\\\"){ \\n    const template = await fromUuid(\\\"\"+args[0].templateUuid+\"\\\")\\n    let [flaminSphereToken] = await canvas.scene.createEmbeddedDocuments('Token',[getTokenData(template)]);\\n    let [flamingSphereItem] = await casterToken.actor.createEmbeddedDocuments(\\\"Item\\\",[getItemData()]);    \\n    DAE.setFlag(casterToken.actor,\\\"flaminSphereTokenId\\\",flaminSphereToken.id);\\n    DAE.setFlag(casterToken.actor,\\\"flamingSphereItemId\\\",flamingSphereItem.id);\\n    let hookId = Hooks.on(\\\"updateCombat\\\", async(document)=>{\\n        let tokenP = canvas.tokens.get(document.previous.tokenId)\\n        let distance = canvas.grid.measureDistance(flaminSphereToken.data,tokenP);\\n        if(distance > 7.5)return;\\n        let [damageItem] = await casterToken.actor.createEmbeddedDocuments(\\\"Item\\\",[getItemData2()]);        \\n        await MidiQOL.completeItemRoll(damageItem, {targetUuids: [tokenP.document.uuid]});\\n        casterToken.actor.deleteEmbeddedDocuments('Item',[damageItem.id]);\\n    })\\n    DAE.setFlag(casterToken.actor,\\\"flamingSphereHookId\\\",hookId)\\n    template.delete()\\n}\\nif(args[0] === \\\"off\\\"){    \\n    canvas.scene.deleteEmbeddedDocuments('Token',[DAE.getFlag(casterToken.actor,\\\"flaminSphereTokenId\\\")]);\\n    casterToken.actor.deleteEmbeddedDocuments(\\\"Item\\\",[DAE.getFlag(casterToken.actor,\\\"flamingSphereItemId\\\")]);\\n    Hooks.off(\\\"updateCombat\\\",DAE.getFlag(casterToken.actor,\\\"flamingSphereHookId\\\"));\\n    DAE.unsetFlag(casterToken.actor,\\\"flaminSphereTokenId\\\");\\n    DAE.unsetFlag(casterToken.actor,\\\"flamingSphereItemId\\\");\\n    DAE.unsetFlag(casterToken.actor,\\\"flamingSphereHookId\\\")\\n}\\nfunction getTokenData(template){\\n    return {\\n        \\\"name\\\": name,\\n        \\\"displayName\\\": 50,\\n        \\\"actorLink\\\": false,\\n        \\\"img\\\": img,\\n        \\\"tint\\\": \\\"\\\",\\n        \\\"width\\\": 1,\\n        \\\"height\\\": 1,\\n        \\\"scale\\\": 1,\\n        \\\"x\\\": template.data.x,\\n        \\\"y\\\": template.data.y,\\n        \\\"elevation\\\": 0,\\n        \\\"alpha\\\": 1,\\n        \\\"hidden\\\": false,\\n        \\\"vision\\\": false,\\n        \\\"light\\\": {\\n            \\\"alpha\\\": 0.5,\\n            \\\"angle\\\": 0,\\n            \\\"bright\\\": 0,\\n            \\\"color\\\": \\\"#FF2000\\\",\\n            \\\"coloration\\\": 1,\\n            \\\"dim\\\": 5,\\n            \\\"gradual\\\": false,\\n            \\\"luminosity\\\": 0,\\n            \\\"saturation\\\": 0,\\n            \\\"contrast\\\": 0,\\n            \\\"shadows\\\": 0,\\n            \\\"animation\\\": {\\n                \\\"speed\\\": 5,\\n                \\\"intensity\\\": 5,\\n                \\\"reverse\\\": false,\\n                \\\"type\\\": \\\"wave\\\"\\n            },\\n            \\\"darkness\\\": {\\n                \\\"min\\\": 0,\\n                \\\"max\\\": 1\\n            }\\n        },\\n    };\\n}\\nfunction getItemData(){\\n    return {\\n        name: `Move ${name}`,\\n        type: \\\"spell\\\",\\n        img: img,\\n        data: {\\n            actionType: \\\"save\\\",\\n            activation: {type: \\\"bonus\\\"},\\n            damage: {parts: [[\\\"2d6\\\", \\\"fire\\\"]]},\\n            target: {value: 5,units: \\\"ft\\\", type: \\\"cube\\\"},\\n            range: {value: 30, units: \\\"ft\\\"},\\n            save: {ability: \\\"dex\\\",dc: null,scaling: \\\"spell\\\"},\\n            level: 0,\\n            school: \\\"con\\\",\\n        },\\n        flags:\\n            {\\\"midi-qol\\\": {\\n                onUseMacroName: \\\"[postActiveEffects]ItemMacro\\\",\\n            },\\n            \\\"itemacro\\\": {\\n                \\\"macro\\\": {\\n                    \\\"data\\\": {\\n                        name: `Move ${name}`,\\n                        \\\"type\\\": \\\"script\\\",\\n                        \\\"command\\\": getCommand(),\\n                    }\\n                }\\n            }\\n        }        \\n    }\\n}\\nfunction getItemData2(){\\n    return {\\n        name: `${name} Damage`,\\n        type: \\\"spell\\\",\\n        img: img,\\n        data: {\\n            actionType: \\\"save\\\",\\n            activation: {type: \\\"none\\\"},\\n            damage: {parts: [[\\\"2d6\\\", \\\"fire\\\"]]},            \\n            save: {ability: \\\"dex\\\",dc: null,scaling: \\\"spell\\\"},\\n            level: 0,\\n            school: \\\"con\\\",\\n        }\\n    }\\n}\\n\\n\\n\\nfunction getCommand(){\\n    return \\\"const template = await fromUuid(args[0].templateUuid);\\\\nconst casterToken = await fromUuid(args[0].tokenUuid);\\\\nconst flamingSphereToken = canvas.scene.tokens.get(DAE.getFlag(casterToken.actor,\\\\\\\"flaminSphereTokenId\\\\\\\"));\\\\nmoveToken(flamingSphereToken.uuid,template.data.x,template.data.y);\\\\ntemplate.delete();\\\\nasync function moveToken(tokenUuid,x,y){\\\\n    const effectData = {\\\\n        \\\\\\\"changes\\\\\\\": [\\\\n            {\\\\n                \\\\\\\"key\\\\\\\": \\\\\\\"macro.itemMacro.GM\\\\\\\",\\\\n                \\\\\\\"mode\\\\\\\": 0,\\\\n                \\\\\\\"value\\\\\\\": \\\\\\\"0\\\\\\\",\\\\n                \\\\\\\"priority\\\\\\\": \\\\\\\"20\\\\\\\"\\\\n            }\\\\n        ],\\\\n        \\\\\\\"disabled\\\\\\\": false,\\\\n        \\\\\\\"icon\\\\\\\": \\\\\\\"icons/skills/movement/figure-running-gray.webp\\\\\\\",\\\\n        \\\\\\\"label\\\\\\\": \\\\\\\"Forced Movement\\\\\\\",\\\\n        \\\\\\\"transfer\\\\\\\": false,\\\\n        \\\\\\\"flags\\\\\\\": {\\\\n            \\\\\\\"dae\\\\\\\": {\\\\n                \\\\\\\"itemData\\\\\\\": {\\\\n                    \\\\\\\"flags\\\\\\\": {\\\\n                        \\\\\\\"itemacro\\\\\\\": {\\\\n                            \\\\\\\"macro\\\\\\\": {\\\\n                                \\\\\\\"data\\\\\\\": {\\\\n                                    \\\\\\\"type\\\\\\\": \\\\\\\"script\\\\\\\",\\\\n                                    \\\\\\\"command\\\\\\\": `const lastArg = args[args.length-1]\\\\n                                        if(args[0] === \\\\\\\"on\\\\\\\"){\\\\n                                            const tokenC = await fromUuid(lastArg.tokenUuid)\\\\n                                            const tokenT = await fromUuid(\\\\\\\"${tokenUuid}\\\\\\\");\\\\n                                            await tokenT.setFlag(\\\\\\\"dnd5e\\\\\\\",\\\\\\\"forcedMovement\\\\\\\",2);\\\\n                                            await tokenT.update({x:${x},y:${y}});\\\\n                                            await tokenT.unsetFlag(\\\\\\\"dnd5e\\\\\\\",\\\\\\\"forcedMovement\\\\\\\");\\\\n                                            tokenC.actor.deleteEmbeddedDocuments(\\\\\\\"ActiveEffect\\\\\\\",[lastArg.effectId]);                                          \\\\n                                        }`,\\\\n                                }\\\\n                            }\\\\n                        }\\\\n                    }\\\\n                }\\\\n            }\\\\n        }\\\\n    }\\\\n    casterToken.actor.createEmbeddedDocuments(\\\\\\\"ActiveEffect\\\\\\\",[effectData])\\\\n}\\\"\\n}\"\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"FXriN08d3h1kdkjK"}
{"name":"Dragon's Breath","type":"spell","img":"icons/magic/fire/blast-jet-stream-embers-orange.webp","data":{"description":{"value":"<p>You touch one willing creature and imbue it with the power to spew magical energy from its mouth, provided it has one. Choose acid, cold, fire, lightning, or poison. Until the spell ends, the creature can use an action to exhale energy of the chosen type in a 15-foot cone. Each creature in that area must make a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save, or half as much damage on a successful one.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"touch","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"a hot pepper","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"ex36y5o4bfb6rqnr","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"@attributes.spelldc @spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/magic/fire/blast-jet-stream-embers-orange.webp","label":"Dragon's Breath","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro.GM"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.CWzQNWrUo6eWCRyD"},"itemacro":{"macro":{"data":{"_id":null,"name":"Dragon's Breath","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst spelldc = args[1];\nconst spellLevel = args[2]\nconst target = await fromUuid(lastArg.tokenUuid);\nif(args[0] === \"on\"){\n    let d = await new Dialog({\n        title: \"Dragon's Breath\",\n        content: `\n            <div class=\"form-group\">\n            <label for=\"exampleSelect\">Selecione o Elemento</label>\n            <select name=\"exampleSelect\">\n                <option value=\"acid\">Acido</option>\n                <option value=\"cold\">Cold</option>\n                <option value=\"fire\">Fire</option>\n                <option value=\"lightning\">Lightning</option>\n                <option value=\"poison\">Poison</option>\n            </select>\n            </div>\n        `,\n        buttons: {\n        yes: {\n            icon: '<i class=\"fas fa-check\"></i>',\n            label: 'OK',\n            callback: async (html) => {\n            let select = html.find('[name=\"exampleSelect\"]').val();\n            const itemData = {\n                \"name\": \"Breath Weapon\",\n                \"type\": \"feat\",\n                \"img\": \"icons/magic/fire/blast-jet-stream-embers-orange.webp\",\n                \"data\": {\n                    \"description\": {\n                        \"value\": \"<p>Each creature in that area must make a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save, or half as much damage on a successful one.</p>\",\n                        \"chat\": \"\",\n                        \"unidentified\": \"\"\n                    },\n                    \"source\": \"\",\n                    \"activation\": {\n                        \"type\": \"action\",\n                        \"cost\": 1,\n                        \"condition\": \"\"\n                    },\n                    \"duration\": {\n                        \"value\": null,\n                        \"units\": \"\"\n                    },\n                    \"target\": {\n                        \"value\": 15,\n                        \"width\": null,\n                        \"units\": \"ft\",\n                        \"type\": \"cone\"\n                    },\n                    \"range\": {\n                        \"value\": null,\n                        \"long\": null,\n                        \"units\": \"self\"\n                    },\n                    \"uses\": {\n                        \"value\": null,\n                        \"max\": \"\",\n                        \"per\": \"\"\n                    },\n                    \"consume\": {\n                        \"type\": \"\",\n                        \"target\": \"\",\n                        \"amount\": null\n                    },\n                    \"ability\": \"\",\n                    \"actionType\": \"save\",\n                    \"attackBonus\": 0,\n                    \"chatFlavor\": \"\",\n                    \"critical\": {\n                        \"threshold\": null,\n                        \"damage\": \"\"\n                    },\n                    \"damage\": {\n                        \"parts\": [\n                            [\n                                `${1+spellLevel}d6`,\n                                `${select}`\n                            ]\n                        ],\n                        \"versatile\": \"\"\n                    },\n                    \"formula\": \"\",\n                    \"save\": {\n                        \"ability\": \"dex\",\n                        \"dc\": `${spelldc}`,\n                        \"scaling\": \"flat\"\n                    },\n                    \"requirements\": \"\",\n                    \"recharge\": {\n                        \"value\": null,\n                        \"charged\": false\n                    }\n                }\n            }\n            let breathWeapon = await target.actor.createEmbeddedDocuments(\"Item\",[itemData])\n            DAE.setFlag(target.actor,\"breathWeaponId\",breathWeapon[0].id);\n            }\n        }\n    }}).render(true)\n}\nif(args[0] === \"off\"){\n    let breathWeaponId = await DAE.getFlag(target.actor,\"breathWeaponId\");\n    DAE.unsetFlag(target.actor,\"breathWeaponId\");\n    target.actor.deleteEmbeddedDocuments(\"Item\",[breathWeaponId]);\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"PhHYSkdfDZEeyLbH"}
{"name":"Aid","type":"spell","img":"systems/dnd5e/icons/spells/heal-sky-1.jpg","data":{"description":{"value":"<p>Your spell bolsters your allies with toughness and resolve. Choose up to three creatures within range. Each target's hit point maximum and current hit points increase by 5 for the duration.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, a target's hit points increase by an additional 5 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"PHB pg. 211","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":8,"units":"hour"},"target":{"value":3,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"A tiny strip of white cloth.","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"g1it5mvtc34vdvp0","changes":[{"key":"data.attributes.hp.max","mode":2,"value":"@spellLevel*5-5","priority":"20"},{"key":"macro.itemMacro","mode":0,"value":"@spellLevel","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":28800,"rounds":4800},"icon":"systems/dnd5e/icons/spells/heal-sky-1.jpg","label":"Aid","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.attributes.hp.max","macro.itemMacro"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.Opwh2PdX4runSBlm"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Aid","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if(args[0] != \"on\")return;\nconst lastArg = args[args.length-1];\nconst spellLevel = args[1];\nconst target = await fromUuid(lastArg.tokenUuid);\ntarget.actor.applyDamage(-5*(spellLevel-1));","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"R3P9Fv9C2GO1I84q"}
{"name":"Ray of Enfeeblement","type":"spell","img":"systems/dnd5e/icons/spells/beam-jade-2.jpg","data":{"description":{"value":"<p>A black beam of enervating energy springs from your finger toward a creature within range. Make a ranged spell attack against the target. On a hit, the target deals only half damage with weapon attacks that use Strength until the spell ends.</p><p>At the end of each of the target's turns, it can make a Constitution saving throw against the spell. On a success, the spell ends.</p>","chat":"","unidentified":""},"source":"PHB pg. 271","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"nec","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"eb3enpjkhtjlzbrm","changes":[{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"},{"key":"flags.midi-qol.OverTime","mode":2,"value":"turn=end,\nsaveAbility=con,\nsaveDC=@attributes.spelldc,\nlabel=Ray of Enfeeblement","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"systems/dnd5e/icons/spells/beam-jade-2.jpg","label":"Ray of Enfeeblement","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["macro.itemMacro.GM","flags.midi-qol.OverTime"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.ODhLKBxLnvvLOnw1"},"itemacro":{"macro":{"data":{"_id":null,"name":"Ray of Enfeeblement","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst targetToken = canvas.tokens.get(lastArg.tokenId);\nconst targetActor = targetToken.actor;\nif(args[0] === \"on\"){\n    let hookId = Hooks.on(\"midi-qol.preDamageRollComplete\",async(workflow)=>{\n        if(workflow.item.abilityMod != \"str\")return;\n        if(workflow.tokenId != lastArg.tokenId)return;\n        workflow.damageRoll = await new Roll(`${Math.floor(workflow.damageTotal/2)}`).roll();\n        workflow.damageTotal = workflow.damageRoll.total;\n    })\n    DAE.setFlag(targetActor,\"RayOfEnfeeblementHookId\",hookId);\n}\nif(args[0] === \"off\"){\n    Hooks.off(\"midi-qol.preDamageRollComplete\",DAE.getFlag(targetActor,\"RayOfEnfeeblementHookId\"));\n    DAE.unsetFlag(targetActor,\"RayOfEnfeeblementHookId\")\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"TgwqOVqFfcjk9n6o"}
{"name":"Blur","type":"spell","img":"systems/dnd5e/icons/spells/air-burst-sky-2.jpg","data":{"description":{"value":"<p>Your body becomes blurred, shifting and wavering to all who can see you. For the duration, any creature has disadvantage on attack rolls against you. An attacker is immune to this effect if it doesn't rely on sight, as with blindsight, or can see through illusions, as with truesight.</p>","chat":"","unidentified":""},"source":"PHB pg. 219","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"ill","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"q7905brozs2wwwmv","changes":[{"key":"flags.midi-qol.grants.disadvantage.attack.all","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"systems/dnd5e/icons/spells/air-burst-sky-2.jpg","label":"Blur","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"flags.midi-qol.grants.disadvantage.attack.all"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.UDUnlfPsOAbq2RSE"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"WLGLb5V2BkG3B2cS"}
{"name":"Misty Step","type":"spell","img":"systems/dnd5e/icons/spells/wind-grasp-air-1.jpg","data":{"description":{"value":"<p>Briefly surrounded by silvery mist, you teleport up to 30 feet to an unoccupied space that you can see.</p>","chat":"","unidentified":""},"source":"PHB pg. 260","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":5,"width":null,"units":"ft","type":"cube"},"range":{"value":30,"long":null,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.wqfAVANuQonNBgnL"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Misty Step","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const token = await fromUuid(args[0].tokenUuid)\nconst template = await fromUuid(args[0].templateUuid)\ntoken.update({x:template.data.x,y:template.data.y},{animate:false })\ntemplate.delete()","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"Z9VBydci75FM3stj"}
{"name":"Lesser Restoration","type":"spell","img":"systems/dnd5e/icons/spells/heal-sky-1.jpg","data":{"description":{"value":"<p>You touch a creature and can end either one disease or one condition afflicting it. The condition can be blinded, deafened, paralyzed, or poisoned.</p>","chat":"","unidentified":""},"source":"PHB pg. 255","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.F0GsG0SJzsIOacwV"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Lesser Restoration","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const targetToken = args[0].targets[0];\ntargetToken.actor.deleteEmbeddedDocuments(\"ActiveEffect\",targetToken.actor.effects.filter(i=>[\"Blind\",\"Deaf\",\"Paralyzed\",\"Poisoned\"].includes(i.data.label)).map(i=>i.id));","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"b2zxEyXAATC510PN"}
{"name":"Hold Person","type":"spell","img":"systems/dnd5e/icons/spells/shielding-eerie-2.jpg","data":{"description":{"value":"<p>Choose a humanoid that you can see within range. The target must succeed on a Wisdom saving throw or be paralyzed for the duration. At the end of each of its turns, the target can make another Wisdom saving throw. On a success, the spell ends on the target.</p>\n<p><strong>Higher Levels. </strong>When you cast this spell using a spell slot of 3rd level or higher, you can target one additional humanoid for each slot level above 2nd. The humanoids must be within 30 feet of each other when you target them.<br /><br />Assumes Convenient Effects</p>","chat":"","unidentified":""},"source":"PHB pg. 251","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"wis","dc":null,"scaling":"spell"},"level":2,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A small, straight piece of iron","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":""},"attunement":null},"effects":[{"_id":"t3cxabtojf2E7WRI","changes":[{"key":"flags.midi-qol.OverTime","mode":5,"value":"turn=end,\nsaveAbility=wis,\nsaveDC=@attributes.spelldc,\nlabel=Hold Person","priority":"20"},{"key":"flags.midi-qol.fail.ability.save.str","mode":0,"value":"0","priority":"20"},{"key":"flags.midi-qol.fail.ability.save.dex","mode":0,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.advantage.attack.all","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.critical.mwak","mode":2,"value":"0","priority":"20"},{"key":"flags.midi-qol.grants.critical.msak","mode":2,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"rounds":10},"icon":"systems/dnd5e/icons/spells/shielding-eerie-2.jpg","label":"Paralyzed","origin":"Item.fTpCyyR0tWfOR0S3","transfer":false,"flags":{"dae":{"stackable":"none","macroRepeat":"none","specialDuration":[],"transfer":false,"durationExpression":""},"dnd5e-helpers":{"rest-effect":"Ignore"},"ActiveAuras":{"isAura":false,"aura":"None","radius":null,"alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"hostile":false,"onlyOnce":false,"displayTemp":false},"core":{"statusId":""}},"tint":null,"selectedKey":["flags.midi-qol.OverTime","flags.midi-qol.fail.ability.save.str","flags.midi-qol.fail.ability.save.dex","flags.midi-qol.grants.advantage.attack.all","flags.midi-qol.grants.critical.mwak","flags.midi-qol.grants.critical.msak"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.3Lo9boi7P2ro6QV4"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"midi-qol":{"onUseMacroName":"","effectActivation":false},"cf":{"id":"temp_5o7edvfx9a","color":"#000000"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"d2Jfh62oigPJP7sm"}
{"name":"Scorching Ray","type":"spell","img":"systems/dnd5e/icons/spells/beam-red-2.jpg","data":{"description":{"value":"<p>You create three rays of fire and hurl them at targets within range. You can hurl them at one target or several.</p><p>Make a ranged Spell Attack for each ray. On a hit, the target takes 2d6 fire damage.</p><p><strong>Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you create one additional ray for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"PHB pg. 273","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":120,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rsak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d6","fire"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.7u2obDvuvtZBkTfq"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Scorching Ray","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const casterToken = await fromUuid(args[0].tokenUuid);\nif(args[0].itemData.name === \"Scorching Ray\"){    \n    const spellLevel = args[0].spellLevel;\n    let itemData = duplicate(args[0].itemData);\n    itemData.name = \"Aditional Scorching Ray\";\n    itemData.data.level = 0;\n    itemData.data.uses.max = spellLevel;\n    itemData.data.uses.value = spellLevel;\n    itemData.data.preparation.mode = \"innate\";\n    casterToken.actor.createEmbeddedDocuments(\"Item\",[itemData]);\n    const effectData = {\n        label: \"Aditional Scorching Ray\", \n        changes: [\n        {\"key\": \"macro.itemMacro.GM\",\"mode\": 0,\"value\": \"\",\"priority\": \"20\"}\n        ],  \n        origin: args[0].itemUuid, \n        disabled: false,\n        icon: \"systems/dnd5e/icons/spells/beam-red-2.jpg\",\n        duration: { turns: 1, seconds: 6},\n        flags: {\n            \"dae\": {\n                \"transfer\": false,\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": `\n                                    if(args[0] === \"off\"){\n                                        const lastArg = args[args.length-1];\n                                        const casterToken = await fromUuid(lastArg.tokenUuid)\n                                        casterToken.actor.deleteEmbeddedDocuments(\"Item\",casterToken.actor.items.filter(i=>i.name === \"Aditional Scorching Ray\").map(i=>i.id))\n                                        }`\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n    await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: casterToken.actor.uuid, effects: [effectData]});\n}\nif(args[0].itemData.name === \"Aditional Scorching Ray\"){\n    await casterToken.actor.updateEmbeddedDocuments(\"Item\",[{_id:args[0].item._id,'data.uses.value':args[0].item.data.uses.value - 1}]);\n    if(args[0].item.data.uses.value <= 1){\n        casterToken.actor.deleteEmbeddedDocuments(\"Item\",[args[0].item._id]);\n        casterToken.actor.deleteEmbeddedDocuments(\"ActiveEffect\",casterToken.actor.effects.filter(i=>i.data.label === \"Aditional Scorching Ray\").map(i=>i.id));\n        return;\n    }\n}\nlet caster = casterToken.actor;\nlet itemMessage  = game.messages.get(args[0].itemCardId);\nlet contentOld = itemMessage.data.content;\nlet contentNew = itemMessage.data.content + `<button id=\"button-${itemMessage.id}\">Aditional Scorching Ray</button>`;\nawait await ChatMessage.updateDocuments([{_id:args[0].itemCardId,content:contentNew}]);\n$(`#button-${itemMessage.id}`).click(async function(){\n    await caster.items.getName(\"Aditional Scorching Ray\").roll();\n})","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"ggEob7ECErlze4qM"}
{"_id":"hgFyLse2T9UWh68b","name":"Spike Growth","type":"spell","img":"systems/dnd5e/icons/spells/vines-acid-2.jpg","data":{"description":{"value":"<p>The ground in a 20-foot radius centered on a point within range twists and sprouts hard spikes and thorns. The area becomes difficult terrain for the Duration. When a creature moves into or within the area, it takes 2d4 piercing damage for every 5 feet it travels.</p><p>The transformation of the ground is camouflaged to look natural. Any creature that can't see the area at the time the spell is cast must make a Wisdom (Perception) check against your spell save DC to recognize the terrain as hazardous before entering it.</p>","chat":"","unidentified":""},"source":"PHB pg. 277","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"radius"},"range":{"value":150,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"Seven sharp thorns or seven small twigs, each sharpened to a point","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.9gYGkrL6qFTsE6fw"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[templatePlaced]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Spike Growth","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const template = await fromUuid(args[0].templateUuid)\nconst casterToken = await fromUuid(args[0].tokenUuid)\nconst itemUuid = args[0].itemUuid\nawait DAE.setFlag(casterToken.actor,\"spikeGrouthFlags\",[template.data.x,template.data.y,itemUuid])\nlet item = await casterToken.actor.createEmbeddedDocuments('Item',[getItemData()])\nawait MidiQOL.completeItemRoll(item[0],{showFullCard: false});\ncasterToken.actor.deleteEmbeddedDocuments('Item',[item[0].id])\nfunction getItemData(){\n    return {\n    \"name\": \"Spike Growth Concentration\",\n    \"type\": \"spell\",\n    \"img\": \"systems/dnd5e/icons/spells/vines-acid-2.jpg\",\n    \"data\": {\n        \"description\": {\n            \"value\": \"\",\n            \"chat\": \"\",\n            \"unidentified\": \"\"\n        },\n        \"source\": \"\",\n        \"activation\": {\n            \"type\": \"none\",\n            \"cost\": 0,\n            \"condition\": \"\"\n        },\n        \"duration\": {\n            \"value\": null,\n            \"units\": \"\"\n        },\n        \"target\": {\n            \"value\": null,\n            \"width\": null,\n            \"units\": \"\",\n            \"type\": \"self\"\n        },\n        \"range\": {\n            \"value\": null,\n            \"long\": null,\n            \"units\": \"self\"\n        },\n        \"uses\": {\n            \"value\": null,\n            \"max\": \"\",\n            \"per\": \"\"\n        },\n        \"consume\": {\n            \"type\": \"\",\n            \"target\": \"\",\n            \"amount\": null\n        },\n        \"ability\": null,\n        \"actionType\": \"\",\n        \"attackBonus\": 0,\n        \"chatFlavor\": \"\",\n        \"critical\": {\n            \"threshold\": null,\n            \"damage\": \"\"\n        },\n        \"damage\": {\n            \"parts\": [],\n            \"versatile\": \"\"\n        },\n        \"formula\": \"\",\n        \"save\": {\n            \"ability\": \"\",\n            \"dc\": null,\n            \"scaling\": \"spell\"\n        },\n        \"level\": 0,\n        \"school\": \"abj\",\n        \"components\": {\n            \"value\": \"\",\n            \"vocal\": false,\n            \"somatic\": false,\n            \"material\": false,\n            \"ritual\": false,\n            \"concentration\": false\n        },\n        \"materials\": {\n            \"value\": \"\",\n            \"consumed\": false,\n            \"cost\": 0,\n            \"supply\": 0\n        },\n        \"preparation\": {\n            \"mode\": \"prepared\",\n            \"prepared\": false\n        },\n        \"scaling\": {\n            \"mode\": \"none\",\n            \"formula\": \"\"\n        }\n    },\n    \"effects\": [\n        {\n            \"changes\": [\n                {\n                    \"key\": \"macro.itemMacro.GM\",\n                    \"mode\": 0,\n                    \"value\": \"0\",\n                    \"priority\": \"20\"\n                }\n            ],\n            \"disabled\": false,\n            \"duration\": {\n                \"startTime\": null\n            },\n            \"icon\": \"systems/dnd5e/icons/spells/vines-acid-2.jpg\",\n            \"label\": \"Spike Growth Concentration\",\n            \"transfer\": false,\n            \"flags\": {\n                \"core\": {\n                    \"statusId\": \"\"\n                },\n                \"dae\": {\n                    \"stackable\": \"none\",\n                    \"durationExpression\": \"\",\n                    \"macroRepeat\": \"none\",\n                    \"specialDuration\": [],\n                    \"transfer\": false\n                }\n            },\n            \"tint\": \"\",\n            \"selectedKey\": \"macro.itemMacro.GM\"\n        }\n    ],\n    \"folder\": null,\n    \"sort\": 0,\n    \"flags\": {\n        \"itemacro\": {\n            \"macro\": {\n                \"data\": {\n                    \"_id\": null,\n                    \"name\": \"Spike Growth Concentration\",\n                    \"type\": \"script\",\n                    \"img\": \"icons/svg/dice-target.svg\",\n                    \"scope\": \"global\",\n                    \"command\": \"if(args[0] != \\\"on\\\")return;\\nconst lastArg = args[args.length-1];\\nconst casterToken = await fromUuid(lastArg.tokenUuid)\\nconst flags = await DAE.getFlag(casterToken.actor,\\\"spikeGrouthFlags\\\")\\nlet size = canvas.grid.size\\nlet radius = 4*size\\nlet linesInXvar = await linesInX(flags[0],flags[1],radius,size)\\nlet linesInYvar = await linesInY(flags[0],flags[1],radius,size)\\nlet hookId = Hooks.on(\\\"preUpdateToken\\\",async(token,changes)=>{\\n    if(!('x' in changes||'y' in changes))return;\\n    let p1x = token.data.x\\n    let p1y = token.data.y\\n    let p2x = changes.x??token.data.x\\n    let p2y = changes.y??token.data.y\\n    let desl = token.data.height*canvas.grid.size/2\\n    let crossedOnX = 0\\n    let crossedOnY = 0\\n    for(let line of linesInXvar){\\n        let crossPoint = await crossLineInX(line.x,p1x+desl,p1y+desl,p2x+desl,p2y+desl)\\n        if(!crossPoint)continue;\\n        if(crossPoint>line.y1)continue;\\n        if(crossPoint<line.y2)continue;\\n        crossedOnX++\\n    }\\n    for(let line of linesInYvar){\\n        let crossPoint = await crossLineInY(line.y,p1x+desl,p1y+desl,p2x+desl,p2y+desl)\\n        if(!crossPoint)continue;\\n        if(crossPoint>line.x1)continue;\\n        if(crossPoint<line.x2)continue;\\n        crossedOnY++\\n    }\\n    let dices = crossedOnX*2;\\n    if(crossedOnY>crossedOnX)dices = crossedOnY*2;\\n    if(dices<1)return;\\n    let item = await casterToken.actor.createEmbeddedDocuments('Item',[getItemData(dices)])\\n    await MidiQOL.completeItemRoll(item[0], {targetUuids: [token.uuid]});\\n    casterToken.actor.deleteEmbeddedDocuments('Item',[item[0].id])\\n})\\nlet hookId2 = Hooks.on(\\\"deleteActiveEffect\\\",(document)=>{\\n    if(document.data.label != \\\"Concentrating\\\")return;\\n    if(document.data.origin != flags[2])return;\\ncasterToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n    Hooks.off(\\\"preUpdateToken\\\",hookId)\\n    Hooks.off(\\\"deleteActiveEffect\\\",hookId2)\\n})\\nfunction crossLineInX(x,p1x,p1y,p2x,p2y){\\n    if(p1x>=x&&p2x>x)return false;\\n    if(p1x<=x&&p2x<x)return false;\\n    return p1y+((x-p1x)*(p1y-p2y)/(p1x-p2x)) \\n}\\nfunction crossLineInY(y,p1x,p1y,p2x,p2y){\\n    if(p1y>=y&&p2y>y)return false;\\n    if(p1y<=y&&p2y<y)return false;\\n    return p1x+((y-p1y)*(p1x-p2x)/(p1y-p2y)) \\n}\\nfunction linesInX(x,y,radius,size){\\n    let lines = [{x:x,y1:y+radius,y2:y-radius}]\\n    for(let i = size;i<=radius;i+=size){\\n        lines.push({x:x+i,y1:y+Math.sqrt(radius*radius-i*i),y2:y-Math.sqrt(radius*radius-i*i)})\\n        lines.push({x:x-i,y1:y+Math.sqrt(radius*radius-i*i),y2:y-Math.sqrt(radius*radius-i*i)})\\n    }\\n    return lines\\n}\\nfunction linesInY(x,y,radius,size){\\n    let lines = [{y:y,x1:x+radius,x2:x-radius}]\\n    for(let i = size;i<=radius;i+=size){\\n        lines.push({y:y+i,x1:x+Math.sqrt(radius*radius-i*i),x2:x-Math.sqrt(radius*radius-i*i)})\\n        lines.push({y:y-i,x1:x+Math.sqrt(radius*radius-i*i),x2:x-Math.sqrt(radius*radius-i*i)})\\n        \\n    }\\n    return lines\\n}\\nfunction getItemData(dices){\\n    return {\\n    \\\"name\\\": \\\"Spike Growth Damage\\\",\\n    \\\"type\\\": \\\"spell\\\",\\n    \\\"img\\\": \\\"systems/dnd5e/icons/spells/vines-acid-2.jpg\\\",\\n    \\\"data\\\": {\\n        \\\"description\\\": {\\n            \\\"value\\\": \\\"\\\",\\n            \\\"chat\\\": \\\"\\\",\\n            \\\"unidentified\\\": \\\"\\\"\\n        },\\n        \\\"source\\\": \\\"\\\",\\n        \\\"activation\\\": {\\n            \\\"type\\\": \\\"none\\\",\\n            \\\"cost\\\": 0,\\n            \\\"condition\\\": \\\"\\\"\\n        },\\n        \\\"duration\\\": {\\n            \\\"value\\\": null,\\n            \\\"units\\\": \\\"\\\"\\n        },\\n        \\\"target\\\": {\\n            \\\"value\\\": null,\\n            \\\"width\\\": null,\\n            \\\"units\\\": \\\"\\\",\\n            \\\"type\\\": \\\"\\\"\\n        },\\n        \\\"range\\\": {\\n            \\\"value\\\": null,\\n            \\\"long\\\": null,\\n            \\\"units\\\": \\\"\\\"\\n        },\\n        \\\"uses\\\": {\\n            \\\"value\\\": null,\\n            \\\"max\\\": \\\"\\\",\\n            \\\"per\\\": \\\"\\\"\\n        },\\n        \\\"consume\\\": {\\n            \\\"type\\\": \\\"\\\",\\n            \\\"target\\\": \\\"\\\",\\n            \\\"amount\\\": null\\n        },\\n        \\\"ability\\\": \\\"\\\",\\n        \\\"actionType\\\": \\\"util\\\",\\n        \\\"attackBonus\\\": 0,\\n        \\\"chatFlavor\\\": \\\"\\\",\\n        \\\"critical\\\": {\\n            \\\"threshold\\\": null,\\n            \\\"damage\\\": \\\"\\\"\\n        },\\n        \\\"damage\\\": {\\n            \\\"parts\\\": [\\n                [\\n                    `${dices}d4`,\\n                    \\\"piercing\\\"\\n                ]\\n            ],\\n            \\\"versatile\\\": \\\"\\\"\\n        },\\n        \\\"formula\\\": \\\"\\\",\\n        \\\"save\\\": {\\n            \\\"ability\\\": \\\"\\\",\\n            \\\"dc\\\": null,\\n            \\\"scaling\\\": \\\"spell\\\"\\n        },\\n        \\\"level\\\": 0,\\n        \\\"school\\\": \\\"trs\\\",\\n        \\\"components\\\": {\\n            \\\"value\\\": \\\"\\\",\\n            \\\"vocal\\\": false,\\n            \\\"somatic\\\": false,\\n            \\\"material\\\": false,\\n            \\\"ritual\\\": false,\\n            \\\"concentration\\\": false\\n        },\\n        \\\"materials\\\": {\\n            \\\"value\\\": \\\"\\\",\\n            \\\"consumed\\\": false,\\n            \\\"cost\\\": 0,\\n            \\\"supply\\\": 0\\n        },\\n        \\\"preparation\\\": {\\n            \\\"mode\\\": \\\"innate\\\",\\n            \\\"prepared\\\": false\\n        },\\n        \\\"scaling\\\": {\\n            \\\"mode\\\": \\\"none\\\",\\n            \\\"formula\\\": \\\"\\\"\\n        }\\n    },\\n}\\n}\",\n                    \"folder\": null,\n                    \"sort\": 0,\n                    \"permission\": {\n                        \"default\": 0\n                    },\n                    \"flags\": {}\n                }\n            }\n        }\n    }\n}\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Darkvision","type":"spell","img":"systems/dnd5e/icons/spells/evil-eye-red-1.jpg","data":{"description":{"value":"<p>You touch a willing creature to grant it the ability to see in the dark. For the duration, that creature has darkvision out to a range of 60 feet.</p>","chat":"","unidentified":""},"source":"PHB pg. 230","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":8,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"Either a pinch of dried carrot or an agate","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"64zz0m0wq5mymk9w","changes":[{"key":"data.attributes.senses.darkvision","mode":4,"value":"60","priority":"20"},{"key":"macro.itemMacro.GM","mode":0,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":28800,"rounds":4800},"icon":"systems/dnd5e/icons/spells/evil-eye-red-1.jpg","label":"Darkvision","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.attributes.senses.darkvision","macro.itemMacro.GM"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.hJ6ZiA3fpoY8v9cp"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Darkvision","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst targetToken = await fromUuid(lastArg.tokenUuid);\ntargetToken.update({dimSight:targetToken.actor.data.data.attributes.senses.darkvision});","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"nGpsUSvzG4pjDHzy"}
{"name":"Snillocs Snowball Storm","type":"spell","img":"icons/magic/water/projectile-icecicles-salvo.webp","data":{"description":{"value":"<p>A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":5,"width":null,"units":"ft","type":"sphere"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d6","cold"]],"versatile":""},"formula":"","save":{"ability":"dex","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a piece of ice or a small white rock chip","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d6"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.STYUplZDjrGUGVft"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"qACqPGad6wmdwJqi"}
{"name":"Pass without Trace","type":"spell","img":"systems/dnd5e/icons/spells/fog-air-1.jpg","data":{"description":{"value":"<p>A veil of shadows and Silence radiates from you, masking you and your companions from detection. For the Duration, each creature you choose within 30 feet of you (including you) has a +10 bonus to Dexterity (Stealth) checks and can't be tracked except by magical means. A creature that receives this bonus leaves behind no tracks or other traces of its passage.</p>","chat":"","unidentified":""},"source":"PHB pg. 264","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":30,"width":null,"units":"ft","type":"ally"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"abj","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"Ashes from a burned leaf of mistletoe and a sprig of spruce","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"5mweay5in6arab2w","changes":[{"key":"data.skills.ste.bonuses.check","mode":2,"value":"10","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":3600,"rounds":600},"icon":"systems/dnd5e/icons/spells/fog-air-1.jpg","label":"Pass without Trace","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.skills.ste.bonuses.check"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.pRMvmknwLf2tdMTj"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"r1lf2MqY7IKosSUq"}
{"name":"Rime's Binding Ice","type":"spell","img":"icons/magic/water/barrier-ice-crystal-wall-jagged-blue.webp","data":{"description":{"value":"<p>A burst of cold energy emanates from you in a 30-foot cone. Each creature in that area must make a Constitution saving throw. On a failed save, a creature takes 3d8 cold damage and is hindered by ice formations for 1 minute, or until it or another creature within reach of it uses an action to break away the ice. A creature hindered by ice has its speed reduced to 0. On a successful save, a creature takes half as much damage and isn’t hindered by ice.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a spell slot of 3rd level or higher, increase the cold damage by 1d8 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"Fizban's Treasury of Dragons","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":30,"width":null,"units":"ft","type":"cone"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["3d8","cold"]],"versatile":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell"},"level":2,"school":"abj","components":{"value":"","vocal":false,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a vial of meltwater","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[{"_id":"j8jlfziyhivv135i","changes":[{"key":"data.attributes.movement.all","mode":0,"value":"-100","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/magic/water/barrier-ice-crystal-wall-jagged-blue.webp","label":"Rime's Binding Ice","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.movement.all"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.3daqnVXtEtPVerBk"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"rJzSlY9ghYCjdAK0"}
{"_id":"rKJVyhARHuT8JHXa","name":"Enlarge/Reduce","type":"spell","img":"systems/dnd5e/icons/spells/link-blue-2.jpg","data":{"description":{"value":"<p>You cause a creature or an object you can see within range to grow larger or smaller for the Duration. Choose either a creature or an object that is neither worn nor carried. If the target is unwilling, it can make a Constitution saving throw. On a success, the spell has no effect.</p><p>If the target is a creature, everything it is wearing and carrying changes size with it. Any item dropped by an affected creature returns to normal size at once.</p><p><strong>Enlarge</strong>. The target's size doubles in all dimensions, and its weight is multiplied by eight. This growth increases its size by one category—from Medium to Large, for example. If there isn't enough room for the target to double its size, the creature or object attains the maximum possible size in the space available. Until the spell ends, the target also has advantage on Strength Checks and Strength Saving Throws. The target's Weapons also grow to match its new size. While these Weapons are enlarged, the target's attacks with them deal 1d4 extra damage.</p><p><strong>Reduce</strong>. The target's size is halved in all dimensions, and its weight is reduced to one-eighth of normal. This reduction decreases its size by one category—from Medium to Small, for example. Until the spell ends, the target also has disadvantage on Strength Checks and Strength Saving Throws. The target's Weapons also shrink to match its new size. While these Weapons are reduced, the target's attacks with them deal 1d4 less damage (this can't reduce the damage below 1).</p>","chat":"","unidentified":""},"source":"PHB pg. 237","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A pinch of powdered iron","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.WahI41a3goVUg0x1"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Enlarge/Reduce","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst casterToken = await fromUuid(lastArg.tokenUuid);\nconst origin = lastArg.itemUuid\nconst targetToken = lastArg.targets[0]\nconst spellDC = lastArg.actor.data.attributes.spelldc\nif(casterToken.data.disposition != targetToken.data.disposition){\n    const flavor = `<p>${\"Constitution Saving Throw\"}</p><p>${CONFIG.DND5E.abilities[\"con\"]} DC ${spellDC} </P> `;\n    let conSave = (await targetToken.actor.rollAbilitySave(\"con\", { flavor, fastForward: false})).total;\n    if(conSave >= spellDC){\n        return;\n    }\n}\n\n\nconst effectsData = [\n    {\n        \"changes\": [\n            {\n                \"key\": \"flags.midi-qol.advantage.ability.save.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"flags.midi-qol.advantage.ability.check.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.mwak.damage\",\n                \"mode\": 2,\n                \"value\": \"1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.rwak.damage\",\n                \"mode\": 2,\n                \"value\": \"1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"seconds\": 60,\n            \"rounds\": 10\n        },\n        \"icon\": \"icons/magic/control/silhouette-grow-shrink-blue.webp\",\n        \"label\": \"Enlarge\",\n        \"origin\": origin,\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {                \n                \"itemData\": {                   \n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": getCommandEnlarge(),\n                                }\n                            }\n                        },\n                    }\n                },\n            }\n        }\n    },\n    {\n        \"changes\": [\n            {\n                \"key\": \"flags.midi-qol.disadvantage.ability.save.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"flags.midi-qol.disadvantage.ability.check.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.mwak.damage\",\n                \"mode\": 2,\n                \"value\": \"-1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.rwak.damage\",\n                \"mode\": 2,\n                \"value\": \"-1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"rounds\": 10,\n            \"startTime\": null,\n            \"seconds\": 60\n        },\n        \"icon\": \"icons/magic/control/silhouette-grow-shrink-tan.webp\",\n        \"label\": \"Reduce\",\n        \"origin\": origin,\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {                \n                \"itemData\": {                   \n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": getCommandReduce(),\n                                }\n                            }\n                        },\n                    }\n                },\n            }\n        }\n    }\n]\nawait new Dialog({\n        title: 'Enlarge/Reduce',\n        buttons: {\n            enlarge: {\n                label: 'Enlarge',\n                callback: (html) => {\n                    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetToken.actor.uuid, effects: [effectsData[0]]});                \n                }\n            },\n            reduce: {\n                label: 'Reduce',\n                callback: (html) => {\n                    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetToken.actor.uuid, effects: [effectsData[1]]});                \n                }\n            },\n        }\n}).render(true)\n\nfunction getCommandEnlarge(){\n    return \"const lastArg = args[args.length-1]\\nconst targetToken = await fromUuid(lastArg.tokenUuid)\\nif(args[0] === \\\"on\\\"){\\n    targetToken.update({width:targetToken.data.width*2,height:targetToken.data.height*2});\\n    let hookId = Hooks.on(\\\"deleteActiveEffect\\\",(document,changes)=>{\\n        if(document.data.label != \\\"Concentrating\\\")return;\\n        if(document.data.origin != lastArg.efData.origin)return;\\n        targetToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n        Hooks.off(\\\"deleteActiveEffect\\\",hookId)\\n    })\\n}\\nif(args[0] === \\\"off\\\"){\\n    targetToken.update({width:targetToken.data.width/2,height:targetToken.data.height/2});\\n}\"\n}\n\nfunction getCommandReduce(){\n    return \"const lastArg = args[args.length-1]\\nconst targetToken = await fromUuid(lastArg.tokenUuid)\\nif(args[0] === \\\"on\\\"){\\n    targetToken.update({width:targetToken.data.width/2,height:targetToken.data.height/2});\\n    let hookId = Hooks.on(\\\"deleteActiveEffect\\\",(document,changes)=>{\\n        if(document.data.label != \\\"Concentrating\\\")return;\\n        if(document.data.origin != lastArg.efData.origin)return;\\n        targetToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n        Hooks.off(\\\"deleteActiveEffect\\\",hookId)\\n    })\\n}\\nif(args[0] === \\\"off\\\"){\\n    targetToken.update({width:targetToken.data.width*2,height:targetToken.data.height*2});\\n}\"\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}}}
{"name":"Kinetic Jaunt","type":"spell","img":"icons/magic/movement/trail-streak-zigzag-yellow.webp","data":{"description":{"value":"<p>You magically empower your movement with dancelike steps, giving yourself the following benefits for the duration:</p><ul><li>Your walking speed increases by 10 feet.</li></ul><ul><li>You don't provoke opportunity attacks.</li></ul><ul><li>You can move through the space of another creature, and it doesn't count as difficult terrain. If you end your turn in another creature's space, you are shunted to the last unoccupied space you occupied, and you take 1d8 force damage.</li></ul>","chat":"","unidentified":""},"source":"Strixhaven: A Curriculum of Chaos","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"trs","components":{"value":"","vocal":false,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[{"_id":"wkpmihbbpyjdpqfn","changes":[{"key":"data.attributes.movement.walk","mode":2,"value":"10","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"icons/magic/movement/trail-streak-zigzag-yellow.webp","label":"Kinetic Jaunt","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.movement.walk"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.oIoHmFGC1kyRX7rN"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"rfCREkGFQwVNemMU"}
{"name":"Prayer of Healing","type":"spell","img":"systems/dnd5e/icons/spells/heal-jade-2.jpg","data":{"description":{"value":"<p>Up to six creatures of your choice that you can see within range each regain Hit Points equal to 2d8 + your Spellcasting ability modifier. This spell has no effect on Undead or constructs.</p><p><strong>At Higher Levels</strong>. When you cast this spell using a spell slot of 3rd level or higher, the Healing increases by 1d8 for each slot level above 2nd.</p>","chat":"","unidentified":""},"source":"PHB pg. 267","activation":{"type":"minute","cost":10,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":30,"width":null,"units":"ft","type":"ally"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"heal","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["2d8 + @mod","healing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"1d8"},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.MOEmz9N0j0QPkKEE"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"tOVwB0hImdNDi8kp"}
{"name":"Calm Emotions","type":"spell","img":"systems/dnd5e/icons/spells/light-blue-2.jpg","data":{"description":{"value":"<p>You attempt to suppress strong emotions in a group of people. Each humanoid in a 20-foot-radius sphere centered on a point you choose within range must make a Charisma saving throw; a creature can choose to fail this saving throw if it wishes. If a creature fails its saving throw, choose one of the following two effects. You can suppress any effect causing a target to be charmed or frightened. When this spell ends, any suppressed effect resumes, provided that its duration has not expired in the meantime.</p><p>Alternatively, you can make a target indifferent about creatures of your choice that it is hostile toward. This indifference ends if the target is attacked or harmed by a spell or if it witnesses any of its friends being harmed. When the spell ends, the creature becomes hostile again, unless the DM rules otherwise.</p>","chat":"","unidentified":""},"source":"PHB pg. 221","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"sphere"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"cha","dc":0,"scaling":"spell"},"level":2,"school":"enc","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"fg1icdzfmcv1n81j","changes":[{"key":"data.traits.ci.value","mode":2,"value":"charmed","priority":"20"},{"key":"data.traits.ci.value","mode":2,"value":"frightened","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"systems/dnd5e/icons/spells/light-blue-2.jpg","label":"Calm Emotions","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":["data.traits.ci.value","data.traits.ci.value"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.3MYDjS6k9IYL0aTj"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"tl4NuB4SNPTYhZP2"}
{"name":"Invisibility","type":"spell","img":"systems/dnd5e/icons/spells/fog-sky-2.jpg","data":{"description":{"value":"<p>A creature you touch becomes invisible until the spell ends. Anything the target is wearing or carrying is invisible as long as it is on the target's person. The spell ends for a target that attacks or casts a spell.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd.</p>\n<p> </p>\n<p>* This verison of inviisbility uses conditional visibility and works with midi-qol concentration</p>","chat":"","unidentified":""},"source":"PHB pg. 254","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":null,"long":null,"units":"touch"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"ill","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"An eyelash encased in gum arabic","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":""},"attributes":{"spelldc":10},"attunement":null},"effects":[{"_id":"GoUSbGdrl7G0I89N","flags":{"dae":{"stackable":"none","specialDuration":["1Attack"],"macroRepeat":"none","transfer":false,"durationExpression":""},"ActiveAuras":{"isAura":false,"ignoreSelf":false,"hidden":false,"height":false,"aura":"None","radius":null,"alignment":"","type":"","save":"","savedc":null},"core":{"statusId":""}},"changes":[{"key":"macro.ConditionalVisibility","mode":0,"value":"invisible","priority":"20"},{"key":"flags.midi-qol.advantage.attack.all","mode":0,"value":"1","priority":"20"},{"key":"flags.midi-qol.grants.disadvantage.attack.all","mode":0,"value":"1","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/fog-sky-2.jpg","label":"Invisible","origin":"Actor.Y7foSiLRLo7ysFr9.OwnedItem.MtbkgRT7nopCAnpB","tint":null,"transfer":false,"selectedKey":["__","flags.midi-qol.advantage.attack.all","flags.midi-qol.grants.disadvantage.attack.all"]}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"","effectActivation":false},"core":{"sourceId":"Item.MtbkgRT7nopCAnpB"},"favtab":{"isFavorite":false},"autoanimations":{"killAnim":false,"animLevel":false,"override":false,"animType":"t1","animName":"","bards":{"bardAnim":"a1","bardTarget":true,"bardTargetAnim":"a1","bardTargetColor":"a1","bardSelf":true,"marker":true,"markerColor":"a1","markerColorTarget":"a1"},"spellVar":"a1","hmAnim":"a1","rangedOptions":{"rangeDmgType":""},"color":"n1","spellOptions":{"spellLoops":1},"uaStrikeType":"physical","dtvar":"dt1","divineSmite":{"dsEnable":false,"dsSelf":true,"dsSelfDelay":0,"dsSelfColor":"a1","dsTarget":true,"dsTargetDelay":1250,"dsTargetColor":"a1"},"explosion":false,"exAnimLevel":false,"explodeVariant":"ev1","impactVar":"a1","explodeColor":"","explodeRadius":"0","explodeLoop":"1","allSounds":{"explosion":{"audioExplodeEnabled":false,"file":"","delay":100,"volume":0.25},"item":{"enableAudio":false,"file":"","delay":100,"volume":0.25}},"selfRadius":"5","animTint":"#ffffff","auraOpacity":0.75,"ctaOption":false,"teleDist":30,"templates":{"tempType":"a1","tempAnim":"","tempColor":"","tempLoop":1,"customAnim":false,"customPath":""}},"cf":{"id":"temp_5o7edvfx9a","color":"#000000"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"toGEAwMtw8GGzTxL"}
{"name":"Vortex Warp","type":"spell","img":"systems/dnd5e/icons/spells/air-burst-jade-2.jpg","data":{"description":{"value":"<p>You magically twist space around another creature you can see within range. The target must succeed on a Constitution saving throw (the target can choose to fail), or the target is teleported to an unoccupied space of your choice that you can see within range. The chosen space must be on a surface or in a liquid that can support the target without the target having to squeeze.</p>","chat":"","unidentified":""},"source":"PHB pg. 260","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":0},"effects":[{"_id":"d2ira3kyajtp5gny","changes":[{"key":"macro.itemMacro","mode":0,"value":"@token","priority":"20"}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/air-burst-jade-2.jpg","label":"Vortex Warp","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"macro.itemMacro"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.wqfAVANuQonNBgnL"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Vortex Warp","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"if (!game.modules.get(\"advanced-macros\")?.active) ui.notifications.error(\"Please enable the Advanced Macros module\")\n        const casterToken = canvas.tokens.get(args[1])\n        const { actor, token, lArgs } = targets(args)\n        if (args[0] === \"on\") {\n            let range = await canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [{\n                t: \"circle\",\n                user: game.userId,\n                x: casterToken.x + canvas.grid.size / 2,\n                y: casterToken.y + canvas.grid.size / 2,\n                direction: 0,\n                distance: 90,\n                borderColor: \"#000000\",\n                fillColor: game.user.color,\n            }]);\n                let templateData = {\n                    t: \"rect\",\n                    user: game.userId,\n                    distance: Math.sqrt(50),\n                    direction: 45,\n                    x: 0,\n                    y: 0,\n                    fillColor: game.user.color,\n                };\n                Hooks.once(\"createMeasuredTemplate\", deleteTemplatesAndMove);\n                templateCreation(templateData, actor)\n                async function deleteTemplatesAndMove(template) {\n                    range[0].delete()                    \n                    await token.document.update({ x: template.data.x, y: template.data.y }, { animate: false })\n                    await actor.deleteEmbeddedDocuments(\"ActiveEffect\", [lArgs.effectId]);\n                    template.delete()\n                };\n            };\n        \n    function targets(args) {\n        const lastArg = args[args.length - 1];\n        let tactor, ttoken;\n        if (lastArg.tokenId) {\n            ttoken = canvas.tokens.get(lastArg.tokenId);\n            tactor = ttoken.actor\n        }\n        else tactor = game.actors.get(lastArg.actorId);\n        return { actor: tactor, token: ttoken, lArgs: lastArg }\n    }\n\n    function templateCreation(templateData, actor) {\n        let doc = new CONFIG.MeasuredTemplate.documentClass(templateData, { parent: canvas.scene })\n        let template = new game.dnd5e.canvas.AbilityTemplate(doc)\n        template.actorSheet = actor.sheet;\n        template.drawPreview()\n    }\n    /*\n    async function deleteTemplates(flagName, actor) {\n        let removeTemplates = canvas.templates.placeables.filter(i => i.data.flags[\"midi-srd\"]?.[flagName]?.ActorId === actor.id);\n        let templateArray = removeTemplates.map(function (w) { return w.id })\n        if (removeTemplates) await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", templateArray)\n    };\n    */","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"vypHrN4QXal6se7G"}
{"name":"Earthbind","type":"spell","img":"icons/magic/control/debuff-chains-ropes-net-green.webp","data":{"description":{"value":"<p>Choose one creature you can see within range. Yellow strips of magical energy loop around the creature. The target must succeed on a Strength saving throw or its flying speed (if any) is reduced to 0 feet for the spell’s duration. An airborne creature affected by this spell descends at 60 feet per round until it reaches the ground or the spell ends.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":300,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"str","dc":null,"scaling":"spell"},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":false,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[{"_id":"0ybwmmn1s3w9ixn2","changes":[{"key":"data.attributes.movement.fly","mode":5,"value":"0","priority":"20"}],"disabled":false,"duration":{"startTime":null,"seconds":60,"rounds":10},"icon":"icons/magic/control/debuff-chains-ropes-net-green.webp","label":"Earthbind","transfer":false,"flags":{"core":{"statusId":""},"dae":{"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[],"transfer":false}},"tint":null,"selectedKey":"data.attributes.movement.fly"}],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.NMznDDfoTl6CYcGW"},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false}},"_id":"w3RRHIHftWpMOG85"}
{"$$deleted":true,"_id":"hgFyLse2T9UWh68b"}
{"name":"Spike Growth","type":"spell","img":"systems/dnd5e/icons/spells/vines-acid-2.jpg","data":{"description":{"value":"<p>The ground in a 20-foot radius centered on a point within range twists and sprouts hard spikes and thorns. The area becomes difficult terrain for the Duration. When a creature moves into or within the area, it takes 2d4 piercing damage for every 5 feet it travels.</p><p>The transformation of the ground is camouflaged to look natural. Any creature that can't see the area at the time the spell is cast must make a Wisdom (Perception) check against your spell save DC to recognize the terrain as hazardous before entering it.</p>","chat":"","unidentified":""},"source":"PHB pg. 277","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":20,"width":null,"units":"ft","type":"radius"},"range":{"value":150,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"Seven sharp thorns or seven small twigs, each sharpened to a point","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.9gYGkrL6qFTsE6fw"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Spike Growth","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"automatedSocket.executeAsGM(\"automatedSpikeGrowthSpell\",args)\n/*\ncanvas.scene.tokens.map(i=>i.setFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\",{x:i.data.x,y:i.data.y}));\ncanvas.scene.tokens.map(i=>i.getFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\"));\ncanvas.scene.tokens.map(i=>i.unsetFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\"));\n\nconst template = await fromUuid(args[0].templateUuid)\n    const casterToken = await fromUuid(args[0].tokenUuid)\n    let size = canvas.grid.size\n    let radius = 4*size\n    let linesInXvar = await linesInX(template.data.x,template.data.y,radius,size)\n    let linesInYvar = await linesInY(template.data.x,template.data.y,radius,size)\n    canvas.scene.tokens.map(i=>i.setFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\",{x:i.data.x,y:i.data.y}));\n    let hookId = Hooks.on(\"updateToken\",async(token,changes)=>{\n        if(!('x' in changes||'y' in changes))return;\n        let p1x = token.getFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\")?.x\n        let p1y = token.getFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\")?.y\n        let p2x = changes.x??token.data.x\n        let p2y = changes.y??token.data.y\n        token.setFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\",{x:token.data.x,y:token.data.y})\n        let desl = token.data.height*canvas.grid.size/2\n        let crossedOnX = 0\n        let crossedOnY = 0\n        for(let line of linesInXvar){\n            let crossPoint = await crossLineInX(line.x,p1x+desl,p1y+desl,p2x+desl,p2y+desl)\n            if(!crossPoint)continue;\n            if(crossPoint>line.y1)continue;\n            if(crossPoint<line.y2)continue;\n            crossedOnX++\n        }\n        for(let line of linesInYvar){\n            let crossPoint = await crossLineInY(line.y,p1x+desl,p1y+desl,p2x+desl,p2y+desl)\n            if(!crossPoint)continue;\n            if(crossPoint>line.x1)continue;\n            if(crossPoint<line.x2)continue;\n            crossedOnY++\n        }\n        let dices = crossedOnX*2;\n        if(crossedOnY>crossedOnX)dices = crossedOnY*2;\n        if(dices<1)return;\n        let item = await casterToken.actor.createEmbeddedDocuments('Item',[getItemData(dices)])\n        await MidiQOL.completeItemRoll(item[0], {targetUuids: [token.uuid]});\n        casterToken.actor.deleteEmbeddedDocuments('Item',[item[0].id])\n    })\n    let hookId2 = Hooks.on(\"deleteActiveEffect\",(document)=>{\n        if(document.data.label != \"Concentrating\")return;\n        if(document.data.origin != args[0].itemUuid)return;\n        canvas.scene.tokens.map(i=>i.unsetFlag(\"dnd5e-automated-spells\",\"SpikeGrowthcontrollPosition\"));\n        Hooks.off(\"updateToken\",hookId)\n        Hooks.off(\"deleteActiveEffect\",hookId2)\n    })\n\n    function crossLineInX(x,p1x,p1y,p2x,p2y){\n        if(p1x>=x&&p2x>x)return false;\n        if(p1x<=x&&p2x<x)return false;\n        return p1y+((x-p1x)*(p1y-p2y)/(p1x-p2x)) \n    }\n    function crossLineInY(y,p1x,p1y,p2x,p2y){\n        if(p1y>=y&&p2y>y)return false;\n        if(p1y<=y&&p2y<y)return false;\n        return p1x+((y-p1y)*(p1x-p2x)/(p1y-p2y)) \n    }\n    function linesInX(x,y,radius,size){\n        let lines = [{x:x,y1:y+radius,y2:y-radius}]\n        for(let i = size;i<=radius;i+=size){\n            lines.push({x:x+i,y1:y+Math.sqrt(radius*radius-i*i),y2:y-Math.sqrt(radius*radius-i*i)})\n            lines.push({x:x-i,y1:y+Math.sqrt(radius*radius-i*i),y2:y-Math.sqrt(radius*radius-i*i)})\n        }\n        return lines\n    }\n    function linesInY(x,y,radius,size){\n        let lines = [{y:y,x1:x+radius,x2:x-radius}]\n        for(let i = size;i<=radius;i+=size){\n            lines.push({y:y+i,x1:x+Math.sqrt(radius*radius-i*i),x2:x-Math.sqrt(radius*radius-i*i)})\n            lines.push({y:y-i,x1:x+Math.sqrt(radius*radius-i*i),x2:x-Math.sqrt(radius*radius-i*i)})\n            \n        }\n        return lines\n    }\n    function getItemData(dices){\n        return {\n            \"name\": \"Spike Growth Damage\",\n            \"type\": \"spell\",\n            \"img\": \"systems/dnd5e/icons/spells/vines-acid-2.jpg\",\n            \"data\": {\n                \"activation\": {\n                    \"type\": \"none\",\n                    \"cost\": 0,\n                    \"condition\": \"\"\n                },\n                \"damage\": {\n                    \"parts\": [\n                        [\n                            `${dices}d4`,\n                            \"piercing\"\n                        ]\n                    ],\n                },\n                \"level\": 0,\n                \"school\": \"trs\",\n                \"preparation\": {\n                    \"mode\": \"innate\",\n                }\n            },\n        }\n    }\n    */","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"CHzNmFQeDxcgak1I"}
{"$$deleted":true,"_id":"FLY7PvE7nj2StPEU"}
{"name":"Web","type":"spell","img":"systems/dnd5e/icons/spells/shielding-spirit-3.jpg","data":{"description":{"value":"<p>You conjure a mass of thick, sticky webbing at a point of your choice within range. The webs fill a 20-foot cube from that point for the Duration. The webs are difficult terrain and lightly obscure their area.</p>\n        <p>If the webs aren't anchored between two solid masses (such as walls or trees) or layered across a floor, wall, or ceiling, the conjured web collapses on itself, and the spell ends at the start of your next turn. Webs layered over a flat surface have a depth of 5 feet.</p>\n        <p>Each creature that starts its turn in the webs or that enters them during its turn must make a Dexterity saving throw. On a failed save, the creature is Restrained as long as it remains in the webs or until it breaks free.</p>\n        <p>A creature Restrained by the webs can use its action to make a Strength check against your spell save DC. If it succeeds, it is no longer Restrained.</p>\n        <p>The webs are flammable. Any 5-foot cube of webs exposed to fire burns away in 1 round, dealing 2d4 fire damage to any creature that starts its turn in the fire.</p>","chat":"","unidentified":""},"source":"PHB pg. 287","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"hour"},"target":{"value":20,"width":null,"units":"ft","type":"cube"},"range":{"value":60,"long":0,"units":"ft"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A bit of spiderweb","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.UJJu9c2UvCzVljiP"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Web","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"automatedSocket.executeAsGM(\"automateWebSpell\",args)","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"P37S4jAXz6bBKSds"}
{"$$deleted":true,"_id":"vypHrN4QXal6se7G"}
{"name":"Vortex Warp","type":"spell","img":"systems/dnd5e/icons/spells/air-burst-jade-2.jpg","data":{"description":{"value":"<p>You magically twist space around another creature you can see within range. The target must succeed on a Constitution saving throw (the target can choose to fail), or the target is teleported to an unoccupied space of your choice that you can see within range. The chosen space must be on a surface or in a liquid that can support the target without the target having to squeeze.</p>\n<div style=\"display:none\">auto fail friendly</div>","chat":"","unidentified":""},"source":"PHB pg. 260","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":"inst"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":90,"long":null,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell","value":""},"level":2,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":0},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.wqfAVANuQonNBgnL"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postSave]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Vortex Warp","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const casterToken = await fromUuid(args[0].tokenUuid)\nconsole.log({args,casterToken})\nif(args[0].failedSaveUuids.length < 1)return;\nlet templateData = {\n    t: \"rect\",\n    user: game.userId,\n    distance: Math.sqrt(50),\n    direction: 45,\n    x: casterToken.data.x,\n    y: casterToken.data.y,\n    fillColor: game.user.color,\n    };\nlet doc = new CONFIG.MeasuredTemplate.documentClass(templateData, { parent: canvas.scene })\nlet template = await new game.dnd5e.canvas.AbilityTemplate(doc)\ntemplate.actorSheet = await casterToken.actor.sheet;\nawait template.drawPreview()\nHooks.once(\"createMeasuredTemplate\",async (template)=>{\n    await moveToken(args[0].failedSaveUuids[0],template.data.x,template.data.y)\n    template.delete()\n});\n\nasync function moveToken(tokenUuid,x,y){\n    const token = await fromUuid(tokenUuid)\n    const effectData = {\n        \"changes\": [\n            {\n                \"key\": \"macro.itemMacro\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"icon\": \"icons/skills/movement/figure-running-gray.webp\",\n        \"label\": \"Teleport\",\n        \"transfer\": false,\n        \"flags\": {\n            \"dae\": {\n                \"itemData\": {\n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"type\": \"script\",\n                                    \"command\": `const lastArg = args[args.length-1];\n                                        if(args[0] === \"on\"){\n                                            const token = await fromUuid(lastArg.tokenUuid);\n                                            await token.setFlag(\"dnd5e\",\"forcedMovement\",4);\n                                            await token.update({x:${x},y:${y}}, { animate: false });\n                                            await token.unsetFlag(\"dnd5e\",\"forcedMovement\");\n                                            await token.actor.deleteEmbeddedDocuments(\"ActiveEffect\",[lastArg.effectId]);\n                                        }`,\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: token.actor.uuid, effects: [effectData] });\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"2kIOqE8HRwkJesxx"}
{"name":"Shadow Blade","type":"spell","img":"icons/skills/melee/strike-blade-scimitar-gray-red.webp","data":{"description":{"value":"<p>You weave together threads of shadow to create a sword of solidified gloom in your hand. This magic sword lasts until the spell ends. It counts as a simple melee weapon with which you are proficient. It deals 2d8 psychic damage on a hit and has the finesse, light, and thrown properties (range 20/60). In addition, when you use the sword to attack a target that is in dim light or darkness, you make the attack roll with advantage.</p><p>If you drop the weapon or throw it, it dissipates at the end of the turn. Thereafter, while the spell persists, you can use a bonus action to cause the sword to reappear in your hand.</p><p><strong><em>At Higher Levels.</em></strong> When you cast this spell using a 3rd- or 4th-level spell slot, the damage increases to 3d8. When you cast it using a 5th- or 6th-level spell slot, the damage increases to 4d8. When you cast it using a spell slot of 7th level or higher, the damage increases to 5d8.</p>","chat":"","unidentified":""},"source":"Xanathar's Guide to Everything","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"ill","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"cantrip","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"6FXhlTgGWKhYckv8":3,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Item.XXbeZH2X14weCg6s"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Shadow Blade","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"token = await fromUuid(args[0].tokenUuid)\nactor = token.actor;\nlet spellLevel = args[0].spellLevel\nlet dice = 2 + (spellLevel > 2) + (spellLevel > 4) + (spellLevel > 6)\nconst itemData = {\n    name: args[0].itemData.name + \" Summoned Weapon\",\n    type: \"weapon\",\n    img: args[0].itemData.img,\n    data: {\n        actionType: \"mwak\",\n        activation: {type: \"action\"},\n        damage: {parts: [[`${dice}d8`, \"psychic\"]]},\n        target: {value: 1, type: \"creature\"},\n        range: {value: 20,long: 60,units: \"ft\"},\n        equipped: true\n    }\n};\nconst items = (await actor.createEmbeddedDocuments(\"Item\", [itemData])).map(i=> i.uuid);\nlet removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\nremoveUuids = removeUuids.concat(items);\nif (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"CM27Rz2ZGNhhkZ9O"}
{"$$deleted":true,"_id":"rKJVyhARHuT8JHXa"}
{"name":"Enlarge/Reduce","type":"spell","img":"systems/dnd5e/icons/spells/link-blue-2.jpg","data":{"description":{"value":"<p>You cause a creature or an object you can see within range to grow larger or smaller for the Duration. Choose either a creature or an object that is neither worn nor carried. If the target is unwilling, it can make a Constitution saving throw. On a success, the spell has no effect.</p>\n<p>If the target is a creature, everything it is wearing and carrying changes size with it. Any item dropped by an affected creature returns to normal size at once.</p>\n<p><strong>Enlarge</strong>. The target's size doubles in all dimensions, and its weight is multiplied by eight. This growth increases its size by one category—from Medium to Large, for example. If there isn't enough room for the target to double its size, the creature or object attains the maximum possible size in the space available. Until the spell ends, the target also has advantage on Strength Checks and Strength Saving Throws. The target's Weapons also grow to match its new size. While these Weapons are enlarged, the target's attacks with them deal 1d4 extra damage.</p>\n<p><strong>Reduce</strong>. The target's size is halved in all dimensions, and its weight is reduced to one-eighth of normal. This reduction decreases its size by one category—from Medium to Small, for example. Until the spell ends, the target also has disadvantage on Strength Checks and Strength Saving Throws. The target's Weapons also shrink to match its new size. While these Weapons are reduced, the target's attacks with them deal 1d4 less damage (this can't reduce the damage below 1).</p>\n<div style=\"display:none\">auto fail friendly</div>","chat":"","unidentified":""},"source":"PHB pg. 237","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":1,"units":"minute"},"target":{"value":1,"width":null,"units":"","type":"creature"},"range":{"value":30,"long":0,"units":"ft"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"save","attackBonus":0,"chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":"","value":""},"formula":"","save":{"ability":"con","dc":null,"scaling":"spell"},"level":2,"school":"trs","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"A pinch of powdered iron","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":true},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.WahI41a3goVUg0x1"},"midi-qol":{"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"selfEffect":false},"itemacro":{"macro":{"data":{"_id":null,"name":"Enlarge/Reduce","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"const lastArg = args[args.length-1];\nconst casterToken = await fromUuid(lastArg.tokenUuid);\nconst origin = lastArg.itemUuid\nconst targetToken = lastArg.targets[0]\n\n\nconst effectsData = [\n    {\n        \"changes\": [\n            {\n                \"key\": \"flags.midi-qol.advantage.ability.save.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"flags.midi-qol.advantage.ability.check.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.mwak.damage\",\n                \"mode\": 2,\n                \"value\": \"1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.rwak.damage\",\n                \"mode\": 2,\n                \"value\": \"1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"seconds\": 60,\n            \"rounds\": 10\n        },\n        \"icon\": \"icons/magic/control/silhouette-grow-shrink-blue.webp\",\n        \"label\": \"Enlarge\",\n        \"origin\": origin,\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {                \n                \"itemData\": {                   \n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": getCommandEnlarge(),\n                                }\n                            }\n                        },\n                    }\n                },\n            }\n        }\n    },\n    {\n        \"changes\": [\n            {\n                \"key\": \"flags.midi-qol.disadvantage.ability.save.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"flags.midi-qol.disadvantage.ability.check.str\",\n                \"mode\": 2,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.mwak.damage\",\n                \"mode\": 2,\n                \"value\": \"-1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"data.bonuses.rwak.damage\",\n                \"mode\": 2,\n                \"value\": \"-1d4\",\n                \"priority\": \"20\"\n            },\n            {\n                \"key\": \"macro.itemMacro.GM\",\n                \"mode\": 0,\n                \"value\": \"0\",\n                \"priority\": \"20\"\n            }\n        ],\n        \"disabled\": false,\n        \"duration\": {\n            \"rounds\": 10,\n            \"startTime\": null,\n            \"seconds\": 60\n        },\n        \"icon\": \"icons/magic/control/silhouette-grow-shrink-tan.webp\",\n        \"label\": \"Reduce\",\n        \"origin\": origin,\n        \"tint\": \"\",\n        \"transfer\": false,\n        \"flags\": {\n            \"core\": {\n                \"statusId\": \"\"\n            },\n            \"dae\": {                \n                \"itemData\": {                   \n                    \"flags\": {\n                        \"itemacro\": {\n                            \"macro\": {\n                                \"data\": {\n                                    \"command\": getCommandReduce(),\n                                }\n                            }\n                        },\n                    }\n                },\n            }\n        }\n    }\n]\nawait new Dialog({\n        title: 'Enlarge/Reduce',\n        buttons: {\n            enlarge: {\n                label: 'Enlarge',\n                callback: (html) => {\n                    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetToken.actor.uuid, effects: [effectsData[0]]});                \n                }\n            },\n            reduce: {\n                label: 'Reduce',\n                callback: (html) => {\n                    MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: targetToken.actor.uuid, effects: [effectsData[1]]});                \n                }\n            },\n        }\n}).render(true)\n\nfunction getCommandEnlarge(){\n    return \"const lastArg = args[args.length-1]\\nconst targetToken = await fromUuid(lastArg.tokenUuid)\\nif(args[0] === \\\"on\\\"){\\n    targetToken.update({width:targetToken.data.width*2,height:targetToken.data.height*2});\\n    let hookId = Hooks.on(\\\"deleteActiveEffect\\\",(document,changes)=>{\\n        if(document.data.label != \\\"Concentrating\\\")return;\\n        if(document.data.origin != lastArg.efData.origin)return;\\n        targetToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n        Hooks.off(\\\"deleteActiveEffect\\\",hookId)\\n    })\\n}\\nif(args[0] === \\\"off\\\"){\\n    targetToken.update({width:targetToken.data.width/2,height:targetToken.data.height/2});\\n}\"\n}\n\nfunction getCommandReduce(){\n    return \"const lastArg = args[args.length-1]\\nconst targetToken = await fromUuid(lastArg.tokenUuid)\\nif(args[0] === \\\"on\\\"){\\n    targetToken.update({width:targetToken.data.width/2,height:targetToken.data.height/2});\\n    let hookId = Hooks.on(\\\"deleteActiveEffect\\\",(document,changes)=>{\\n        if(document.data.label != \\\"Concentrating\\\")return;\\n        if(document.data.origin != lastArg.efData.origin)return;\\n        targetToken.actor.deleteEmbeddedDocuments(\\\"ActiveEffect\\\",[lastArg.effectId])\\n        Hooks.off(\\\"deleteActiveEffect\\\",hookId)\\n    })\\n}\\nif(args[0] === \\\"off\\\"){\\n    targetToken.update({width:targetToken.data.width*2,height:targetToken.data.height*2});\\n}\"\n}","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}}},"_id":"9WtJGWYiJaVUzcX0"}
{"name":"Flame Blade","type":"spell","img":"systems/dnd5e/icons/spells/enchant-orange-2.jpg","data":{"description":{"value":"<p>You evoke a fiery blade in your free hand. The blade is similar in size and shape to a Scimitar, and it lasts for the Duration. If you let go of the blade, it disappears, but you can evoke the blade again as a Bonus Action.</p><p>You can use your action to make a melee spell Attack with the fiery blade. On a hit, the target takes 3d6 fire damage.</p><p>The flaming blade sheds bright light in a 10-foot radius and dim light for an additional 10 feet.</p><p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d6 for every two slot levels above 2nd.</p>","chat":"","unidentified":""},"source":"PHB pg. 242","activation":{"type":"bonus","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"msak","attackBonus":"0","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell","value":""},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":true},"materials":{"value":"Leaf of sumac","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""},"attunement":null},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"U3VAAELfq3wUHjF9":3},"flags":{"core":{"sourceId":"Compendium.dnd5e.spells.Advtckpz1B733bu9"},"itemacro":{"macro":{"data":{"_id":null,"name":"Flame Blade","type":"script","author":"U3VAAELfq3wUHjF9","img":"icons/svg/dice-target.svg","scope":"global","command":"token = await fromUuid(args[0].tokenUuid)\nactor = token.actor;\nlet spellLevel = args[0].spellLevel\nlet dice = 3 + (spellLevel > 3) + (spellLevel > 5) + (spellLevel > 7)\nconst itemData = {\n    name: \"Summoned \" + args[0].itemData.name,\n    type: \"weapon\",\n    img: args[0].itemData.img,\n    data: {\n        actionType: \"mwak\",\n        activation: {type: \"action\"},\n        damage: {parts: [[`${dice}d6 + @mod`, \"fire\"]]},\n        target: {value: 1, type: \"creature\"},\n        range: {value: 5,long: 5,units: \"ft\"},\n        equipped: true,\n        proficient: true,\n        properties:{fin: true,lgt: true}\n    }\n};\nconst items = (await actor.createEmbeddedDocuments(\"Item\", [itemData])).map(i=> i.uuid);\nlet removeUuids = getProperty(actor.data.flags, \"midi-qol.concentration-data.removeUuids\") ?? [];\nremoveUuids = removeUuids.concat(items);\nif (removeUuids.length > 0) actor.setFlag(\"midi-qol\", \"concentration-data.removeUuids\", removeUuids);","folder":null,"sort":0,"permission":{"default":0},"flags":{}}}},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[postActiveEffects]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false}},"_id":"0jNW9j5fdzQqpVuB"}
{"$$deleted":true,"_id":"FXriN08d3h1kdkjK"}
{"$$deleted":true,"_id":"8DI7XSDJFJ8ojEAm"}
